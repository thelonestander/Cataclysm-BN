<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cataclysm BN: npc_trading Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cataclysm BN
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('namespacenpc__trading.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">npc_trading Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9a7dbd65b9ae311c79c92b57c1b134b4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__trading.html#a9a7dbd65b9ae311c79c92b57c1b134b4">pay_npc</a> (<a class="el" href="classnpc.html">npc</a> &amp;np, int cost)</td></tr>
<tr class="separator:a9a7dbd65b9ae311c79c92b57c1b134b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a501e43e4b4136a85e2773fbc89f19e69"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__trading.html#a501e43e4b4136a85e2773fbc89f19e69">cash_to_favor</a> (const <a class="el" href="classnpc.html">npc</a> &amp;, int cash)</td></tr>
<tr class="separator:a501e43e4b4136a85e2773fbc89f19e69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83aae7d987be337e0dd70f31454183a1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__trading.html#a83aae7d987be337e0dd70f31454183a1">transfer_items</a> (std::vector&lt; <a class="el" href="classitem__pricing.html">item_pricing</a> &gt; &amp;stuff, <a class="el" href="classplayer.html">player</a> &amp;giver, <a class="el" href="classplayer.html">player</a> &amp;receiver, std::list&lt; <a class="el" href="classitem__location.html">item_location</a> * &gt; &amp;from_map, bool npc_gives)</td></tr>
<tr class="separator:a83aae7d987be337e0dd70f31454183a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ababcb005b907aad47d8fc1adcabf21de"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__trading.html#ababcb005b907aad47d8fc1adcabf21de">net_price_adjustment</a> (const <a class="el" href="classplayer.html">player</a> &amp;buyer, const <a class="el" href="classplayer.html">player</a> &amp;seller)</td></tr>
<tr class="separator:ababcb005b907aad47d8fc1adcabf21de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ec2aaaf5437ced34ea57f9bd818259d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__trading.html#a0ec2aaaf5437ced34ea57f9bd818259d">trade</a> (<a class="el" href="classnpc.html">npc</a> &amp;p, int cost, const std::string &amp;deal)</td></tr>
<tr class="separator:a0ec2aaaf5437ced34ea57f9bd818259d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b3f78b67eaf84ceddde10b1f8bac191"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classitem__pricing.html">item_pricing</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__trading.html#a4b3f78b67eaf84ceddde10b1f8bac191">init_selling</a> (<a class="el" href="classnpc.html">npc</a> &amp;p)</td></tr>
<tr class="separator:a4b3f78b67eaf84ceddde10b1f8bac191"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a454c80bb5b4ca14591ff5ec7d595111a"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classitem__pricing.html">item_pricing</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__trading.html#a454c80bb5b4ca14591ff5ec7d595111a">init_buying</a> (<a class="el" href="classplayer.html">player</a> &amp;buyer, <a class="el" href="classplayer.html">player</a> &amp;seller, bool is_npc)</td></tr>
<tr class="separator:a454c80bb5b4ca14591ff5ec7d595111a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a501e43e4b4136a85e2773fbc89f19e69" name="a501e43e4b4136a85e2773fbc89f19e69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a501e43e4b4136a85e2773fbc89f19e69">&#9670;&nbsp;</a></span>cash_to_favor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int npc_trading::cash_to_favor </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classnpc.html">npc</a> &amp;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cash</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="npctalk_8cpp_source.html#l00182">182</a> of file <a class="el" href="npctalk_8cpp_source.html">npctalk.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>{</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="comment">// TODO: It should affect different NPCs to a different degree</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="comment">// Square root of mission value in dollars</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    <span class="comment">// ~31 for zed mom, 50 for horde master, ~63 for plutonium cells</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    <span class="keywordtype">double</span> scaled_mission_val = std::sqrt( cash / 100.0 );</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="rng_8cpp.html#acd19ae79e3590a99c9eaf0389318b686">roll_remainder</a>( scaled_mission_val );</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>}</div>
<div class="ttc" id="arng_8cpp_html_acd19ae79e3590a99c9eaf0389318b686"><div class="ttname"><a href="rng_8cpp.html#acd19ae79e3590a99c9eaf0389318b686">roll_remainder</a></div><div class="ttdeci">int roll_remainder(double value)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00096">rng.cpp:96</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="rng_8cpp_source.html#l00096">roll_remainder()</a>.</p>

<p class="reference">Referenced by <a class="el" href="npctalk_8cpp_source.html#l02471">talk_effect_t::apply()</a>, and <a class="el" href="npctalk__funcs_8cpp_source.html#l00111">talk_function::mission_success()</a>.</p>

</div>
</div>
<a id="a454c80bb5b4ca14591ff5ec7d595111a" name="a454c80bb5b4ca14591ff5ec7d595111a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a454c80bb5b4ca14591ff5ec7d595111a">&#9670;&nbsp;</a></span>init_buying()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="classitem__pricing.html">item_pricing</a> &gt; npc_trading::init_buying </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classplayer.html">player</a> &amp;&#160;</td>
          <td class="paramname"><em>buyer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classplayer.html">player</a> &amp;&#160;</td>
          <td class="paramname"><em>seller</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_npc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="npctrade_8cpp_source.html#l00148">148</a> of file <a class="el" href="npctrade_8cpp_source.html">npctrade.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>{</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    std::vector&lt;item_pricing&gt; <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <a class="code hl_class" href="classnpc.html">npc</a> *np_p = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classnpc.html">npc</a> *<span class="keyword">&gt;</span>( &amp;buyer );</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="keywordflow">if</span>( is_npc ) {</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>        np_p = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classnpc.html">npc</a> *<span class="keyword">&gt;</span>( &amp;seller );</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    }</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <a class="code hl_class" href="classnpc.html">npc</a> &amp;np = *np_p;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <a class="code hl_class" href="classfaction.html">faction</a> *fac = np.<a class="code hl_function" href="classnpc.html#a9ebaf7c38b4eb34255acc88302011ce0">get_faction</a>();</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <span class="keywordtype">double</span> adjust = <a class="code hl_function" href="namespacenpc__trading.html#ababcb005b907aad47d8fc1adcabf21de">net_price_adjustment</a>( buyer, seller );</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="keyword">const</span> <span class="keyword">auto</span> check_item = [fac, adjust, is_npc, &amp;np, &amp;<a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>, &amp;seller]( <a class="code hl_class" href="classitem__location.html">item_location</a> &amp;&amp;</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    loc, <span class="keywordtype">int</span> <a class="code hl_function" href="namespacedetail.html#ab2f84fb3de26acdac3fc63a2dce5ea5e">count</a> = 1 ) {</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        <a class="code hl_class" href="classitem.html">item</a> *it_ptr = loc.get_item();</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        <span class="keywordflow">if</span>( it_ptr == <span class="keyword">nullptr</span> || it_ptr-&gt;<a class="code hl_function" href="classitem.html#a4d5555082454b3cb192f59a70838c891">is_null</a>() ) {</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        }</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        <a class="code hl_class" href="classitem.html">item</a> &amp;it = *it_ptr;</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span> </div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>        <span class="comment">// Don&#39;t sell items we don&#39;t own.</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>        <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#a0b35b9066ad71987b77727af45d96059">is_owned_by</a>( seller ) ) {</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>        }</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> market_price = it.<a class="code hl_function" href="classitem.html#a910393f5651f273b5df0bdd576bef78d">price</a>( <span class="keyword">true</span> );</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        <span class="keywordtype">int</span> val = np.value( it, market_price );</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        <span class="keywordflow">if</span>( ( is_npc &amp;&amp; np.wants_to_sell( it, val, market_price ) ) ||</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>            np.wants_to_buy( it, val, market_price ) ) {</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>            <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>.emplace_back( <a class="code hl_function" href="namespaceavatar__action.html#a76ba74774376a08222b8cdcce08f7304">std::move</a>( loc ), val, <a class="code hl_function" href="namespacedetail.html#ab2f84fb3de26acdac3fc63a2dce5ea5e">count</a> );</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>            <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>.back().adjust_values( adjust, fac );</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        }</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    };</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <a class="code hl_typedef" href="inventory_8h.html#a1d1a58da8e9c617f38902ba44c72b6b2">invslice</a> slice = seller.<a class="code hl_variable" href="classCharacter.html#a3d69eddc0a03b21378fc68cc08d32c7f">inv</a>.<a class="code hl_function" href="classinventory.html#a51bfb1f66b7b07d630b403bf964e84f9">slice</a>();</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <span class="keywordflow">for</span>( <span class="keyword">auto</span> &amp;i : slice ) {</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        check_item( <a class="code hl_class" href="classitem__location.html">item_location</a>( seller, &amp;i-&gt;front() ), i-&gt;size() );</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    }</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span> </div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    <span class="keywordflow">if</span>( !seller.<a class="code hl_variable" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a>.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;NO_UNWIELD&quot;</span> ) ) {</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>        check_item( <a class="code hl_class" href="classitem__location.html">item_location</a>( seller, &amp;seller.<a class="code hl_variable" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> ), 1 );</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    }</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span> </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="comment">//nearby items owned by the NPC will only show up in</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="comment">//the trade window if the NPC is also a shopkeeper</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="keywordflow">if</span>( np.mission == <a class="code hl_enumvalue" href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6dac33d9490a5bc6bebca7f66a94524600c">NPC_MISSION_SHOPKEEP</a> ) {</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        <span class="keywordflow">for</span>( <a class="code hl_class" href="classmap__cursor.html">map_cursor</a> &amp;cursor : <a class="code hl_class" href="classmap__selector.html">map_selector</a>( seller.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), <a class="code hl_variable" href="cached__options_8cpp.html#a1467e25ae6a1c8f9d4489be4a8e014a3">PICKUP_RANGE</a> ) ) {</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>            <a class="code hl_function" href="npctrade_8cpp.html#a9df86e6da585282e8c6f89d752c5abfd">buy_helper</a>( cursor, check_item );</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        }</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    }</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <span class="keywordflow">for</span>( <a class="code hl_class" href="classvehicle__cursor.html">vehicle_cursor</a> &amp;cursor : <a class="code hl_class" href="classvehicle__selector.html">vehicle_selector</a>( seller.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), 1 ) ) {</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        <a class="code hl_function" href="npctrade_8cpp.html#a9df86e6da585282e8c6f89d752c5abfd">buy_helper</a>( cursor, check_item );</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    }</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span> </div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    <span class="keyword">const</span> <span class="keyword">auto</span> cmp = []( <span class="keyword">const</span> <a class="code hl_class" href="classitem__pricing.html">item_pricing</a> &amp; <a class="code hl_variable" href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>, <span class="keyword">const</span> <a class="code hl_class" href="classitem__pricing.html">item_pricing</a> &amp; <a class="code hl_variable" href="magic_8cpp.html#aa93a189fb7bbbf87be54bcc7bd11bb6f">b</a> ) {</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>        <span class="comment">// Sort items by category first, then name.</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="translations_8h.html#aa323a1324b9ad3f0c7dc65690aed09c6">localized_compare</a>( std::make_pair( <a class="code hl_variable" href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>.loc-&gt;get_category(), <a class="code hl_variable" href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>.loc-&gt;display_name() ),</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>                                  std::make_pair( <a class="code hl_variable" href="magic_8cpp.html#aa93a189fb7bbbf87be54bcc7bd11bb6f">b</a>.loc-&gt;get_category(), <a class="code hl_variable" href="magic_8cpp.html#aa93a189fb7bbbf87be54bcc7bd11bb6f">b</a>.loc-&gt;display_name() ) );</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    };</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    std::sort( <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>.begin(), <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>.end(), cmp );</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>}</div>
<div class="ttc" id="acached__options_8cpp_html_a1467e25ae6a1c8f9d4489be4a8e014a3"><div class="ttname"><a href="cached__options_8cpp.html#a1467e25ae6a1c8f9d4489be4a8e014a3">PICKUP_RANGE</a></div><div class="ttdeci">int PICKUP_RANGE</div><div class="ttdoc">Items on the map with at most this distance to the player are considered available for crafting,...</div><div class="ttdef"><b>Definition:</b> <a href="cached__options_8cpp_source.html#l00017">cached_options.cpp:17</a></div></div>
<div class="ttc" id="aclassCharacter_html_a3d69eddc0a03b21378fc68cc08d32c7f"><div class="ttname"><a href="classCharacter.html#a3d69eddc0a03b21378fc68cc08d32c7f">Character::inv</a></div><div class="ttdeci">inventory inv</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01583">character.h:1583</a></div></div>
<div class="ttc" id="aclassCharacter_html_ad24859164517ed6e392e21df69527199"><div class="ttname"><a href="classCharacter.html#ad24859164517ed6e392e21df69527199">Character::pos</a></div><div class="ttdeci">const tripoint &amp; pos() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00707">character.cpp:707</a></div></div>
<div class="ttc" id="aclassCharacter_html_ae68b7a6565646ba662e448bded8b6599"><div class="ttname"><a href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">Character::weapon</a></div><div class="ttdeci">item weapon</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01585">character.h:1585</a></div></div>
<div class="ttc" id="aclassfaction_html"><div class="ttname"><a href="classfaction.html">faction</a></div><div class="ttdef"><b>Definition:</b> <a href="faction_8h_source.html#l00095">faction.h:96</a></div></div>
<div class="ttc" id="aclassinventory_html_a51bfb1f66b7b07d630b403bf964e84f9"><div class="ttname"><a href="classinventory.html#a51bfb1f66b7b07d630b403bf964e84f9">inventory::slice</a></div><div class="ttdeci">invslice slice()</div><div class="ttdef"><b>Definition:</b> <a href="inventory_8cpp_source.html#l00133">inventory.cpp:133</a></div></div>
<div class="ttc" id="aclassitem__location_html"><div class="ttname"><a href="classitem__location.html">item_location</a></div><div class="ttdoc">A lightweight handle to an item independent of it's location Unlike a raw pointer can be (de-)seriali...</div><div class="ttdef"><b>Definition:</b> <a href="item__location_8h_source.html#l00022">item_location.h:23</a></div></div>
<div class="ttc" id="aclassitem__pricing_html"><div class="ttname"><a href="classitem__pricing.html">item_pricing</a></div><div class="ttdef"><b>Definition:</b> <a href="npctrade_8h_source.html#l00026">npctrade.h:27</a></div></div>
<div class="ttc" id="aclassitem_html"><div class="ttname"><a href="classitem.html">item</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00175">item.h:176</a></div></div>
<div class="ttc" id="aclassitem_html_a0b35b9066ad71987b77727af45d96059"><div class="ttname"><a href="classitem.html#a0b35b9066ad71987b77727af45d96059">item::is_owned_by</a></div><div class="ttdeci">bool is_owned_by(const Character &amp;c, bool available_to_take=false) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01239">item.cpp:1239</a></div></div>
<div class="ttc" id="aclassitem_html_a4d5555082454b3cb192f59a70838c891"><div class="ttname"><a href="classitem.html#a4d5555082454b3cb192f59a70838c891">item::is_null</a></div><div class="ttdeci">bool is_null() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00729">item.cpp:729</a></div></div>
<div class="ttc" id="aclassitem_html_a910393f5651f273b5df0bdd576bef78d"><div class="ttname"><a href="classitem.html#a910393f5651f273b5df0bdd576bef78d">item::price</a></div><div class="ttdeci">int price(bool practical) const</div><div class="ttdoc">Returns the monetary value of an item.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l04807">item.cpp:4807</a></div></div>
<div class="ttc" id="aclassitem_html_aaa5aeb6f838927babb10ede535cf2a73"><div class="ttname"><a href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">item::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05192">item.cpp:5192</a></div></div>
<div class="ttc" id="aclassmap__cursor_html"><div class="ttname"><a href="classmap__cursor.html">map_cursor</a></div><div class="ttdef"><b>Definition:</b> <a href="map__selector_8h_source.html#l00010">map_selector.h:11</a></div></div>
<div class="ttc" id="aclassmap__selector_html"><div class="ttname"><a href="classmap__selector.html">map_selector</a></div><div class="ttdef"><b>Definition:</b> <a href="map__selector_8h_source.html#l00020">map_selector.h:21</a></div></div>
<div class="ttc" id="aclassnpc_html"><div class="ttname"><a href="classnpc.html">npc</a></div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00780">npc.h:781</a></div></div>
<div class="ttc" id="aclassnpc_html_a9ebaf7c38b4eb34255acc88302011ce0"><div class="ttname"><a href="classnpc.html#a9ebaf7c38b4eb34255acc88302011ce0">npc::get_faction</a></div><div class="ttdeci">faction * get_faction() const override</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l00494">npc.cpp:494</a></div></div>
<div class="ttc" id="aclassvehicle__cursor_html"><div class="ttname"><a href="classvehicle__cursor.html">vehicle_cursor</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle__selector_8h_source.html#l00013">vehicle_selector.h:14</a></div></div>
<div class="ttc" id="aclassvehicle__selector_html"><div class="ttname"><a href="classvehicle__selector.html">vehicle_selector</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle__selector_8h_source.html#l00021">vehicle_selector.h:22</a></div></div>
<div class="ttc" id="ainventory_8h_html_a1d1a58da8e9c617f38902ba44c72b6b2"><div class="ttname"><a href="inventory_8h.html#a1d1a58da8e9c617f38902ba44c72b6b2">invslice</a></div><div class="ttdeci">std::vector&lt; std::list&lt; item &gt; * &gt; invslice</div><div class="ttdef"><b>Definition:</b> <a href="inventory_8h_source.html#l00032">inventory.h:32</a></div></div>
<div class="ttc" id="amagic_8cpp_html_a188caae18b60b66f9f44214c7e28ac1f"><div class="ttname"><a href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a></div><div class="ttdeci">constexpr double a</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01029">magic.cpp:1029</a></div></div>
<div class="ttc" id="amagic_8cpp_html_aa93a189fb7bbbf87be54bcc7bd11bb6f"><div class="ttname"><a href="magic_8cpp.html#aa93a189fb7bbbf87be54bcc7bd11bb6f">b</a></div><div class="ttdeci">constexpr double b</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01030">magic.cpp:1030</a></div></div>
<div class="ttc" id="anamespaceavatar__action_html_a76ba74774376a08222b8cdcce08f7304"><div class="ttname"><a href="namespaceavatar__action.html#a76ba74774376a08222b8cdcce08f7304">avatar_action::move</a></div><div class="ttdeci">bool move(avatar &amp;you, map &amp;m, const tripoint &amp;d)</div><div class="ttdef"><b>Definition:</b> <a href="avatar__action_8cpp_source.html#l00090">avatar_action.cpp:90</a></div></div>
<div class="ttc" id="anamespacedetail_1_1digits_html_aad69d2373aa047bdd9e81494bf3da5ae"><div class="ttname"><a href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">detail::digits::result</a></div><div class="ttdeci">result</div><div class="ttdef"><b>Definition:</b> <a href="fmtlib__format-inl_8h_source.html#l01626">fmtlib_format-inl.h:1626</a></div></div>
<div class="ttc" id="anamespacedetail_html_ab2f84fb3de26acdac3fc63a2dce5ea5e"><div class="ttname"><a href="namespacedetail.html#ab2f84fb3de26acdac3fc63a2dce5ea5e">detail::count</a></div><div class="ttdeci">constexpr size_t count()</div><div class="ttdef"><b>Definition:</b> <a href="fmtlib__core_8h_source.html#l01073">fmtlib_core.h:1073</a></div></div>
<div class="ttc" id="anamespacenpc__trading_html_ababcb005b907aad47d8fc1adcabf21de"><div class="ttname"><a href="namespacenpc__trading.html#ababcb005b907aad47d8fc1adcabf21de">npc_trading::net_price_adjustment</a></div><div class="ttdeci">double net_price_adjustment(const player &amp;buyer, const player &amp;seller)</div><div class="ttdef"><b>Definition:</b> <a href="npctrade_8cpp_source.html#l00121">npctrade.cpp:121</a></div></div>
<div class="ttc" id="anpc_8h_html_a1cfe07d375f7cf0b8c656a5bcae8fc6dac33d9490a5bc6bebca7f66a94524600c"><div class="ttname"><a href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6dac33d9490a5bc6bebca7f66a94524600c">NPC_MISSION_SHOPKEEP</a></div><div class="ttdeci">@ NPC_MISSION_SHOPKEEP</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00182">npc.h:182</a></div></div>
<div class="ttc" id="anpctrade_8cpp_html_a9df86e6da585282e8c6f89d752c5abfd"><div class="ttname"><a href="npctrade_8cpp.html#a9df86e6da585282e8c6f89d752c5abfd">buy_helper</a></div><div class="ttdeci">void buy_helper(T &amp;src, Callback cb)</div><div class="ttdef"><b>Definition:</b> <a href="npctrade_8cpp_source.html#l00139">npctrade.cpp:139</a></div></div>
<div class="ttc" id="atranslations_8h_html_aa323a1324b9ad3f0c7dc65690aed09c6"><div class="ttname"><a href="translations_8h.html#aa323a1324b9ad3f0c7dc65690aed09c6">localized_compare</a></div><div class="ttdeci">constexpr localized_comparator localized_compare</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00342">translations.h:342</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="magic_8cpp_source.html#l01029">a</a>, <a class="el" href="magic_8cpp_source.html#l01030">b</a>, <a class="el" href="npctrade_8cpp_source.html#l00139">buy_helper()</a>, <a class="el" href="fmtlib__core_8h_source.html#l01073">detail::count()</a>, <a class="el" href="npc_8cpp_source.html#l00494">npc::get_faction()</a>, <a class="el" href="item_8cpp_source.html#l05192">item::has_flag()</a>, <a class="el" href="character_8h_source.html#l01583">Character::inv</a>, <a class="el" href="item_8cpp_source.html#l00729">item::is_null()</a>, <a class="el" href="item_8cpp_source.html#l01239">item::is_owned_by()</a>, <a class="el" href="translations_8h_source.html#l00342">localized_compare</a>, <a class="el" href="npc_8h_source.html#l01325">npc::mission</a>, <a class="el" href="avatar__action_8cpp_source.html#l00090">avatar_action::move()</a>, <a class="el" href="npctrade_8cpp_source.html#l00121">net_price_adjustment()</a>, <a class="el" href="npc_8h_source.html#l00182">NPC_MISSION_SHOPKEEP</a>, <a class="el" href="cached__options_8cpp_source.html#l00017">PICKUP_RANGE</a>, <a class="el" href="character_8cpp_source.html#l00707">Character::pos()</a>, <a class="el" href="item_8cpp_source.html#l04807">item::price()</a>, <a class="el" href="inventory_8cpp_source.html#l00133">inventory::slice()</a>, <a class="el" href="npc_8cpp_source.html#l01735">npc::value()</a>, <a class="el" href="npc_8cpp_source.html#l01592">npc::wants_to_buy()</a>, <a class="el" href="npc_8cpp_source.html#l01569">npc::wants_to_sell()</a>, and <a class="el" href="character_8h_source.html#l01585">Character::weapon</a>.</p>

<p class="reference">Referenced by <a class="el" href="npctrade_8cpp_source.html#l00250">trading_window::setup_trade()</a>.</p>

</div>
</div>
<a id="a4b3f78b67eaf84ceddde10b1f8bac191" name="a4b3f78b67eaf84ceddde10b1f8bac191"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b3f78b67eaf84ceddde10b1f8bac191">&#9670;&nbsp;</a></span>init_selling()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="classitem__pricing.html">item_pricing</a> &gt; npc_trading::init_selling </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classnpc.html">npc</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="npctrade_8cpp_source.html#l00096">96</a> of file <a class="el" href="npctrade_8cpp_source.html">npctrade.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>{</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    std::vector&lt;item_pricing&gt; <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <a class="code hl_typedef" href="inventory_8h.html#a1d1a58da8e9c617f38902ba44c72b6b2">invslice</a> slice = np.inv.slice();</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <span class="keywordflow">for</span>( <span class="keyword">auto</span> &amp;i : slice ) {</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>        <a class="code hl_class" href="classitem.html">item</a> &amp;it = i-&gt;front();</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> price = it.<a class="code hl_function" href="classitem.html#a910393f5651f273b5df0bdd576bef78d">price</a>( <span class="keyword">true</span> );</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>        <span class="keywordtype">int</span> val = np.value( it );</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>        <span class="keywordflow">if</span>( np.wants_to_sell( it, val, price ) ) {</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>            <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>.emplace_back( np, i-&gt;front(), val, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( i-&gt;size() ) );</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>        }</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    }</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span> </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    <span class="keywordflow">if</span>(</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>        np.will_exchange_items_freely() &amp;&amp;</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>        !np.weapon.is_null() &amp;&amp;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>        !np.weapon.has_flag( <span class="stringliteral">&quot;NO_UNWIELD&quot;</span> )</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    ) {</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>.emplace_back( np, np.weapon, np.value( np.weapon ), <span class="keyword">false</span> );</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    }</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="item_8cpp_source.html#l05192">item::has_flag()</a>, <a class="el" href="character_8h_source.html#l01583">Character::inv</a>, <a class="el" href="item_8cpp_source.html#l00729">item::is_null()</a>, <a class="el" href="item_8cpp_source.html#l04807">item::price()</a>, <a class="el" href="inventory_8cpp_source.html#l00133">inventory::slice()</a>, <a class="el" href="npc_8cpp_source.html#l01735">npc::value()</a>, <a class="el" href="npc_8cpp_source.html#l01569">npc::wants_to_sell()</a>, <a class="el" href="character_8h_source.html#l01585">Character::weapon</a>, and <a class="el" href="npc_8cpp_source.html#l01609">npc::will_exchange_items_freely()</a>.</p>

<p class="reference">Referenced by <a class="el" href="npctalk__funcs_8cpp_source.html#l00527">talk_function::give_equipment()</a>.</p>

</div>
</div>
<a id="ababcb005b907aad47d8fc1adcabf21de" name="ababcb005b907aad47d8fc1adcabf21de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ababcb005b907aad47d8fc1adcabf21de">&#9670;&nbsp;</a></span>net_price_adjustment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double npc_trading::net_price_adjustment </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classplayer.html">player</a> &amp;&#160;</td>
          <td class="paramname"><em>buyer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classplayer.html">player</a> &amp;&#160;</td>
          <td class="paramname"><em>seller</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
NPC Intelligence slightly increases bartering price changes, relative to your INT NPC Barter increases bartering price changes, relative to your BARTER Intelligence slightly increases bartering price changes, relative to NPC INT Barter increases bartering price changes, relative to NPC BARTER 
<p class="definition">Definition at line <a class="el" href="npctrade_8cpp_source.html#l00121">121</a> of file <a class="el" href="npctrade_8cpp_source.html">npctrade.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>{</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <span class="comment">// Adjust the prices based on your barter skill.</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    <span class="comment">// cap adjustment so nothing is ever sold below value</span><span class="comment"></span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span><span class="comment">    ///\EFFECT_INT_NPC slightly increases bartering price changes, relative to your INT</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span><span class="comment">    ///\EFFECT_BARTER_NPC increases bartering price changes, relative to your BARTER</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span><span class="comment">    ///\EFFECT_INT slightly increases bartering price changes, relative to NPC INT</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span><span class="comment">    ///\EFFECT_BARTER increases bartering price changes, relative to NPC BARTER</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span><span class="comment"></span>    <span class="keywordtype">double</span> adjust = 0.05 * ( seller.<a class="code hl_variable" href="classCharacter.html#a994c83d61054215e81a6e87478d81203">int_cur</a> - buyer.<a class="code hl_variable" href="classCharacter.html#a994c83d61054215e81a6e87478d81203">int_cur</a> ) +</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>                    <a class="code hl_function" href="skill_8cpp.html#acacb5720925a6d49c42cecc62c62b8dc">price_adjustment</a>( seller.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="npctrade_8cpp.html#aa6b044cf23b3ec0ad31412a94dff1546">skill_barter</a> ) -</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>                                      buyer.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="npctrade_8cpp.html#aa6b044cf23b3ec0ad31412a94dff1546">skill_barter</a> ) );</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    <span class="keywordflow">return</span>( std::max( adjust, 1.0 ) );</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>}</div>
<div class="ttc" id="aclassCharacter_html_a994c83d61054215e81a6e87478d81203"><div class="ttname"><a href="classCharacter.html#a994c83d61054215e81a6e87478d81203">Character::int_cur</a></div><div class="ttdeci">int int_cur</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00306">character.h:306</a></div></div>
<div class="ttc" id="aclassCharacter_html_afa95fe499ca6b55ab97f1b442a4c95c5"><div class="ttname"><a href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">Character::get_skill_level</a></div><div class="ttdeci">int get_skill_level(const skill_id &amp;ident) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03327">character.cpp:3327</a></div></div>
<div class="ttc" id="anpctrade_8cpp_html_aa6b044cf23b3ec0ad31412a94dff1546"><div class="ttname"><a href="npctrade_8cpp.html#aa6b044cf23b3ec0ad31412a94dff1546">skill_barter</a></div><div class="ttdeci">static const skill_id skill_barter(&quot;barter&quot;)</div></div>
<div class="ttc" id="askill_8cpp_html_acacb5720925a6d49c42cecc62c62b8dc"><div class="ttname"><a href="skill_8cpp.html#acacb5720925a6d49c42cecc62c62b8dc">price_adjustment</a></div><div class="ttdeci">double price_adjustment(int barter_skill)</div><div class="ttdef"><b>Definition:</b> <a href="skill_8cpp_source.html#l00401">skill.cpp:401</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="character_8cpp_source.html#l03327">Character::get_skill_level()</a>, <a class="el" href="character_8h_source.html#l00306">Character::int_cur</a>, <a class="el" href="skill_8cpp_source.html#l00401">price_adjustment()</a>, and <a class="el" href="npctrade_8cpp.html#aa6b044cf23b3ec0ad31412a94dff1546">skill_barter</a>.</p>

<p class="reference">Referenced by <a class="el" href="npctrade_8cpp_source.html#l00148">init_buying()</a>.</p>

</div>
</div>
<a id="a9a7dbd65b9ae311c79c92b57c1b134b4" name="a9a7dbd65b9ae311c79c92b57c1b134b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a7dbd65b9ae311c79c92b57c1b134b4">&#9670;&nbsp;</a></span>pay_npc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool npc_trading::pay_npc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classnpc.html">npc</a> &amp;&#160;</td>
          <td class="paramname"><em>np</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cost</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="npctalk__funcs_8cpp_source.html#l00890">890</a> of file <a class="el" href="npctalk__funcs_8cpp_source.html">npctalk_funcs.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>{</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>    <span class="keywordflow">if</span>( np.<a class="code hl_variable" href="classnpc.html#ae17fa770d3d2ecbb89371e334c21ea6b">op_of_u</a>.<a class="code hl_variable" href="structnpc__opinion.html#a544114b24a1332d5fc31b1ec814684bd">owed</a> &gt;= cost ) {</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>        np.<a class="code hl_variable" href="classnpc.html#ae17fa770d3d2ecbb89371e334c21ea6b">op_of_u</a>.<a class="code hl_variable" href="structnpc__opinion.html#a544114b24a1332d5fc31b1ec814684bd">owed</a> -= cost;</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>    }</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span> </div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacenpc__trading.html#a0ec2aaaf5437ced34ea57f9bd818259d">npc_trading::trade</a>( np, cost, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Pay:&quot;</span> ) );</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>}</div>
<div class="ttc" id="aclassnpc_html_ae17fa770d3d2ecbb89371e334c21ea6b"><div class="ttname"><a href="classnpc.html#ae17fa770d3d2ecbb89371e334c21ea6b">npc::op_of_u</a></div><div class="ttdeci">npc_opinion op_of_u</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01328">npc.h:1328</a></div></div>
<div class="ttc" id="anamespacenpc__trading_html_a0ec2aaaf5437ced34ea57f9bd818259d"><div class="ttname"><a href="namespacenpc__trading.html#a0ec2aaaf5437ced34ea57f9bd818259d">npc_trading::trade</a></div><div class="ttdeci">bool trade(npc &amp;p, int cost, const std::string &amp;deal)</div><div class="ttdef"><b>Definition:</b> <a href="npctrade_8cpp_source.html#l00699">npctrade.cpp:699</a></div></div>
<div class="ttc" id="astructnpc__opinion_html_a544114b24a1332d5fc31b1ec814684bd"><div class="ttname"><a href="structnpc__opinion.html#a544114b24a1332d5fc31b1ec814684bd">npc_opinion::owed</a></div><div class="ttdeci">int owed</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00244">npc.h:244</a></div></div>
<div class="ttc" id="atranslations_8h_html_aa829053017e23ef22d44dccecba63a34"><div class="ttname"><a href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a></div><div class="ttdeci">#define _(msg)</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00116">translations.h:116</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="npc_8h_source.html#l01328">npc::op_of_u</a>, <a class="el" href="npc_8h_source.html#l00244">npc_opinion::owed</a>, and <a class="el" href="npctrade_8cpp_source.html#l00699">trade()</a>.</p>

<p class="reference">Referenced by <a class="el" href="npctalk__funcs_8cpp_source.html#l00451">talk_function::bionic_install()</a>, <a class="el" href="npctalk__funcs_8cpp_source.html#l00474">talk_function::bionic_remove()</a>, <a class="el" href="npctalk_8cpp_source.html#l02045">talk_effect_fun_t::set_u_buy_item()</a>, <a class="el" href="npctalk_8cpp_source.html#l02378">talk_effect_fun_t::set_u_buy_monster()</a>, and <a class="el" href="npctalk__funcs_8cpp_source.html#l00900">talk_function::start_training()</a>.</p>

</div>
</div>
<a id="a0ec2aaaf5437ced34ea57f9bd818259d" name="a0ec2aaaf5437ced34ea57f9bd818259d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ec2aaaf5437ced34ea57f9bd818259d">&#9670;&nbsp;</a></span>trade()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool npc_trading::trade </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classnpc.html">npc</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cost</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>deal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="npctrade_8cpp_source.html#l00699">699</a> of file <a class="el" href="npctrade_8cpp_source.html">npctrade.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>{</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>    np.shop_restock();</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>    <span class="comment">//np.drop_items( np.weight_carried() - np.weight_capacity(),</span></div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>    <span class="comment">//               np.volume_carried() - np.volume_capacity() );</span></div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>    np.drop_invalid_inventory();</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span> </div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>    <a class="code hl_class" href="classtrading__window.html">trading_window</a> trade_win;</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>    trade_win.<a class="code hl_function" href="classtrading__window.html#ac448968d3d4042c8e2a972d465889330">setup_trade</a>( cost, np );</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span> </div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>    <span class="keywordtype">bool</span> traded = trade_win.<a class="code hl_function" href="classtrading__window.html#abe055a8bf5a93fdbb38577e2b4f24810">perform_trade</a>( np, deal );</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>    <span class="keywordflow">if</span>( traded ) {</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>        <span class="keywordtype">int</span> practice = 0;</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span> </div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>        std::list&lt;item_location *&gt; from_map;</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span> </div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>        <a class="code hl_function" href="namespacenpc__trading.html#a83aae7d987be337e0dd70f31454183a1">npc_trading::transfer_items</a>( trade_win.<a class="code hl_variable" href="classtrading__window.html#a3331702b7faae6eef482a3397d40079d">yours</a>, <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;u, np, from_map, <span class="keyword">false</span> );</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>        <a class="code hl_function" href="namespacenpc__trading.html#a83aae7d987be337e0dd70f31454183a1">npc_trading::transfer_items</a>( trade_win.<a class="code hl_variable" href="classtrading__window.html#aa729d766409cfe02411ddab2ac16fd0a">theirs</a>, np, <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;u, from_map, <span class="keyword">true</span> );</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span> </div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>        <span class="keywordflow">for</span>( <a class="code hl_class" href="classitem__location.html">item_location</a> *loc_ptr : from_map ) {</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>            <span class="keywordflow">if</span>( !loc_ptr ) {</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>            }</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>            <a class="code hl_class" href="classitem.html">item</a> *it = loc_ptr-&gt;get_item();</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>            <span class="keywordflow">if</span>( !it ) {</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>            }</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>            <span class="keywordflow">if</span>( it-&gt;<a class="code hl_function" href="classitem.html#a478ecf81e48540e1ba39de33df968c43">has_var</a>( <span class="stringliteral">&quot;trade_charges&quot;</span> ) &amp;&amp; it-&gt;<a class="code hl_function" href="classitem.html#a40963a016376016eb408bdb9dbb94388">count_by_charges</a>() ) {</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>                it-&gt;<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a> -= <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( it-&gt;<a class="code hl_function" href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">get_var</a>( <span class="stringliteral">&quot;trade_charges&quot;</span>, 0 ) );</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>                <span class="keywordflow">if</span>( it-&gt;<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a> &lt;= 0 ) {</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>                    loc_ptr-&gt;remove_item();</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>                    it-&gt;<a class="code hl_function" href="classitem.html#aa24fc115fb6cd1124efec30970cfcd9b">erase_var</a>( <span class="stringliteral">&quot;trade_charges&quot;</span> );</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>                }</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it-&gt;<a class="code hl_function" href="classitem.html#a478ecf81e48540e1ba39de33df968c43">has_var</a>( <span class="stringliteral">&quot;trade_amount&quot;</span> ) ) {</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>                loc_ptr-&gt;remove_item();</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>            }</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>        }</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span> </div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>        <span class="comment">// NPCs will remember debts, to the limit that they&#39;ll extend credit or previous debts</span></div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>        <span class="keywordflow">if</span>( !np.will_exchange_items_freely() ) {</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>            trade_win.<a class="code hl_function" href="classtrading__window.html#a447d8bb5ed14df8549c8e3817c116281">update_npc_owed</a>( np );</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>            <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;u.practice( <a class="code hl_variable" href="npctrade_8cpp.html#aa6b044cf23b3ec0ad31412a94dff1546">skill_barter</a>, practice / 10000 );</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>        }</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>    }</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>    <span class="keywordflow">return</span> traded;</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>}</div>
<div class="ttc" id="aclassitem_html_a0b12108a604ac9d940716bb8f1368cf5"><div class="ttname"><a href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">item::get_var</a></div><div class="ttdeci">double get_var(const std::string &amp;name, double default_value) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01022">item.cpp:1022</a></div></div>
<div class="ttc" id="aclassitem_html_a40963a016376016eb408bdb9dbb94388"><div class="ttname"><a href="classitem.html#a40963a016376016eb408bdb9dbb94388">item::count_by_charges</a></div><div class="ttdeci">bool count_by_charges() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05855">item.cpp:5855</a></div></div>
<div class="ttc" id="aclassitem_html_a478ecf81e48540e1ba39de33df968c43"><div class="ttname"><a href="classitem.html#a478ecf81e48540e1ba39de33df968c43">item::has_var</a></div><div class="ttdeci">bool has_var(const std::string &amp;name) const</div><div class="ttdoc">Whether the variable is defined at all.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01067">item.cpp:1067</a></div></div>
<div class="ttc" id="aclassitem_html_a6bfb92ab5d41e0eb3a1da160fac71b0e"><div class="ttname"><a href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">item::charges</a></div><div class="ttdeci">int charges</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02195">item.h:2195</a></div></div>
<div class="ttc" id="aclassitem_html_aa24fc115fb6cd1124efec30970cfcd9b"><div class="ttname"><a href="classitem.html#aa24fc115fb6cd1124efec30970cfcd9b">item::erase_var</a></div><div class="ttdeci">void erase_var(const std::string &amp;name)</div><div class="ttdoc">Erase the value of the given variable.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01072">item.cpp:1072</a></div></div>
<div class="ttc" id="aclasstrading__window_html"><div class="ttname"><a href="classtrading__window.html">trading_window</a></div><div class="ttdef"><b>Definition:</b> <a href="npctrade_8h_source.html#l00054">npctrade.h:55</a></div></div>
<div class="ttc" id="aclasstrading__window_html_a3331702b7faae6eef482a3397d40079d"><div class="ttname"><a href="classtrading__window.html#a3331702b7faae6eef482a3397d40079d">trading_window::yours</a></div><div class="ttdeci">std::vector&lt; item_pricing &gt; yours</div><div class="ttdef"><b>Definition:</b> <a href="npctrade_8h_source.html#l00059">npctrade.h:59</a></div></div>
<div class="ttc" id="aclasstrading__window_html_a447d8bb5ed14df8549c8e3817c116281"><div class="ttname"><a href="classtrading__window.html#a447d8bb5ed14df8549c8e3817c116281">trading_window::update_npc_owed</a></div><div class="ttdeci">void update_npc_owed(npc &amp;np)</div><div class="ttdef"><b>Definition:</b> <a href="npctrade_8cpp_source.html#l00690">npctrade.cpp:690</a></div></div>
<div class="ttc" id="aclasstrading__window_html_aa729d766409cfe02411ddab2ac16fd0a"><div class="ttname"><a href="classtrading__window.html#aa729d766409cfe02411ddab2ac16fd0a">trading_window::theirs</a></div><div class="ttdeci">std::vector&lt; item_pricing &gt; theirs</div><div class="ttdef"><b>Definition:</b> <a href="npctrade_8h_source.html#l00058">npctrade.h:58</a></div></div>
<div class="ttc" id="aclasstrading__window_html_abe055a8bf5a93fdbb38577e2b4f24810"><div class="ttname"><a href="classtrading__window.html#abe055a8bf5a93fdbb38577e2b4f24810">trading_window::perform_trade</a></div><div class="ttdeci">bool perform_trade(npc &amp;np, const std::string &amp;deal)</div><div class="ttdef"><b>Definition:</b> <a href="npctrade_8cpp_source.html#l00500">npctrade.cpp:500</a></div></div>
<div class="ttc" id="aclasstrading__window_html_ac448968d3d4042c8e2a972d465889330"><div class="ttname"><a href="classtrading__window.html#ac448968d3d4042c8e2a972d465889330">trading_window::setup_trade</a></div><div class="ttdeci">void setup_trade(int cost, npc &amp;np)</div><div class="ttdef"><b>Definition:</b> <a href="npctrade_8cpp_source.html#l00250">npctrade.cpp:250</a></div></div>
<div class="ttc" id="agame_8cpp_html_abeb98e93502d73818b4a73fabe191bc1"><div class="ttname"><a href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a></div><div class="ttdeci">std::unique_ptr&lt; game &gt; g</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l00267">game.cpp:267</a></div></div>
<div class="ttc" id="anamespacenpc__trading_html_a83aae7d987be337e0dd70f31454183a1"><div class="ttname"><a href="namespacenpc__trading.html#a83aae7d987be337e0dd70f31454183a1">npc_trading::transfer_items</a></div><div class="ttdeci">void transfer_items(std::vector&lt; item_pricing &gt; &amp;stuff, player &amp;giver, player &amp;receiver, std::list&lt; item_location * &gt; &amp;from_map, bool npc_gives)</div><div class="ttdef"><b>Definition:</b> <a href="npctrade_8cpp_source.html#l00044">npctrade.cpp:44</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="item_8h_source.html#l02195">item::charges</a>, <a class="el" href="item_8cpp_source.html#l05855">item::count_by_charges()</a>, <a class="el" href="character_8cpp_source.html#l03179">Character::drop_invalid_inventory()</a>, <a class="el" href="item_8cpp_source.html#l01072">item::erase_var()</a>, <a class="el" href="game_8cpp_source.html#l00267">g</a>, <a class="el" href="item_8cpp_source.html#l01022">item::get_var()</a>, <a class="el" href="item_8cpp_source.html#l01067">item::has_var()</a>, <a class="el" href="npctrade_8cpp_source.html#l00500">trading_window::perform_trade()</a>, <a class="el" href="npctrade_8cpp_source.html#l00250">trading_window::setup_trade()</a>, <a class="el" href="npc_8cpp_source.html#l01662">npc::shop_restock()</a>, <a class="el" href="npctrade_8cpp.html#aa6b044cf23b3ec0ad31412a94dff1546">skill_barter</a>, <a class="el" href="npctrade_8h_source.html#l00058">trading_window::theirs</a>, <a class="el" href="npctrade_8cpp_source.html#l00044">transfer_items()</a>, <a class="el" href="npctrade_8cpp_source.html#l00690">trading_window::update_npc_owed()</a>, <a class="el" href="npc_8cpp_source.html#l01609">npc::will_exchange_items_freely()</a>, and <a class="el" href="npctrade_8h_source.html#l00059">trading_window::yours</a>.</p>

<p class="reference">Referenced by <a class="el" href="npctalk__funcs_8cpp_source.html#l00171">talk_function::mission_reward()</a>, <a class="el" href="npctalk__funcs_8cpp_source.html#l00890">pay_npc()</a>, and <a class="el" href="npctalk__funcs_8cpp_source.html#l00209">talk_function::start_trade()</a>.</p>

</div>
</div>
<a id="a83aae7d987be337e0dd70f31454183a1" name="a83aae7d987be337e0dd70f31454183a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83aae7d987be337e0dd70f31454183a1">&#9670;&nbsp;</a></span>transfer_items()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void npc_trading::transfer_items </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="classitem__pricing.html">item_pricing</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>stuff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classplayer.html">player</a> &amp;&#160;</td>
          <td class="paramname"><em>giver</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classplayer.html">player</a> &amp;&#160;</td>
          <td class="paramname"><em>receiver</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::list&lt; <a class="el" href="classitem__location.html">item_location</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>from_map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>npc_gives</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="npctrade_8cpp_source.html#l00044">44</a> of file <a class="el" href="npctrade_8cpp_source.html">npctrade.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>{</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    <span class="keywordflow">for</span>( <a class="code hl_class" href="classitem__pricing.html">item_pricing</a> &amp;ip : stuff ) {</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>        <span class="keywordflow">if</span>( !ip.selected ) {</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>        }</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>        <span class="keywordflow">if</span>( ip.loc.get_item() == <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>            <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Null item being traded in npc_trading::transfer_items&quot;</span> );</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>        }</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>        <a class="code hl_class" href="classitem.html">item</a> gift = *ip.loc.get_item();</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>        gift.<a class="code hl_function" href="classitem.html#aa51b9b2950e9ea68811bffb5635911c6">set_owner</a>( receiver );</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>        <span class="keywordtype">int</span> charges = npc_gives ? ip.u_charges : ip.npc_charges;</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>        <span class="keywordtype">int</span> <a class="code hl_function" href="namespacedetail.html#ab2f84fb3de26acdac3fc63a2dce5ea5e">count</a> = npc_gives ? ip.u_has : ip.npc_has;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>        <span class="keywordflow">if</span>( ip.charges ) {</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            gift.<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a> = charges;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>            receiver.<a class="code hl_function" href="classCharacter.html#a611bd51d6d4fa9c119787f2fbc6bdd52">i_add</a>( gift );</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>            <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_function" href="namespacedetail.html#ab2f84fb3de26acdac3fc63a2dce5ea5e">count</a>; i++ ) {</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>                receiver.<a class="code hl_function" href="classCharacter.html#a611bd51d6d4fa9c119787f2fbc6bdd52">i_add</a>( gift );</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>            }</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>        }</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>        <span class="keywordflow">if</span>( ip.loc.where() == <a class="code hl_enumvalue" href="classitem__location.html#a038e108475b9fb4f9833268f5fa2888daa956161a69928cd130a889b88082fb6e">item_location::type::character</a> ) {</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>            <span class="keyword">const</span> <span class="keyword">auto</span> filter = [&amp;]( <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp; <a class="code hl_class" href="classitem.html">item</a> ) <span class="comment">//To make sure that we are removing proper item</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>            -&gt;<span class="keywordtype">bool</span> {</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>                <span class="keywordflow">return</span> <a class="code hl_class" href="classitem.html">item</a>.<a class="code hl_function" href="classitem.html#a31a0fa72add9cbbffc189b0eab0b34c0">stacks_with</a>( gift, <span class="keyword">true</span> );</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>            };</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>            <span class="keywordflow">if</span>( ip.charges &gt; 0 ) {</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>                giver.<a class="code hl_function" href="classCharacter.html#a3d0ec2b4e80527bd2daad576c2bbb187">use_charges</a>( gift.<a class="code hl_function" href="classitem.html#aa79dad64e1ef6347219be2f8666e2752">typeId</a>(), charges, filter );</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ip.count &gt; 0 ) {</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>                <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_function" href="namespacedetail.html#ab2f84fb3de26acdac3fc63a2dce5ea5e">count</a>; i++ ) {</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span> </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>                    giver.<a class="code hl_function" href="classCharacter.html#a7cb114203e03014f9834a10fa4bff24e">use_amount</a>( gift.<a class="code hl_function" href="classitem.html#aa79dad64e1ef6347219be2f8666e2752">typeId</a>(), 1, filter );</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>                }</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>            }</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>            <span class="keywordflow">if</span>( ip.charges &gt; 0 ) {</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>                ip.loc.get_item()-&gt;set_var( <span class="stringliteral">&quot;trade_charges&quot;</span>, charges );</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>                ip.loc.get_item()-&gt;set_var( <span class="stringliteral">&quot;trade_amount&quot;</span>, 1 );</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>            }</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>            from_map.push_back( &amp;ip.loc );</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>        }</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    }</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>}</div>
<div class="ttc" id="aclassCharacter_html_a3d0ec2b4e80527bd2daad576c2bbb187"><div class="ttname"><a href="classCharacter.html#a3d0ec2b4e80527bd2daad576c2bbb187">Character::use_charges</a></div><div class="ttdeci">std::list&lt; item &gt; use_charges(const itype_id &amp;what, int qty, const std::function&lt; bool(const item &amp;)&gt; &amp;filter=return_true&lt; item &gt;)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09631">character.cpp:9631</a></div></div>
<div class="ttc" id="aclassCharacter_html_a611bd51d6d4fa9c119787f2fbc6bdd52"><div class="ttname"><a href="classCharacter.html#a611bd51d6d4fa9c119787f2fbc6bdd52">Character::i_add</a></div><div class="ttdeci">item &amp; i_add(item it, bool should_stack=true)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02310">character.cpp:2310</a></div></div>
<div class="ttc" id="aclassCharacter_html_a7cb114203e03014f9834a10fa4bff24e"><div class="ttname"><a href="classCharacter.html#a7cb114203e03014f9834a10fa4bff24e">Character::use_amount</a></div><div class="ttdeci">std::list&lt; item &gt; use_amount(itype_id it, int quantity, const std::function&lt; bool(const item &amp;)&gt; &amp;filter=return_true&lt; item &gt;)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09599">character.cpp:9599</a></div></div>
<div class="ttc" id="aclassitem__location_html_a038e108475b9fb4f9833268f5fa2888daa956161a69928cd130a889b88082fb6e"><div class="ttname"><a href="classitem__location.html#a038e108475b9fb4f9833268f5fa2888daa956161a69928cd130a889b88082fb6e">item_location::type::character</a></div><div class="ttdeci">@ character</div></div>
<div class="ttc" id="aclassitem_html_a31a0fa72add9cbbffc189b0eab0b34c0"><div class="ttname"><a href="classitem.html#a31a0fa72add9cbbffc189b0eab0b34c0">item::stacks_with</a></div><div class="ttdeci">bool stacks_with(const item &amp;rhs, bool check_components=false, bool skip_type_check=false) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00886">item.cpp:886</a></div></div>
<div class="ttc" id="aclassitem_html_aa51b9b2950e9ea68811bffb5635911c6"><div class="ttname"><a href="classitem.html#aa51b9b2950e9ea68811bffb5635911c6">item::set_owner</a></div><div class="ttdeci">void set_owner(const faction_id &amp;new_owner)</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02023">item.h:2023</a></div></div>
<div class="ttc" id="aclassitem_html_aa79dad64e1ef6347219be2f8666e2752"><div class="ttname"><a href="classitem.html#aa79dad64e1ef6347219be2f8666e2752">item::typeId</a></div><div class="ttdeci">const itype_id &amp; typeId() const</div><div class="ttdoc">return the unique identifier of the items underlying type</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l08196">item.cpp:8196</a></div></div>
<div class="ttc" id="adebug_8h_html_a87e509562277a7ada3a75330d00cb445"><div class="ttname"><a href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a></div><div class="ttdeci">#define debugmsg(...)</div><div class="ttdoc">Debug message of level DL::Error and class DC::DebugMsg, also includes the source file name and line,...</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00074">debug.h:74</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classitem__location.html#a038e108475b9fb4f9833268f5fa2888daa956161a69928cd130a889b88082fb6e">item_location::character</a>, <a class="el" href="item_8h_source.html#l02195">item::charges</a>, <a class="el" href="fmtlib__core_8h_source.html#l01073">detail::count()</a>, <a class="el" href="debug_8h_source.html#l00074">debugmsg</a>, <a class="el" href="character_8cpp_source.html#l02310">Character::i_add()</a>, <a class="el" href="item_8h_source.html#l02023">item::set_owner()</a>, <a class="el" href="item_8cpp_source.html#l00886">item::stacks_with()</a>, <a class="el" href="item_8cpp_source.html#l08196">item::typeId()</a>, <a class="el" href="character_8cpp_source.html#l09599">Character::use_amount()</a>, and <a class="el" href="character_8cpp_source.html#l09631">Character::use_charges()</a>.</p>

<p class="reference">Referenced by <a class="el" href="npctrade_8cpp_source.html#l00699">trade()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacenpc__trading.html">npc_trading</a></li>
    <li class="footer">Generated on Sat Nov 12 2022 15:16:10 for Cataclysm BN by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
