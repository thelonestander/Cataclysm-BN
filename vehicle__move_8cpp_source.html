<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cataclysm BN: src/vehicle_move.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cataclysm BN
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('vehicle__move_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">vehicle_move.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="vehicle__move_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#include &quot;<a class="code" href="vehicle_8h.html">vehicle.h</a>&quot;</span> <span class="comment">// IWYU pragma: associated</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="preprocessor">#include &quot;<a class="code" href="vehicle__move_8h.html">vehicle_move.h</a>&quot;</span> <span class="comment">// IWYU pragma: associated</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span> </div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &lt;ostream&gt;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="avatar_8h.html">avatar.h</a>&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;<a class="code" href="bodypart_8h.html">bodypart.h</a>&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &quot;<a class="code" href="creature_8h.html">creature.h</a>&quot;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &quot;<a class="code" href="debug_8h.html">debug.h</a>&quot;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &quot;<a class="code" href="enums_8h.html">enums.h</a>&quot;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &quot;<a class="code" href="explosion_8h.html">explosion.h</a>&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;<a class="code" href="game_8h.html">game.h</a>&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;<a class="code" href="int__id_8h.html">int_id.h</a>&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;<a class="code" href="item_8h.html">item.h</a>&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="itype_8h.html">itype.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;<a class="code" href="map_8h.html">map.h</a>&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;<a class="code" href="map__iterator_8h.html">map_iterator.h</a>&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;<a class="code" href="mapdata_8h.html">mapdata.h</a>&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;<a class="code" href="material_8h.html">material.h</a>&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;<a class="code" href="math__defines_8h.html">math_defines.h</a>&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;<a class="code" href="messages_8h.html">messages.h</a>&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;<a class="code" href="monster_8h.html">monster.h</a>&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;<a class="code" href="optional_8h.html">optional.h</a>&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &quot;<a class="code" href="options_8h.html">options.h</a>&quot;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &quot;<a class="code" href="player_8h.html">player.h</a>&quot;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &quot;<a class="code" href="point__float_8h.html">point_float.h</a>&quot;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &quot;<a class="code" href="rng_8h.html">rng.h</a>&quot;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &quot;<a class="code" href="sounds_8h.html">sounds.h</a>&quot;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &quot;<a class="code" href="string__id_8h.html">string_id.h</a>&quot;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &quot;<a class="code" href="translations_8h.html">translations.h</a>&quot;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &quot;<a class="code" href="trap_8h.html">trap.h</a>&quot;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &quot;<a class="code" href="units__angle_8h.html">units_angle.h</a>&quot;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &quot;<a class="code" href="units__utility_8h.html">units_utility.h</a>&quot;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &quot;<a class="code" href="veh__type_8h.html">veh_type.h</a>&quot;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &quot;<a class="code" href="vpart__position_8h.html">vpart_position.h</a>&quot;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#a49bc164f30e64702250d2cbea09bf86c">   44</a></span><span class="preprocessor">#define dbg(x) DebugLogFL((x),DC::Map)</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#af54ee122fbd5cf94c6ef8bca7e67c8e8">   46</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="vehicle__move_8cpp.html#af54ee122fbd5cf94c6ef8bca7e67c8e8">fuel_type_muscle</a>( <span class="stringliteral">&quot;muscle&quot;</span> );</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#a944ba9be1d911a61e9ca62af989355fd">   47</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="vehicle__move_8cpp.html#a944ba9be1d911a61e9ca62af989355fd">fuel_type_animal</a>( <span class="stringliteral">&quot;animal&quot;</span> );</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#a3f2436294a28dc686156c10abab2f994">   48</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="vehicle__move_8cpp.html#a3f2436294a28dc686156c10abab2f994">fuel_type_battery</a>( <span class="stringliteral">&quot;battery&quot;</span> );</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#afee8dcfd12a225c469ee6171063d7594">   50</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">skill_id</a> <a class="code hl_variable" href="vehicle__move_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a>( <span class="stringliteral">&quot;driving&quot;</span> );</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#a7697771dc47ecaeff36785ff20c9aa33">   52</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">efftype_id</a> <a class="code hl_variable" href="vehicle__move_8cpp.html#a7697771dc47ecaeff36785ff20c9aa33">effect_harnessed</a>( <span class="stringliteral">&quot;harnessed&quot;</span> );</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#a02a4844a7fb68c13a34dc40b0a9e94d8">   53</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">efftype_id</a> <a class="code hl_variable" href="vehicle__move_8cpp.html#a02a4844a7fb68c13a34dc40b0a9e94d8">effect_pet</a>( <span class="stringliteral">&quot;pet&quot;</span> );</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#ad1df0ca2944a94c3ad796e8baada33ae">   54</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">efftype_id</a> <a class="code hl_variable" href="vehicle__move_8cpp.html#ad1df0ca2944a94c3ad796e8baada33ae">effect_stunned</a>( <span class="stringliteral">&quot;stunned&quot;</span> );</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span> </div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#a00735c0bfb68c2a0c0c7d53e8f72a70e">   56</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="vehicle__move_8cpp.html#a00735c0bfb68c2a0c0c7d53e8f72a70e">part_location_structure</a>( <span class="stringliteral">&quot;structure&quot;</span> );</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="comment">// tile height in meters</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#abc9fa7d03f14e2a5323ee0ff66e7938e">   59</a></span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_variable" href="vehicle__move_8cpp.html#abc9fa7d03f14e2a5323ee0ff66e7938e">tile_height</a> = 4;</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="comment">// miles per hour to vehicle 100ths of miles per hour</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#aaf1122bb5a05fea1f3c951510d79a849">   61</a></span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="vehicle__move_8cpp.html#aaf1122bb5a05fea1f3c951510d79a849">mi_to_vmi</a> = 100;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="comment">// meters per second to miles per hour</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#a07407f1ed991551dda7d2952690adabb">   63</a></span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_variable" href="vehicle__move_8cpp.html#a07407f1ed991551dda7d2952690adabb">mps_to_miph</a> = 2.23694f;</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span> </div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span><span class="comment">// convert m/s to vehicle 100ths of a mile per hour</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno"><a class="line" href="vehicle_8h.html#a3bf51af37129f24d376a74ca56b2644e">   66</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="vehicle__move_8cpp.html#a3bf51af37129f24d376a74ca56b2644e">mps_to_vmiph</a>( <span class="keywordtype">double</span> mps )</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>{</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <span class="keywordflow">return</span> mps * <a class="code hl_variable" href="vehicle__move_8cpp.html#a07407f1ed991551dda7d2952690adabb">mps_to_miph</a> * <a class="code hl_variable" href="vehicle__move_8cpp.html#aaf1122bb5a05fea1f3c951510d79a849">mi_to_vmi</a>;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>}</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="comment">// convert vehicle 100ths of a mile per hour to m/s</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno"><a class="line" href="vehicle_8h.html#a5b4f290597a25f2c2f9447eb786c37c5">   72</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="vehicle__move_8cpp.html#a5b4f290597a25f2c2f9447eb786c37c5">vmiph_to_mps</a>( <span class="keywordtype">int</span> vmiph )</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>{</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    <span class="keywordflow">return</span> vmiph / <a class="code hl_variable" href="vehicle__move_8cpp.html#a07407f1ed991551dda7d2952690adabb">mps_to_miph</a> / <a class="code hl_variable" href="vehicle__move_8cpp.html#aaf1122bb5a05fea1f3c951510d79a849">mi_to_vmi</a>;</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>}</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span> </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno"><a class="line" href="vehicle_8h.html#a8001239e356cfe527444f6019ee90205">   77</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="vehicle__move_8cpp.html#a8001239e356cfe527444f6019ee90205">cmps_to_vmiph</a>( <span class="keywordtype">int</span> cmps )</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>{</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    <span class="keywordflow">return</span> cmps * <a class="code hl_variable" href="vehicle__move_8cpp.html#a07407f1ed991551dda7d2952690adabb">mps_to_miph</a>;</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>}</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span> </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno"><a class="line" href="vehicle_8h.html#ab3c28976bd7014b628437d061f7dc6c7">   82</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="vehicle__move_8cpp.html#ab3c28976bd7014b628437d061f7dc6c7">vmiph_to_cmps</a>( <span class="keywordtype">int</span> vmiph )</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>{</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    <span class="keywordflow">return</span> vmiph / <a class="code hl_variable" href="vehicle__move_8cpp.html#a07407f1ed991551dda7d2952690adabb">mps_to_miph</a>;</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>}</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span> </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno"><a class="line" href="classvehicle.html#a09364942b91a344a94af82fad1702918">   87</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="classvehicle.html#a09364942b91a344a94af82fad1702918">vehicle::slowdown</a>( <span class="keywordtype">int</span> at_velocity )<span class="keyword"> const</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    <span class="keywordtype">double</span> mps = <a class="code hl_function" href="vehicle__move_8cpp.html#a5b4f290597a25f2c2f9447eb786c37c5">vmiph_to_mps</a>( std::abs( at_velocity ) );</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span> </div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="comment">// slowdown due to air resistance is proportional to square of speed</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    <span class="keywordtype">double</span> f_total_drag = <a class="code hl_function" href="classvehicle.html#a8997e3518316057cde55f9ecb444b8f0">coeff_air_drag</a>() * mps * mps;</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a0ede4cc2a97a8305b1f06817d0d6cdf8">is_watercraft</a>() ) {</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>        <span class="comment">// same with water resistance</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>        f_total_drag += <a class="code hl_function" href="classvehicle.html#ae97aeac27584b839105a68f12eb1f7a1">coeff_water_drag</a>() * mps * mps;</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> &amp;&amp; !<a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> ) {</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>        <span class="keywordtype">double</span> f_rolling_drag = <a class="code hl_function" href="classvehicle.html#acc7fb8b935b2f6f3d26efaf0fae16230">coeff_rolling_drag</a>() * ( <a class="code hl_variable" href="namespacevehicles.html#a38d998781d2493479832c6bff33e2f32">vehicles::rolling_constant_to_variable</a> + mps );</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>        <span class="keywordflow">if</span>( <a class="code hl_function" href="namespacevehicle__movement.html#ad2c532fb5522d745b0006f7a3b36cab3">vehicle_movement::is_on_rails</a>( <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>(), *<span class="keyword">this</span> ) ) {</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>            <span class="comment">// vehicles on rails don&#39;t skid</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>            f_total_drag += f_rolling_drag;</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>            <span class="comment">// increase rolling resistance by up to 25x if the vehicle is skidding at right angle to facing</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> skid_factor = 1.0 + 24.0 * std::abs( <a class="code hl_function" href="namespaceunits.html#a4b5ee56fbe0ef728f4b190e1282a5d82">units::sin</a>( <a class="code hl_variable" href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">face</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>() - <a class="code hl_variable" href="classvehicle.html#a8bbdfb41ea75fdc007feab08e2137aa2">move</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>() ) );</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>            f_total_drag += f_rolling_drag * skid_factor;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>        }</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    }</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    <span class="keywordtype">double</span> accel_slowdown = f_total_drag / <a class="code hl_function" href="namespaceunits.html#afbf21a7601bd939c196667fc0b020111">to_kilogram</a>( <a class="code hl_function" href="classvehicle.html#a5a7d83716bf73d4b58d265b626872d01">total_mass</a>() );</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    <span class="comment">// converting m/s^2 to vmiph/s</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    <span class="keywordtype">int</span> <a class="code hl_function" href="classvehicle.html#a09364942b91a344a94af82fad1702918">slowdown</a> = <a class="code hl_function" href="vehicle__move_8cpp.html#a3bf51af37129f24d376a74ca56b2644e">mps_to_vmiph</a>( accel_slowdown );</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a40b149ccb2383cb1a263f3e3d88f3469">is_towing</a>() ) {</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>        <a class="code hl_class" href="classvehicle.html">vehicle</a> *other_veh = <a class="code hl_variable" href="classvehicle.html#a72a3e7b7f00c193446b29adee5d5aa9f">tow_data</a>.<a class="code hl_function" href="classtowing__data.html#a4cc6247530a16020db73b3af28e0024e">get_towed</a>();</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>        <span class="keywordflow">if</span>( other_veh ) {</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>            <a class="code hl_function" href="classvehicle.html#a09364942b91a344a94af82fad1702918">slowdown</a> += other_veh-&gt;<a class="code hl_function" href="classvehicle.html#a09364942b91a344a94af82fad1702918">slowdown</a>( at_velocity );</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>        }</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    }</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a09364942b91a344a94af82fad1702918">slowdown</a> &lt; 0 ) {</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;vehicle %s has negative drag slowdown %d\n&quot;</span>, <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a>, <a class="code hl_function" href="classvehicle.html#a09364942b91a344a94af82fad1702918">slowdown</a> );</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    }</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s at %d vimph, f_drag %3.2f, drag accel %d vmiph - extra drag %d&quot;</span>,</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>             <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a>, at_velocity, f_total_drag, <a class="code hl_function" href="classvehicle.html#a09364942b91a344a94af82fad1702918">slowdown</a>, <a class="code hl_function" href="classvehicle.html#a07afedd1263adc69d4ddf5967b18d1c9">static_drag</a>() );</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <span class="comment">// plows slow rolling vehicles, but not falling or floating vehicles</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <span class="keywordflow">if</span>( !( <a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> || <a class="code hl_variable" href="classvehicle.html#ae3cbbbb890aa9a12504ec3458746f3e1">is_floating</a> || <a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> ) ) {</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>        <a class="code hl_function" href="classvehicle.html#a09364942b91a344a94af82fad1702918">slowdown</a> -= <a class="code hl_function" href="classvehicle.html#a07afedd1263adc69d4ddf5967b18d1c9">static_drag</a>();</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    }</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span> </div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    <span class="keywordflow">return</span> std::max( 1, <a class="code hl_function" href="classvehicle.html#a09364942b91a344a94af82fad1702918">slowdown</a> );</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>}</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno"><a class="line" href="classvehicle.html#a0b298dcb96f6d82ac696f38d9a89868b">  129</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classvehicle.html#a0b298dcb96f6d82ac696f38d9a89868b">vehicle::thrust</a>( <span class="keywordtype">int</span> thd, <span class="keywordtype">int</span> z )</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>{</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="comment">//if vehicle is stopped, set target direction to forward.</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <span class="comment">//ensure it is not skidding. Set turns used to 0.</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <span class="keywordflow">if</span>( !<a class="code hl_function" href="classvehicle.html#aec9a1faa6740b681867d48878e37d7bb">is_moving</a>() &amp;&amp; z == 0 ) {</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>        <a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> = <a class="code hl_variable" href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">face</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>();</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>        <a class="code hl_function" href="classvehicle.html#ab3ca604dd9cd1907f37c8a888934a1d3">stop</a>();</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    }</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <span class="keywordtype">bool</span> pl_ctrl = <a class="code hl_function" href="classvehicle.html#a341515426011486c265d016c35f84de6">player_in_control</a>( <a class="code hl_function" href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a>() );</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="comment">// No need to change velocity if there are no wheels</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="keywordflow">if</span>( ( <a class="code hl_variable" href="classvehicle.html#a3cfee06c49af306085cad6bbf3326319">in_water</a> &amp;&amp; <a class="code hl_function" href="classvehicle.html#ac460f925a21efb9dea1dc0fc2f930609">can_float</a>() ) || ( <a class="code hl_function" href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">is_rotorcraft</a>() &amp;&amp; ( z != 0 || <a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> ) ) ) {</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>        <span class="comment">// we&#39;re good</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#ae3cbbbb890aa9a12504ec3458746f3e1">is_floating</a> &amp;&amp; !<a class="code hl_function" href="classvehicle.html#ac460f925a21efb9dea1dc0fc2f930609">can_float</a>() ) {</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>        <a class="code hl_function" href="classvehicle.html#ab3ca604dd9cd1907f37c8a888934a1d3">stop</a>();</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        <span class="keywordflow">if</span>( pl_ctrl ) {</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %s is too leaky!&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        }</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code hl_function" href="classvehicle.html#a578c681656be6b419c62799006008035">valid_wheel_config</a>()  &amp;&amp; z == 0 ) {</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>        <a class="code hl_function" href="classvehicle.html#ab3ca604dd9cd1907f37c8a888934a1d3">stop</a>();</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>        <span class="keywordflow">if</span>( pl_ctrl ) {</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %s doesn&#39;t have enough wheels to move!&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>        }</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    }</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <span class="comment">// Accelerate (true) or brake (false)</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <span class="keywordtype">bool</span> thrusting = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> ) {</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>        <span class="keywordtype">int</span> <a class="code hl_function" href="enums_8h.html#a89bed42d8e3efcd44570febc837f088e">sgn</a> = ( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> &lt; 0 ) ? -1 : 1;</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>        thrusting = ( <a class="code hl_function" href="enums_8h.html#a89bed42d8e3efcd44570febc837f088e">sgn</a> == thd );</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    }</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> </div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <span class="comment">// TODO: Pass this as an argument to avoid recalculating</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    <span class="keywordtype">float</span> traction = <a class="code hl_function" href="classvehicle.html#a9d41a3f9a7969c40ca5a9b7b5a3fdebe">k_traction</a>( <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().vehicle_wheel_traction( *<span class="keyword">this</span> ) );</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="keywordtype">int</span> accel = <a class="code hl_function" href="classvehicle.html#ad81a52a0535e57a0d7e390f6f379ae42">current_acceleration</a>() * traction;</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="keywordflow">if</span>( accel &lt; 200 &amp;&amp; velocity &gt; 0 &amp;&amp; <a class="code hl_function" href="classvehicle.html#a40b149ccb2383cb1a263f3e3d88f3469">is_towing</a>() ) {</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        <span class="keywordflow">if</span>( pl_ctrl ) {</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %s struggles to pull the %s on this surface!&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a>,</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>                     <a class="code hl_variable" href="classvehicle.html#a72a3e7b7f00c193446b29adee5d5aa9f">tow_data</a>.<a class="code hl_function" href="classtowing__data.html#a4cc6247530a16020db73b3af28e0024e">get_towed</a>()-&gt;<a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>        }</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    }</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    <span class="keywordflow">if</span>( thrusting &amp;&amp; accel == 0 ) {</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        <span class="keywordflow">if</span>( pl_ctrl ) {</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %s is too heavy for its engine(s)!&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        }</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    }</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> max_vel = traction * <a class="code hl_function" href="classvehicle.html#a8ae7b8e43449ee574a6fd266f4773892">max_velocity</a>();</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <span class="comment">// maximum braking is 20 mph/s, assumes high friction tires</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> max_brake = 20 * 100;</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <span class="comment">//pos or neg if accelerator or brake</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <span class="keywordtype">int</span> vel_inc = ( accel + ( thrusting ? 0 : max_brake ) ) * thd;</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <span class="comment">// Reverse is only 60% acceleration, unless an electric motor is in use</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="keywordflow">if</span>( thd == -1 &amp;&amp; thrusting &amp;&amp; !<a class="code hl_function" href="classvehicle.html#a603b71f04b9fdb63f400ac93fb4bea88">has_engine_type</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#a3f2436294a28dc686156c10abab2f994">fuel_type_battery</a>, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        vel_inc = .6 * vel_inc;</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    }</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    <span class="comment">//find ratio of used acceleration to maximum available, returned in tenths of a percent</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    <span class="comment">//so 1000 = 100% and 453 = 45.3%</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    <span class="keywordtype">int</span> <a class="code hl_function" href="namespaceammo__effects.html#a266026a76ad1cf3377d0b7c6efc36dd7">load</a>;</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="comment">// Keep exact cruise control speed</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#abdf6601268460dc437ef079590deb33b">cruise_on</a> &amp;&amp; accel != 0 ) {</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        <span class="keywordtype">int</span> effective_cruise = std::min( <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a>, max_vel );</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        <span class="keywordflow">if</span>( thd &gt; 0 ) {</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>            vel_inc = std::min( vel_inc, effective_cruise - <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> );</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>            vel_inc = std::max( vel_inc, effective_cruise - <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> );</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        }</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        <span class="keywordflow">if</span>( thrusting ) {</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>            <a class="code hl_function" href="namespaceammo__effects.html#a266026a76ad1cf3377d0b7c6efc36dd7">load</a> = 1000 * std::abs( vel_inc ) / accel;</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>            <span class="comment">// brakes provide 20 mph/s of slowdown and the rest is engine braking</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>            <span class="comment">// TODO: braking depends on wheels, traction, driver skill</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>            <a class="code hl_function" href="namespaceammo__effects.html#a266026a76ad1cf3377d0b7c6efc36dd7">load</a> = 1000 * std::max( 0, std::abs( vel_inc ) - max_brake ) / accel;</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        }</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>        <a class="code hl_function" href="namespaceammo__effects.html#a266026a76ad1cf3377d0b7c6efc36dd7">load</a> = ( thrusting ? 1000 : 0 );</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    }</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <span class="comment">// rotorcraft need to spend +5% (in addition to idle) of load to fly, +20% (in addition to idle) to ascend</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">is_rotorcraft</a>() &amp;&amp; ( z &gt; 0 || <a class="code hl_function" href="classvehicle.html#a6ac15340cefeea4793448cdb34784011">is_flying_in_air</a>() ) ) {</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>        <a class="code hl_function" href="namespaceammo__effects.html#a266026a76ad1cf3377d0b7c6efc36dd7">load</a> = std::max( <a class="code hl_function" href="namespaceammo__effects.html#a266026a76ad1cf3377d0b7c6efc36dd7">load</a>, z &gt; 0 ? 200 : 50 );</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>        thrusting = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    }</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span> </div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <span class="comment">// only consume resources if engine accelerating</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceammo__effects.html#a266026a76ad1cf3377d0b7c6efc36dd7">load</a> &gt;= 1 &amp;&amp; thrusting ) {</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>        <span class="comment">//abort if engines not operational</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>        <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a73db9a09464720b32da8e3f214475a8e">total_power_w</a>() &lt;= 0 || !<a class="code hl_variable" href="classvehicle.html#a0ccf22f114d5d8f239ebe58f5c8f70ad">engine_on</a> || ( z == 0 &amp;&amp; accel == 0 ) ) {</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>            <span class="keywordflow">if</span>( pl_ctrl ) {</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>                <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a73db9a09464720b32da8e3f214475a8e">total_power_w</a>( <span class="keyword">false</span> ) &lt;= 0 ) {</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>                    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %s doesn&#39;t have an engine!&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a603b71f04b9fdb63f400ac93fb4bea88">has_engine_type</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#af54ee122fbd5cf94c6ef8bca7e67c8e8">fuel_type_muscle</a>, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>                    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %s&#39;s mechanism is out of reach!&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code hl_variable" href="classvehicle.html#a0ccf22f114d5d8f239ebe58f5c8f70ad">engine_on</a> ) {</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>                    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %s&#39;s engine isn&#39;t on!&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( traction &lt; 0.01f ) {</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>                    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %s is stuck.&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>                    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %s&#39;s engine emits a sneezing sound.&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>                }</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>            }</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>            <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> = 0;</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>        }</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>        <span class="comment">//make noise and consume fuel</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>        <a class="code hl_function" href="classvehicle.html#a8bdc82052e35e69dd5f65e1177a13a95">noise_and_smoke</a>( <a class="code hl_function" href="namespaceammo__effects.html#a266026a76ad1cf3377d0b7c6efc36dd7">load</a> );</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        <a class="code hl_function" href="classvehicle.html#a69a37e32958ea0bffc377cc3e0ece913">consume_fuel</a>( <a class="code hl_function" href="namespaceammo__effects.html#a266026a76ad1cf3377d0b7c6efc36dd7">load</a>, 1 );</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>        <span class="keywordflow">if</span>( z != 0 &amp;&amp; <a class="code hl_function" href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">is_rotorcraft</a>() ) {</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>            <a class="code hl_variable" href="classvehicle.html#aeb404e5f18eee80d104a7bb0680ac169">requested_z_change</a> = z;</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>        }</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        <span class="comment">//break the engines a bit, if going too fast.</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        <span class="keywordtype">int</span> strn = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code hl_function" href="classvehicle.html#ac49843abe67be6f7f9c3fdaf92e2f411">strain</a>() * <a class="code hl_function" href="classvehicle.html#ac49843abe67be6f7f9c3fdaf92e2f411">strain</a>() * 100 );</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>        <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> e = 0; e &lt; <a class="code hl_variable" href="classvehicle.html#a31bcfe9c61adc2fe500315a59e1bb690">engines</a>.size(); e++ ) {</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>            <a class="code hl_function" href="classvehicle.html#adaf4a073304f9f96f055094f700b0134">do_engine_damage</a>( e, strn );</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>        }</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    }</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span> </div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    <span class="comment">//wheels aren&#39;t facing the right way to change velocity properly</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    <span class="comment">//lower down, since engines should be getting damaged anyway</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> ) {</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    }</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="comment">//change vehicles velocity</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    <span class="keywordflow">if</span>( ( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> &gt; 0 &amp;&amp; <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> + vel_inc &lt; 0 ) || ( velocity &lt; 0 &amp;&amp; velocity + vel_inc &gt; 0 ) ) {</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>        <span class="comment">//velocity within braking distance of 0</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>        <a class="code hl_function" href="classvehicle.html#ab3ca604dd9cd1907f37c8a888934a1d3">stop</a>();</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>        <span class="comment">// Increase velocity up to max_vel or min_vel, but not above.</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> min_vel = <a class="code hl_function" href="classvehicle.html#ad845fa8ba69c4b41cf6a0fc35db7f01d">max_reverse_velocity</a>();</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>        <span class="keywordflow">if</span>( vel_inc &gt; 0 ) {</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>            <span class="comment">// Don&#39;t allow braking by accelerating (could happen with damaged engines)</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>            <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> = std::max( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a>, std::min( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> + vel_inc, max_vel ) );</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>            <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> = std::min( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a>, std::max( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> + vel_inc, min_vel ) );</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        }</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    }</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    <span class="comment">// If you are going faster than the animal can handle, harness is damaged</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    <span class="comment">// Animal may come free ( and possibly hit by vehicle )</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> e = 0; e &lt; <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>.size(); e++ ) {</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structvehicle__part.html">vehicle_part</a> &amp;vp = <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[ e ];</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>        <span class="keywordflow">if</span>( vp.<a class="code hl_function" href="structvehicle__part.html#a002a1023cd1a96d43556a1b912ebd27b">info</a>().<a class="code hl_variable" href="classvpart__info.html#ae9c50d26b3cc88604ae85573ee6599cd">fuel_type</a> == <a class="code hl_variable" href="vehicle__move_8cpp.html#a944ba9be1d911a61e9ca62af989355fd">fuel_type_animal</a> &amp;&amp; <a class="code hl_variable" href="classvehicle.html#a31bcfe9c61adc2fe500315a59e1bb690">engines</a>.size() != 1 ) {</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>            <a class="code hl_class" href="classmonster.html">monster</a> *mon = <a class="code hl_function" href="classvehicle.html#ab266c3250ffece69b5c2ddc9897d80d3">get_pet</a>( e );</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>            <span class="keywordflow">if</span>( mon != <span class="keyword">nullptr</span> &amp;&amp; mon-&gt;<a class="code hl_function" href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">has_effect</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#a7697771dc47ecaeff36785ff20c9aa33">effect_harnessed</a> ) ) {</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>                <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> &gt; mon-&gt;<a class="code hl_function" href="classCreature.html#a261dff3caa6aabe255ae9d3eaa94d3de">get_speed</a>() * 12 ) {</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>                    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s is not fast enough to keep up with the %s&quot;</span> ), mon-&gt;<a class="code hl_function" href="classmonster.html#ad4fba0b9aea36097d8b972e05e66d914">get_name</a>(), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>                    <span class="keywordtype">int</span> dmg = <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 0, 10 );</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>                    <a class="code hl_function" href="classvehicle.html#ac2de625db1619f042c4a3a69d0995a6a">damage_direct</a>( e, dmg );</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>                }</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>            }</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>        }</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    }</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>}</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span> </div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno"><a class="line" href="classvehicle.html#ac9e0d3482a62d5ac5ec8e5fc83cfaa4a">  285</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classvehicle.html#ac9e0d3482a62d5ac5ec8e5fc83cfaa4a">vehicle::cruise_thrust</a>( <span class="keywordtype">int</span> amount )</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>{</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    <span class="keywordflow">if</span>( amount == 0 ) {</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    }</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    <span class="keywordtype">int</span> safe_vel = <a class="code hl_function" href="classvehicle.html#ad38e05507056b3b3da5a5a5e482adba4">safe_velocity</a>();</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    <span class="keywordtype">int</span> max_vel = <a class="code hl_variable" href="classvehicle.html#ab0ffd12faf770950ee7d2493ffaf9bd0">autopilot_on</a> ? <a class="code hl_function" href="classvehicle.html#ad38e05507056b3b3da5a5a5e482adba4">safe_velocity</a>() : <a class="code hl_function" href="classvehicle.html#a8ae7b8e43449ee574a6fd266f4773892">max_velocity</a>();</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    <span class="keywordtype">int</span> max_rev_vel = <a class="code hl_function" href="classvehicle.html#ad845fa8ba69c4b41cf6a0fc35db7f01d">max_reverse_velocity</a>();</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    <span class="comment">//if the safe velocity is between the cruise velocity and its next value, set to safe velocity</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="keywordflow">if</span>( ( <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> &lt; safe_vel &amp;&amp; safe_vel &lt; ( <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> + amount ) ) ||</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>        ( <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> &gt; safe_vel &amp;&amp; safe_vel &gt; ( <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> + amount ) ) ) {</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>        <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> = safe_vel;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>        <span class="keywordflow">if</span>( amount &lt; 0 &amp;&amp; ( <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> == safe_vel || <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> == max_vel ) ) {</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>            <span class="comment">// If coming down from safe_velocity or max_velocity decrease by one so</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>            <span class="comment">// the rounding below will drop velocity to a multiple of amount.</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>            <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> += -1;</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( amount &gt; 0 &amp;&amp; <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> == max_rev_vel ) {</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>            <span class="comment">// If increasing from max_rev_vel, do the opposite.</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>            <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> += 1;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>            <span class="comment">// Otherwise just add the amount.</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>            <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> += amount;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        }</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>        <span class="comment">// Integer round to lowest multiple of amount.</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>        <span class="comment">// The result is always equal to the original or closer to zero,</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>        <span class="comment">// even if negative</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>        <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> = ( <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> / std::abs( amount ) ) * std::abs( amount );</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>    }</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    <span class="comment">// Can&#39;t have a cruise speed faster than max speed</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    <span class="comment">// or reverse speed faster than max reverse speed.</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> &gt; max_vel ) {</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>        <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> = max_vel;</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> &lt; max_rev_vel ) {</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>        <a class="code hl_variable" href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">cruise_velocity</a> = max_rev_vel;</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    }</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>}</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span> </div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno"><a class="line" href="classvehicle.html#a1380ff85985897f9f8a34eba538e04db">  324</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classvehicle.html#a1380ff85985897f9f8a34eba538e04db">vehicle::turn</a>( <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> deg )</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>{</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    <span class="keywordflow">if</span>( deg == 0_degrees ) {</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    }</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> &lt; 0 &amp;&amp; !::get_option&lt;bool&gt;( <span class="stringliteral">&quot;REVERSE_STEERING&quot;</span> ) ) {</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>        deg = -deg;</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    }</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    <a class="code hl_variable" href="classvehicle.html#a3d4d97e9ca8cb2642001f8f61df500d5">last_turn</a> = deg;</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    <a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> = <a class="code hl_function" href="namespacedetail.html#a955ad02ade4f07084391a60ed80701bf">normalize</a>( <a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> + deg );</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    <span class="comment">// quick rounding the turn dir to a multiple of 15</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>    <a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> = <a class="code hl_function" href="units__utility_8h.html#a0ff5ed49bfcc963d25c49bd38df494e3">round_to_multiple_of</a>( <a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a>, 15_degrees );</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>}</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span> </div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno"><a class="line" href="classvehicle.html#ab3ca604dd9cd1907f37c8a888934a1d3">  338</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classvehicle.html#ab3ca604dd9cd1907f37c8a888934a1d3">vehicle::stop</a>( <span class="keywordtype">bool</span> update_cache )</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>{</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> = 0;</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>    <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>    <a class="code hl_variable" href="classvehicle.html#a8bbdfb41ea75fdc007feab08e2137aa2">move</a> = <a class="code hl_variable" href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">face</a>;</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>    <a class="code hl_variable" href="classvehicle.html#a3d4d97e9ca8cb2642001f8f61df500d5">last_turn</a> = 0_degrees;</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <a class="code hl_variable" href="classvehicle.html#a3d2d513640544cb11fa826890b692e5a">of_turn_carry</a> = 0;</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    <span class="keywordflow">if</span>( !update_cache ) {</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    }</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;p : <a class="code hl_function" href="classvehicle.html#a2e80dafb2c03147b569688658843d9d6">get_points</a>() ) {</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>        here.<a class="code hl_function" href="classmap.html#a49d42535b664b5a6e4e8a02e3e773f4d">set_memory_seen_cache_dirty</a>( p );</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    }</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>}</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno"><a class="line" href="classvehicle.html#aa17bd1dea0b5376e3d118ede063736f8">  354</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classvehicle.html#aa17bd1dea0b5376e3d118ede063736f8">vehicle::collision</a>( std::vector&lt;veh_collision&gt; &amp;colls,</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>                         <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;dp,</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>                         <span class="keywordtype">bool</span> just_detect, <span class="keywordtype">bool</span> bash_floor )</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>{</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span><span class="comment">     * Big TODO:</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span><span class="comment">     * Rewrite this function so that it has &quot;pre-collision&quot; phase (detection)</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span><span class="comment">     *  and &quot;post-collision&quot; phase (applying damage).</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span><span class="comment">     * Then invoke the functions cyclically (pre-post-pre-post-...) until</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span><span class="comment">     *  velocity == 0 or no collision happens.</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="comment">     * Make all post-collisions in a given phase use the same momentum.</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span><span class="comment">     *</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span><span class="comment">     * How it works right now: find the first obstacle, then ram it over and over</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span><span class="comment">     *  until either the obstacle is removed or the vehicle stops.</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span><span class="comment">     * Bug: when ramming a critter without enough force to send it flying,</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="comment">     *  the vehicle will phase into it.</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span><span class="comment">     */</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span> </div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>    <span class="keywordflow">if</span>( dp.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> != 0 &amp;&amp; ( dp.<a class="code hl_variable" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> != 0 || dp.<a class="code hl_variable" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> != 0 ) ) {</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>        <span class="comment">// Split into horizontal + vertical</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classvehicle.html#aa17bd1dea0b5376e3d118ede063736f8">collision</a>( colls, <a class="code hl_struct" href="structtripoint.html">tripoint</a>( dp.<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(), 0 ), just_detect, bash_floor ) ||</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>               <a class="code hl_function" href="classvehicle.html#aa17bd1dea0b5376e3d118ede063736f8">collision</a>( colls, <a class="code hl_struct" href="structtripoint.html">tripoint</a>( 0,    0,    dp.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> ), just_detect, bash_floor );</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    }</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span> </div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>    <span class="keywordflow">if</span>( dp.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> == -1 &amp;&amp; !bash_floor ) {</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>        <span class="comment">// First check current level, then the one below if current had no collisions</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>        <span class="comment">// Bash floors on the current one, but not on the one below.</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>        <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#aa17bd1dea0b5376e3d118ede063736f8">collision</a>( colls, <a class="code hl_variable" href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a>, just_detect, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        }</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    }</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span> </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> vertical = bash_floor || dp.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> != 0;</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;coll_velocity = vertical ? <a class="code hl_variable" href="classvehicle.html#a416a2bc9ee792663fced3344db322cb8">vertical_velocity</a> : <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a>;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="comment">// Skip collisions when there is no apparent movement, except verticially moving rotorcraft.</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="keywordflow">if</span>( coll_velocity == 0 &amp;&amp; !<a class="code hl_function" href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">is_rotorcraft</a>() ) {</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>        just_detect = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    }</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span> </div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> velocity_before = coll_velocity;</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <span class="keywordtype">int</span> lowest_velocity = coll_velocity;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> sign_before = <a class="code hl_function" href="enums_8h.html#a89bed42d8e3efcd44570febc837f088e">sgn</a>( velocity_before );</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <span class="keywordtype">bool</span> empty = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> p = 0; <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>( p ) &lt; <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>.size(); p++ ) {</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>        <span class="keyword">const</span> <a class="code hl_class" href="classvpart__info.html">vpart_info</a> &amp;info = <a class="code hl_function" href="classvehicle.html#aab4917d0f78fe4df1c8f5303fdf2b86d">part_info</a>( p );</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>        <span class="keywordflow">if</span>( ( info.<a class="code hl_variable" href="classvpart__info.html#a03cfe554b18beb9c32d9a86872a1748e">location</a> != <a class="code hl_function" href="vehicle__move_8cpp.html#a00735c0bfb68c2a0c0c7d53e8f72a70e">part_location_structure</a> &amp;&amp; info.<a class="code hl_function" href="classvpart__info.html#af014709bbc2aceff9f6e91bd15e6d508">rotor_diameter</a>() == 0 ) ||</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>            <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[ p ].removed ) {</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>        }</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>        empty = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>        <span class="comment">// Coordinates of where part will go due to movement (dx/dy/dz)</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>        <span class="comment">//  and turning (precalc[1])</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> dsp = <a class="code hl_function" href="classvehicle.html#a3900ee345be0453828a955a200154db1">global_pos3</a>() + dp + <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[p].precalc[1];</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>        <a class="code hl_struct" href="structveh__collision.html">veh_collision</a> coll = <a class="code hl_function" href="classvehicle.html#ae4a8bd9a6ff5fb9a0169296a776c1e98">part_collision</a>( p, dsp, just_detect, bash_floor );</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>        <span class="keywordflow">if</span>( coll.<a class="code hl_variable" href="structveh__collision.html#a5b346d49ed96d1ac882411742b92c23a">type</a> == <a class="code hl_enumvalue" href="vehicle_8h.html#a53b960f88fea75df3467e17492458952ad6f7a65f12e8eab61c4617147bbd6189">veh_coll_nothing</a> ) {</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>        }</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span> </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>        colls.push_back( coll );</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>        <span class="keywordflow">if</span>( just_detect ) {</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>            <span class="comment">// DO insert the first collision so we can tell what was it</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>        }</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span> </div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> velocity_after = coll_velocity;</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        <span class="comment">// A hack for falling vehicles: restore the velocity so that it hits at full force everywhere</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>        <span class="comment">// TODO: Make this more elegant</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>        <span class="keywordflow">if</span>( vertical ) {</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>            <span class="keywordflow">if</span>( velocity_before &lt; 0 ) {</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>                lowest_velocity = std::max( lowest_velocity, coll_velocity );</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>                lowest_velocity = std::min( lowest_velocity, coll_velocity );</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>            }</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>            <a class="code hl_variable" href="classvehicle.html#a416a2bc9ee792663fced3344db322cb8">vertical_velocity</a> = velocity_before;</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="enums_8h.html#a89bed42d8e3efcd44570febc837f088e">sgn</a>( velocity_after ) != sign_before ) {</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>            <span class="comment">// Sign of velocity inverted, collisions would be in wrong direction</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        }</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    }</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <span class="keywordflow">if</span>( vertical ) {</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        <a class="code hl_variable" href="classvehicle.html#a416a2bc9ee792663fced3344db322cb8">vertical_velocity</a> = lowest_velocity;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a416a2bc9ee792663fced3344db322cb8">vertical_velocity</a> == 0 ) {</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>            <a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>        }</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    }</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span> </div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    <span class="keywordflow">if</span>( empty ) {</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>        <span class="comment">// HACK: Hack for dirty vehicles that didn&#39;t yet get properly removed</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>        <a class="code hl_struct" href="structveh__collision.html">veh_collision</a> fake_coll;</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>        fake_coll.<a class="code hl_variable" href="structveh__collision.html#a5b346d49ed96d1ac882411742b92c23a">type</a> = <a class="code hl_enumvalue" href="vehicle_8h.html#a53b960f88fea75df3467e17492458952af924b62a834eb9a80f9f8ac3d7ae4be3">veh_coll_other</a>;</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>        colls.push_back( fake_coll );</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>        <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> = 0;</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>        <a class="code hl_variable" href="classvehicle.html#a416a2bc9ee792663fced3344db322cb8">vertical_velocity</a> = 0;</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;Collision check on a dirty vehicle %s&quot;</span>, <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    }</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span> </div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    <span class="keywordflow">return</span> !colls.empty();</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>}</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span> </div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span><span class="comment">// A helper to make sure mass and density is always calculated the same way</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#a43e5ce141f651d0255c6f15d0954018e">  458</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="vehicle__move_8cpp.html#a43e5ce141f651d0255c6f15d0954018e">terrain_collision_data</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;p, <span class="keywordtype">bool</span> bash_floor,</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>                                    <span class="keywordtype">float</span> &amp;<a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a>, <span class="keywordtype">float</span> &amp;density, <span class="keywordtype">float</span> &amp;elastic )</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>{</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>    elastic = 0.30;</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>    <span class="comment">// Just a rough rescale for now to obtain approximately equal numbers</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> bash_min = here.<a class="code hl_function" href="classmap.html#adfb4f21d749696fdd25c7b37ba2b7b21">bash_resistance</a>( p, bash_floor );</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> bash_max = here.<a class="code hl_function" href="classmap.html#a0b83bb9cbf7265f78eaad06dc1f7b8c3">bash_strength</a>( p, bash_floor );</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>    <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> = ( bash_min + bash_max ) / 2.0;</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>    density = bash_min;</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>}</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span> </div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno"><a class="line" href="classvehicle.html#ae4a8bd9a6ff5fb9a0169296a776c1e98">  470</a></span><a class="code hl_struct" href="structveh__collision.html">veh_collision</a> <a class="code hl_function" href="classvehicle.html#ae4a8bd9a6ff5fb9a0169296a776c1e98">vehicle::part_collision</a>( <span class="keywordtype">int</span> part, <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;p,</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>                                       <span class="keywordtype">bool</span> just_detect, <span class="keywordtype">bool</span> bash_floor )</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>{</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>    <span class="comment">// Vertical collisions need to be handled differently</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    <span class="comment">// All collisions have to be either fully vertical or fully horizontal for now</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> vert_coll = bash_floor || p.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> != <a class="code hl_variable" href="classvehicle.html#a34630935e46860003c616e0522316f02">sm_pos</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>;</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    <a class="code hl_class" href="classCharacter.html">Character</a> &amp;player_character = <a class="code hl_function" href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a>();</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> pl_ctrl = <a class="code hl_function" href="classvehicle.html#a341515426011486c265d016c35f84de6">player_in_control</a>( player_character );</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    <a class="code hl_class" href="classCreature.html">Creature</a> *critter = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( p, <span class="keyword">true</span> );</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    <a class="code hl_class" href="classplayer.html">player</a> *ph = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classplayer.html">player</a> *<span class="keyword">&gt;</span>( critter );</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <a class="code hl_class" href="classCreature.html">Creature</a> *driver = pl_ctrl ? &amp;player_character : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    <span class="comment">// If in a vehicle assume it&#39;s this one</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    <span class="keywordflow">if</span>( ph != <span class="keyword">nullptr</span> &amp;&amp; ph-&gt;<a class="code hl_variable" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> ) {</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>        critter = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>        ph = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    }</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span> </div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <span class="keyword">const</span> <a class="code hl_class" href="classoptional__vpart__position.html">optional_vpart_position</a> ovp = here.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( p );</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    <span class="comment">// Disable vehicle/critter collisions when bashing floor</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>    <span class="comment">// TODO: More elegant code</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> is_veh_collision = !bash_floor &amp;&amp; ovp &amp;&amp; &amp;ovp-&gt;vehicle() != <span class="keyword">this</span>;</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> is_body_collision = !bash_floor &amp;&amp; critter != <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span> </div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>    <a class="code hl_struct" href="structveh__collision.html">veh_collision</a> <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>    <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.type = <a class="code hl_enumvalue" href="vehicle_8h.html#a53b960f88fea75df3467e17492458952ad6f7a65f12e8eab61c4617147bbd6189">veh_coll_nothing</a>;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part = <a class="code hl_function" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a>;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <span class="comment">// Vehicle collisions are a special case. just return the collision.</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    <span class="comment">// The map takes care of the dynamic stuff.</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    <span class="keywordflow">if</span>( is_veh_collision ) {</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.type = <a class="code hl_enumvalue" href="vehicle_8h.html#a53b960f88fea75df3467e17492458952a9ce81fa4bb69ed5ab6ca3648ec842c39">veh_coll_veh</a>;</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>        <span class="comment">//&quot;imp&quot; is too simplistic for vehicle-vehicle collisions</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target = &amp;ovp-&gt;vehicle();</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target_part = ovp-&gt;part_index();</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target_name = ovp-&gt;vehicle().disp_name();</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    }</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <span class="comment">// Typical rotor tip speed in MPH * 100.</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    <span class="keywordtype">int</span> rotor_velocity = 45600;</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>    <span class="comment">// Non-vehicle collisions can&#39;t happen when the vehicle is not moving</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    <span class="keywordtype">int</span> &amp;coll_velocity = ( <a class="code hl_function" href="classvehicle.html#aab4917d0f78fe4df1c8f5303fdf2b86d">part_info</a>( <a class="code hl_function" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a> ).<a class="code hl_function" href="classvpart__info.html#af014709bbc2aceff9f6e91bd15e6d508">rotor_diameter</a>() == 0 ) ?</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>                         ( vert_coll ? <a class="code hl_variable" href="classvehicle.html#a416a2bc9ee792663fced3344db322cb8">vertical_velocity</a> : <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> ) :</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>                         rotor_velocity;</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>    <span class="keywordflow">if</span>( !just_detect &amp;&amp; coll_velocity == 0 ) {</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>    }</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span> </div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    <span class="keywordflow">if</span>( is_body_collision ) {</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>        <span class="comment">// critters on a BOARDABLE part in this vehicle aren&#39;t colliding</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        <span class="keywordflow">if</span>( ovp &amp;&amp; ( &amp;ovp-&gt;vehicle() == <span class="keyword">this</span> ) &amp;&amp; <a class="code hl_function" href="classvehicle.html#ab266c3250ffece69b5c2ddc9897d80d3">get_pet</a>( ovp-&gt;part_index() ) ) {</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>        }</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>        <span class="comment">// we just ran into a fish, so move it out of the way</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>        <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#a27e22f0999ea03eff18babc48643c568">has_flag</a>( <span class="stringliteral">&quot;SWIMMABLE&quot;</span>, critter-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() ) ) {</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>            <a class="code hl_struct" href="structtripoint.html">tripoint</a> end_pos = critter-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>();</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>            <a class="code hl_struct" href="structtripoint.html">tripoint</a> start_pos;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>            <span class="keyword">const</span> <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> <a class="code hl_typedef" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> =</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>                <a class="code hl_variable" href="classvehicle.html#a8bbdfb41ea75fdc007feab08e2137aa2">move</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>() + 45_degrees * ( <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[<a class="code hl_function" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a>].mount.x &gt; <a class="code hl_function" href="classvehicle.html#a19bf91bbba8085237248e25c7d214ee6">pivot_point</a>().<a class="code hl_variable" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> ? -1 : 1 );</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>            std::set&lt;tripoint&gt; &amp;cur_points = <a class="code hl_function" href="classvehicle.html#a2e80dafb2c03147b569688658843d9d6">get_points</a>( <span class="keyword">true</span> );</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>            <span class="comment">// push the animal out of way until it&#39;s no longer in our vehicle and not in</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>            <span class="comment">// anyone else&#39;s position</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>            <span class="keywordflow">while</span>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( end_pos, <span class="keyword">true</span> ) ||</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>                   cur_points.find( end_pos ) != cur_points.end() ) {</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>                start_pos = end_pos;</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>                <a class="code hl_function" href="line_8cpp.html#a9cbf6626ab40d551e7092ba115965380">calc_ray_end</a>( <a class="code hl_typedef" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a>, 2, start_pos, end_pos );</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>            }</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>            critter-&gt;<a class="code hl_function" href="classCreature.html#a7f9ce537b830a5f0474c001d295c0a77">setpos</a>( end_pos );</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>        }</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>    }</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span> </div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>    <span class="comment">// Damage armor before damaging any other parts</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    <span class="comment">// Actually target, not just damage - spiked plating will &quot;hit back&quot;, for example</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> armor_part = <a class="code hl_function" href="classvehicle.html#a00f013bfeaa4b6d44eaa67961f0c1e59">part_with_feature</a>( <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part, <a class="code hl_enumvalue" href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307ea4c67c3568d86e365c41549637ebff02b">VPFLAG_ARMOR</a>, <span class="keyword">true</span> );</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>    <span class="keywordflow">if</span>( armor_part &gt;= 0 ) {</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part = armor_part;</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>    }</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span> </div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>    <span class="keywordtype">int</span> dmg_mod = <a class="code hl_function" href="classvehicle.html#aab4917d0f78fe4df1c8f5303fdf2b86d">part_info</a>( <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part ).<a class="code hl_variable" href="classvpart__info.html#a010d7002072c22b1029fdbfbf310cedc">dmg_mod</a>;</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>    <span class="comment">// Let&#39;s calculate type of collision &amp; mass of object we hit</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>    <span class="keywordtype">float</span> mass2 = 0;</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>    <span class="comment">// e = 0 -&gt; plastic collision</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    <span class="keywordtype">float</span> e = 0.3;</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>    <span class="comment">// e = 1 -&gt; inelastic collision</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    <span class="comment">//part density</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>    <span class="keywordtype">float</span> part_dens = 0;</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span> </div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>    <span class="keywordflow">if</span>( is_body_collision ) {</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        <span class="comment">// Check any monster/NPC/player on the way</span></div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>        <span class="comment">// body</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.type = <a class="code hl_enumvalue" href="vehicle_8h.html#a53b960f88fea75df3467e17492458952a81e75be1950a29c38a47c29ca62af371">veh_coll_body</a>;</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target = critter;</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>        e = 0.30;</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>        part_dens = 15;</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>        mass2 = <a class="code hl_function" href="namespaceunits.html#afbf21a7601bd939c196667fc0b020111">units::to_kilogram</a>( critter-&gt;<a class="code hl_function" href="classCreature.html#a38ea0c149ac718542546fdceba44a4df">get_weight</a>() );</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target_name = critter-&gt;<a class="code hl_function" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">disp_name</a>();</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( bash_floor &amp;&amp; here.<a class="code hl_function" href="classmap.html#a2e3300e786112b4ea45a9d3176b5f3b0">is_bashable_ter_furn</a>( p, <span class="keyword">true</span> ) ) ||</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>               ( here.<a class="code hl_function" href="classmap.html#a2e3300e786112b4ea45a9d3176b5f3b0">is_bashable_ter_furn</a>( p, <span class="keyword">false</span> ) &amp;&amp; here.<a class="code hl_function" href="classmap.html#ab3329218e47ef1729d54bbf27622c1ba">move_cost_ter_furn</a>( p ) != 2 &amp;&amp;</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>                 <span class="comment">// Don&#39;t collide with tiny things, like flowers, unless we have a wheel in our space.</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>                 ( <a class="code hl_function" href="classvehicle.html#a00f013bfeaa4b6d44eaa67961f0c1e59">part_with_feature</a>( <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part, <a class="code hl_enumvalue" href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307eae36e04cd704cf1a4a2ae645809e24e1b">VPFLAG_WHEEL</a>, <span class="keyword">true</span> ) &gt;= 0 ||</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>                   !here.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <span class="stringliteral">&quot;TINY&quot;</span>, p ) ) &amp;&amp;</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>                 <span class="comment">// Protrusions don&#39;t collide with short terrain.</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>                 <span class="comment">// Tiny also doesn&#39;t, but it&#39;s already excluded unless there&#39;s a wheel present.</span></div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>                 !( <a class="code hl_function" href="classvehicle.html#a00f013bfeaa4b6d44eaa67961f0c1e59">part_with_feature</a>( <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part, <span class="stringliteral">&quot;PROTRUSION&quot;</span>, <span class="keyword">true</span> ) &gt;= 0 &amp;&amp;</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>                    here.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <span class="stringliteral">&quot;SHORT&quot;</span>, p ) ) &amp;&amp;</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>                 <span class="comment">// These are bashable, but don&#39;t interact with vehicles.</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>                 !here.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <span class="stringliteral">&quot;NOCOLLIDE&quot;</span>, p ) &amp;&amp;</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>                 <span class="comment">// Do not collide with track tiles if we can use rails</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>                 !( here.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258aa629b376f81403545931bc8b5689490f">TFLAG_RAIL</a>, p ) &amp;&amp; this-&gt;can_use_rails() ) ) ) {</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>        <span class="comment">// Movecost 2 indicates flat terrain like a floor, no collision there.</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.type = <a class="code hl_enumvalue" href="vehicle_8h.html#a53b960f88fea75df3467e17492458952a9acfef3ceff4a9c4fa3c0cf62bb8d19c">veh_coll_bashable</a>;</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>        <a class="code hl_function" href="vehicle__move_8cpp.html#a43e5ce141f651d0255c6f15d0954018e">terrain_collision_data</a>( p, bash_floor, mass2, part_dens, e );</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target_name = here.<a class="code hl_function" href="classmap.html#a64c0e02c7c79eb42879665a3e8b75999">disp_name</a>( p );</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#a82534d8752a0be6bbb000928d1f1978b">impassable_ter_furn</a>( p ) ||</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>               ( bash_floor &amp;&amp; !here.<a class="code hl_function" href="classmap.html#a27e22f0999ea03eff18babc48643c568">has_flag</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a7ae3043cdc343c2784d644bcafe86269">TFLAG_NO_FLOOR</a>, p ) ) ) {</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>        <span class="comment">// not destructible</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.type = <a class="code hl_enumvalue" href="vehicle_8h.html#a53b960f88fea75df3467e17492458952af924b62a834eb9a80f9f8ac3d7ae4be3">veh_coll_other</a>;</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>        mass2 = 1000;</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>        e = 0.10;</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>        part_dens = 80;</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target_name = here.<a class="code hl_function" href="classmap.html#a64c0e02c7c79eb42879665a3e8b75999">disp_name</a>( p );</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>    }</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span> </div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.type == <a class="code hl_enumvalue" href="vehicle_8h.html#a53b960f88fea75df3467e17492458952ad6f7a65f12e8eab61c4617147bbd6189">veh_coll_nothing</a> || just_detect ) {</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>        <span class="comment">// Hit nothing or we aren&#39;t actually hitting</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    }</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>    <a class="code hl_function" href="classvehicle.html#a8d23ce82d669c714795a2ed9b679e3b9">stop_autodriving</a>();</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>    <span class="comment">// Calculate mass AFTER checking for collision</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    <span class="comment">//  because it involves iterating over all cargo</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>    <span class="comment">// Rotors only use rotor mass in calculation.</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> = ( <a class="code hl_function" href="classvehicle.html#aab4917d0f78fe4df1c8f5303fdf2b86d">part_info</a>( <a class="code hl_function" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a> ).<a class="code hl_function" href="classvpart__info.html#af014709bbc2aceff9f6e91bd15e6d508">rotor_diameter</a>() &gt; 0 ) ?</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>                       <a class="code hl_function" href="namespaceunits.html#afbf21a7601bd939c196667fc0b020111">to_kilogram</a>( <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[ <a class="code hl_function" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a> ].base.weight() ) : <a class="code hl_function" href="namespaceunits.html#afbf21a7601bd939c196667fc0b020111">to_kilogram</a>( <a class="code hl_function" href="classvehicle.html#a5a7d83716bf73d4b58d265b626872d01">total_mass</a>() );</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span> </div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>    <span class="comment">//Calculate damage resulting from d_E</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="material_8h.html#a988f56b9fb9795d303c0c614f3b19d7c">material_id_list</a> &amp;mats = <a class="code hl_function" href="classvehicle.html#aab4917d0f78fe4df1c8f5303fdf2b86d">part_info</a>( <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part ).<a class="code hl_variable" href="classvpart__info.html#adb7dd24347aac9bff4ef3d7ff3663ded">item</a>-&gt;<a class="code hl_variable" href="structitype.html#a32ac824cb8437ef7a8288dafe6c6bfe1">materials</a>;</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>    <span class="keywordtype">float</span> vpart_dens = 0;</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>    <span class="keywordflow">if</span>( !mats.empty() ) {</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>        <span class="keywordflow">for</span>( <span class="keyword">auto</span> &amp;mat_id : mats ) {</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>            vpart_dens += mat_id.obj().density();</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        }</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>        <span class="comment">// average</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        vpart_dens /= mats.size();</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    }</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span> </div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    <span class="comment">//k=100 -&gt; 100% damage on part</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>    <span class="comment">//k=0 -&gt; 100% damage on obj</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>    <span class="keywordtype">float</span> material_factor = ( part_dens - vpart_dens ) * 0.5;</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>    material_factor = std::max( -25.0f, std::min( 25.0f, material_factor ) );</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>    <span class="comment">// factor = -25 if mass is much greater than mass2</span></div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>    <span class="comment">// factor = +25 if mass2 is much greater than mass</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> weight_factor = <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> &gt;= mass2 ?</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>                                -25 * ( std::log( <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> ) - std::log( mass2 ) ) / std::log( <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> ) :</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>                                25 * ( std::log( mass2 ) - std::log( <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> ) ) / std::log( mass2 );</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span> </div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>    <span class="keywordtype">float</span> k = 50 + material_factor + weight_factor;</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    k = std::max( 10.0f, std::min( 90.0f, k ) );</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span> </div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>    <span class="keywordtype">bool</span> smashed = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>    <span class="keyword">const</span> std::string snd = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;smash!&quot;</span> );</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>    <span class="keywordtype">float</span> dmg = 0.0f;</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>    <span class="keywordtype">float</span> part_dmg = 0.0f;</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    <span class="comment">// Calculate Impulse of car</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    <a class="code hl_class" href="classtime__duration.html">time_duration</a> time_stunned = 0_turns;</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span> </div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> prev_velocity = coll_velocity;</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> vel_sign = <a class="code hl_function" href="enums_8h.html#a89bed42d8e3efcd44570febc837f088e">sgn</a>( coll_velocity );</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>    <span class="comment">// Velocity of the object we&#39;re hitting</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>    <span class="comment">// Assuming it starts at 0, but we&#39;ll probably hit it many times</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>    <span class="comment">// in one collision, so accumulate the velocity gain from each hit.</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>    <span class="keywordtype">float</span> vel2 = 0.0f;</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>        smashed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>        <span class="comment">// Impulse of vehicle</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> vel1 = coll_velocity / 100.0f;</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>        <span class="comment">// Velocity of car after collision</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> vel1_a = ( <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> * vel1 + mass2 * vel2 + e * mass2 * ( vel2 - vel1 ) ) /</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>                             ( <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> + mass2 );</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>        <span class="comment">// Velocity of object after collision</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> vel2_a = ( <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> * vel1 + mass2 * vel2 + e * <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> * ( vel1 - vel2 ) ) / ( <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> + mass2 );</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        <span class="comment">// Lost energy at collision -&gt; deformation energy -&gt; damage</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> E_before = 0.5f * ( <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> * vel1 * vel1 )     + 0.5f * ( mass2 * vel2 * vel2 );</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> E_after  = 0.5f * ( <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> * vel1_a * vel1_a ) + 0.5f * ( mass2 * vel2_a * vel2_a );</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> d_E = E_before - E_after;</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>        <span class="keywordflow">if</span>( d_E &lt;= 0 ) {</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>            <span class="comment">// Deformation energy is signed</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>            <span class="comment">// If it&#39;s negative, it means something went wrong</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>            <span class="comment">// But it still does happen sometimes...</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>            <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">std::fabs</a>( vel1_a ) &lt; <a class="code hl_function" href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">std::fabs</a>( vel1 ) ) {</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>                <span class="comment">// Lower vehicle&#39;s speed to prevent infinite loops</span></div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>                coll_velocity = vel1_a * 90;</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>            }</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>            <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">std::fabs</a>( vel2_a ) &gt; <a class="code hl_function" href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">std::fabs</a>( vel2 ) ) {</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>                vel2 = vel2_a;</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>            }</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>            <span class="comment">// this causes infinite loop</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>            <span class="keywordflow">if</span>( mass2 == 0 ) {</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>                mass2 = 1;</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>            }</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>        }</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span> </div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>        <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;Deformation energy: %.2f&quot;</span>, d_E );</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>        <span class="comment">// Damage calculation</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>        <span class="comment">// Damage dealt overall</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>        dmg += d_E / 400;</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>        <span class="comment">// Damage for vehicle-part</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>        <span class="comment">// Always if no critters, otherwise if critter is real</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>        <span class="keywordflow">if</span>( critter == <span class="keyword">nullptr</span> || !critter-&gt;<a class="code hl_function" href="classCreature.html#a3cb42eea32fd7e172dca0e902d1184ed">is_hallucination</a>() ) {</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>            part_dmg = dmg * k / 100;</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;Part collision damage: %.2f&quot;</span>, part_dmg );</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>        }</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        <span class="comment">// Damage for object</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> obj_dmg = dmg * ( 100 - k ) / 100;</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span> </div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.type == <a class="code hl_enumvalue" href="vehicle_8h.html#a53b960f88fea75df3467e17492458952a9acfef3ceff4a9c4fa3c0cf62bb8d19c">veh_coll_bashable</a> ) {</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>            <span class="comment">// Something bashable -- use map::bash to determine outcome</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>            <span class="comment">// NOTE: Floor bashing disabled for balance reasons</span></div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>            <span class="comment">//       Floor values are still used to set damage dealt to vehicle</span></div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>            smashed = here.<a class="code hl_function" href="classmap.html#a2e3300e786112b4ea45a9d3176b5f3b0">is_bashable_ter_furn</a>( p, <span class="keyword">false</span> ) &amp;&amp;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>                      here.<a class="code hl_function" href="classmap.html#adfb4f21d749696fdd25c7b37ba2b7b21">bash_resistance</a>( p, bash_floor ) &lt;= obj_dmg &amp;&amp;</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>                      here.<a class="code hl_function" href="classmap.html#a2266f21420ae2a1b44e8df9a028764e4">bash</a>( p, obj_dmg, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">this</span> ).<a class="code hl_variable" href="structbash__results.html#aca607ab5e6884fe03b2119ffecd88419">success</a>;</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>            <span class="keywordflow">if</span>( smashed ) {</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>                <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#a2e3300e786112b4ea45a9d3176b5f3b0">is_bashable_ter_furn</a>( p, bash_floor ) ) {</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>                    <span class="comment">// There&#39;s new terrain there to smash</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>                    smashed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>                    <a class="code hl_function" href="vehicle__move_8cpp.html#a43e5ce141f651d0255c6f15d0954018e">terrain_collision_data</a>( p, bash_floor, mass2, part_dens, e );</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>                    <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target_name = here.<a class="code hl_function" href="classmap.html#a64c0e02c7c79eb42879665a3e8b75999">disp_name</a>( p );</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#a82534d8752a0be6bbb000928d1f1978b">impassable_ter_furn</a>( p ) ) {</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>                    <span class="comment">// There&#39;s new terrain there, but we can&#39;t smash it!</span></div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>                    smashed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>                    <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.type = <a class="code hl_enumvalue" href="vehicle_8h.html#a53b960f88fea75df3467e17492458952af924b62a834eb9a80f9f8ac3d7ae4be3">veh_coll_other</a>;</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>                    mass2 = 1000;</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>                    e = 0.10;</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>                    part_dens = 80;</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>                    <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target_name = here.<a class="code hl_function" href="classmap.html#a64c0e02c7c79eb42879665a3e8b75999">disp_name</a>( p );</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>                }</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>            }</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.type == <a class="code hl_enumvalue" href="vehicle_8h.html#a53b960f88fea75df3467e17492458952a81e75be1950a29c38a47c29ca62af371">veh_coll_body</a> ) {</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>            <span class="keywordtype">int</span> dam = obj_dmg * dmg_mod / 100;</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span> </div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>            <span class="comment">// We know critter is set for this type.  Assert to inform static</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>            <span class="comment">// analysis.</span></div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>            assert( critter );</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span> </div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>            <span class="comment">// No blood from hallucinations</span></div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>            <span class="keywordflow">if</span>( !critter-&gt;<a class="code hl_function" href="classCreature.html#a3cb42eea32fd7e172dca0e902d1184ed">is_hallucination</a>() ) {</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>                <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a396e319b27729d4c423b3d096e657bf9">part_flag</a>( <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part, <span class="stringliteral">&quot;SHARP&quot;</span> ) ) {</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>                    <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[<a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part].blood += ( 20 + dam ) * 5;</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( dam &gt; <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 10, 30 ) ) {</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>                    <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[<a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part].blood += ( 10 + dam / 2 ) * 5;</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>                }</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span> </div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>                <a class="code hl_variable" href="classvehicle.html#ac82426b9ed349941fde4e5af18038735">check_environmental_effects</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>            }</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span> </div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>            time_stunned = <a class="code hl_function" href="classtime__duration.html#a0f7145f4fc4c09defbaf25f468e4e54a">time_duration::from_turns</a>( ( <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 0, dam ) &gt; 10 ) + ( <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 0, dam ) &gt; 40 ) );</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>            <span class="keywordflow">if</span>( time_stunned &gt; 0_turns ) {</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>                critter-&gt;<a class="code hl_function" href="classCreature.html#a666022fd3ed772fa109d273c20e8de55">add_effect</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#ad1df0ca2944a94c3ad796e8baada33ae">effect_stunned</a>, time_stunned );</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>            }</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span> </div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>            <span class="keywordflow">if</span>( ph != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>                ph-&gt;<a class="code hl_function" href="classCharacter.html#a59ce503ce81563ebcc1da591816a7b7c">hitall</a>( dam, 40, driver );</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>                <span class="keyword">const</span> <span class="keywordtype">int</span> armor = <a class="code hl_function" href="classvehicle.html#a396e319b27729d4c423b3d096e657bf9">part_flag</a>( <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part, <span class="stringliteral">&quot;SHARP&quot;</span> ) ?</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>                                  critter-&gt;<a class="code hl_function" href="classCreature.html#a5bb5438474141314c9a9f11a565b6c9c">get_armor_cut</a>( <a class="code hl_typedef" href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a>( <span class="stringliteral">&quot;torso&quot;</span> ) ) :</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>                                  critter-&gt;<a class="code hl_function" href="classCreature.html#a3e049fbeaa6a392bd3a2594005b397af">get_armor_bash</a>( <a class="code hl_typedef" href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a>( <span class="stringliteral">&quot;torso&quot;</span> ) );</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>                dam = std::max( 0, dam - armor );</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>                critter-&gt;<a class="code hl_function" href="classCreature.html#a0547ea1ba1d4fcc157db6a73b877f5d6">apply_damage</a>( driver, <a class="code hl_typedef" href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a>( <span class="stringliteral">&quot;torso&quot;</span> ), dam );</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>                <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;Critter collision damage: %d&quot;</span>, dam );</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>            }</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span> </div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>            <span class="comment">// Don&#39;t fling if vertical - critter got smashed into the ground</span></div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>            <span class="keywordflow">if</span>( !vert_coll ) {</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>                <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">std::fabs</a>( vel2_a ) &gt; 10.0f ||</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>                    <a class="code hl_function" href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">std::fabs</a>( e * <a class="code hl_typedef" href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">mass</a> * vel1_a ) &gt; <a class="code hl_function" href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">std::fabs</a>( mass2 * ( 10.0f - vel2_a ) ) ) {</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>                    <span class="keyword">const</span> <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> <a class="code hl_typedef" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> = <a class="code hl_function" href="rng_8cpp.html#a0c88381d6334a2fbaa726c53f5cf9bb9">rng_float</a>( -60_degrees, 60_degrees );</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>                    <span class="comment">// Also handle the weird case when we don&#39;t have enough force</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>                    <span class="comment">// but still have to push (in such case compare momentum)</span></div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>                    <span class="keyword">const</span> <span class="keywordtype">float</span> push_force = std::max&lt;float&gt;( <a class="code hl_function" href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">std::fabs</a>( vel2_a ), 10.1f );</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>                    <span class="comment">// move.dir is where the vehicle is facing. If velocity is negative,</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>                    <span class="comment">// we&#39;re moving backwards and have to adjust the angle accordingly.</span></div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>                    <span class="keyword">const</span> <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> angle_sum =</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>                        <a class="code hl_typedef" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> + <a class="code hl_variable" href="classvehicle.html#a8bbdfb41ea75fdc007feab08e2137aa2">move</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>() + ( vel2_a &gt; 0 ? 0_degrees : 180_degrees );</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>                    <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;fling_creature( critter, angle_sum, push_force );</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">std::fabs</a>( vel2_a ) &gt; <a class="code hl_function" href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">std::fabs</a>( vel2 ) ) {</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>                    vel2 = vel2_a;</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>                    <span class="comment">// Vehicle&#39;s momentum isn&#39;t big enough to push the critter</span></div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>                    <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> = 0;</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>                }</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span> </div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>                <span class="keywordflow">if</span>( critter-&gt;<a class="code hl_function" href="classCreature.html#ab4c318885f6b9947a7c85d3328d25ffe">is_dead_state</a>() ) {</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>                    smashed = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>                    <span class="comment">// Only count critter as pushed away if it actually changed position</span></div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>                    smashed = critter-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() != p;</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>                }</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>            }</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>        }</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span> </div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>        <span class="keywordflow">if</span>( critter == <span class="keyword">nullptr</span> || !critter-&gt;<a class="code hl_function" href="classCreature.html#a3cb42eea32fd7e172dca0e902d1184ed">is_hallucination</a>() ) {</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>            coll_velocity = vel1_a * ( smashed ? 100 : 90 );</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>        }</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>        <span class="comment">// Stop processing when sign inverts, not when we reach 0</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>    } <span class="keywordflow">while</span>( !smashed &amp;&amp; <a class="code hl_function" href="enums_8h.html#a89bed42d8e3efcd44570febc837f088e">sgn</a>( coll_velocity ) == vel_sign );</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span> </div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>    <span class="comment">// Apply special effects from collision.</span></div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>    <span class="keywordflow">if</span>( critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>        <span class="keywordflow">if</span>( !critter-&gt;<a class="code hl_function" href="classCreature.html#a3cb42eea32fd7e172dca0e902d1184ed">is_hallucination</a>() ) {</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>            <span class="keywordflow">if</span>( pl_ctrl ) {</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>                <span class="keywordflow">if</span>( time_stunned &gt; 0_turns ) {</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>                    <span class="comment">//~ 1$s - vehicle name, 2$s - part name, 3$s - NPC or monster</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>                    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %1$s&#39;s %2$s rams into %3$s and stuns it!&quot;</span> ),</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>                             <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a>, <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[ <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part ].name(), <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target_name );</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>                    <span class="comment">//~ 1$s - vehicle name, 2$s - part name, 3$s - NPC or monster</span></div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>                    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %1$s&#39;s %2$s rams into %3$s!&quot;</span> ),</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>                             <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a>, <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[ <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part ].name(), <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target_name );</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>                }</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>            }</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span> </div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>            <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a396e319b27729d4c423b3d096e657bf9">part_flag</a>( <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part, <span class="stringliteral">&quot;SHARP&quot;</span> ) ) {</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>                critter-&gt;<a class="code hl_function" href="classCreature.html#a303fcc58869f10f44be1d598ed1aa26f">bleed</a>();</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>                <a class="code hl_function" href="namespacesounds.html#a6bb79ae1c9c3dcd8c8e0b28c66b0398d">sounds::sound</a>( p, 20, <a class="code hl_enumvalue" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed">sounds::sound_t::combat</a>, snd, <span class="keyword">false</span>, <span class="stringliteral">&quot;smash_success&quot;</span>, <span class="stringliteral">&quot;hit_vehicle&quot;</span> );</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>            }</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>        }</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>        <span class="keywordflow">if</span>( pl_ctrl ) {</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>            <span class="keywordflow">if</span>( !snd.empty() ) {</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>                <span class="comment">//~ 1$s - vehicle name, 2$s - part name, 3$s - collision object name, 4$s - sound message</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>                <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %1$s&#39;s %2$s rams into %3$s with a %4$s&quot;</span> ),</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>                         <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a>, <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[ <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part ].name(), <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target_name, snd );</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>                <span class="comment">//~ 1$s - vehicle name, 2$s - part name, 3$s - collision object name</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>                <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %1$s&#39;s %2$s rams into %3$s.&quot;</span> ),</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>                         <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a>, <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[ <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.part ].name(), <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.target_name );</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>            }</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>        }</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span> </div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>        <a class="code hl_function" href="namespacesounds.html#a6bb79ae1c9c3dcd8c8e0b28c66b0398d">sounds::sound</a>( p, smashed ? 80 : 50, <a class="code hl_enumvalue" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed">sounds::sound_t::combat</a>, snd, <span class="keyword">false</span>, <span class="stringliteral">&quot;smash_success&quot;</span>,</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>                       <span class="stringliteral">&quot;hit_vehicle&quot;</span> );</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>    }</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span> </div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>    <span class="keywordflow">if</span>( smashed &amp;&amp; !vert_coll ) {</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>        <span class="keywordtype">int</span> turn_amount = <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 1, 3 ) * std::sqrt( <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( part_dmg ) );</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>        turn_amount /= 15;</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>        <span class="keywordflow">if</span>( turn_amount &lt; 1 ) {</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>            turn_amount = 1;</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>        }</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>        turn_amount *= 15;</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>        <span class="keywordflow">if</span>( turn_amount &gt; 120 ) {</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>            turn_amount = 120;</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>        }</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>        <span class="keywordtype">int</span> turn_roll = <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 0, 100 );</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>        <span class="comment">// Probability of skidding increases with higher delta_v</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>        <span class="keywordflow">if</span>( turn_roll &lt; std::abs( ( prev_velocity - coll_velocity ) / 100.0f * 2.0f ) ) {</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>            <span class="comment">//delta_v = vel1 - vel1_a</span></div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>            <span class="comment">//delta_v = 50 mph -&gt; 100% probability of skidding</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>            <span class="comment">//delta_v = 25 mph -&gt; 50% probability of skidding</span></div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>            <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>            <a class="code hl_function" href="classvehicle.html#a1380ff85985897f9f8a34eba538e04db">turn</a>( <a class="code hl_function" href="namespaceunits.html#a068cd98efba5fd1fbb936ce3597db23d">units::from_degrees</a>( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 2 ) ? turn_amount : -turn_amount ) );</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>        }</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>    }</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span> </div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>    <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.imp = part_dmg;</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>}</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span> </div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno"><a class="line" href="classvehicle.html#ae4630e42613cfd4129edd33828c10dc4">  845</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classvehicle.html#ae4630e42613cfd4129edd33828c10dc4">vehicle::handle_trap</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;p, <span class="keywordtype">int</span> part )</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>{</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>    <span class="keywordtype">int</span> pwh = <a class="code hl_function" href="classvehicle.html#a00f013bfeaa4b6d44eaa67961f0c1e59">part_with_feature</a>( <a class="code hl_function" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a>, <a class="code hl_enumvalue" href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307eae36e04cd704cf1a4a2ae645809e24e1b">VPFLAG_WHEEL</a>, <span class="keyword">true</span> );</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>    <span class="keywordflow">if</span>( pwh &lt; 0 ) {</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>    }</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>    <a class="code hl_class" href="classCharacter.html">Character</a> &amp;player_character = <a class="code hl_function" href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a>();</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span> </div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtrap.html">trap</a> &amp;tr = here.<a class="code hl_function" href="classmap.html#a30ccb67ed3651d350f2caf214e0b5176">tr_at</a>( p );</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>    <span class="keyword">const</span> <a class="code hl_class" href="classint__id.html">trap_id</a> t = tr.<a class="code hl_variable" href="structtrap.html#ab2767aee5179ad23b3ad0b6b4b2415af">loadid</a>;</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span> </div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>    <span class="keywordflow">if</span>( t == <a class="code hl_variable" href="trap_8cpp.html#a7b8e40eb2b50e3841e2d9f2d0531226a">tr_null</a> ) {</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>        <span class="comment">// If the trap doesn&#39;t exist, we can&#39;t interact with it, so just return</span></div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>    }</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>    <a class="code hl_struct" href="structvehicle__handle__trap__data.html">vehicle_handle_trap_data</a> veh_data = tr.<a class="code hl_variable" href="structtrap.html#a03491b6455522e29bcbd457283b88c6d">vehicle_data</a>;</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span> </div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>    <span class="keywordflow">if</span>( veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#aff743c43f98a9a30f15b33bab668b9f3">is_falling</a> ) {</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>    }</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span> </div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> seen = player_character.<a class="code hl_function" href="classCharacter.html#aba9bd7517b334e6ed4149889ed32377a">sees</a>( p );</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> known = player_character.<a class="code hl_function" href="classCharacter.html#a7cf3a039fed01ee44525ea41940cb00d">knows_trap</a>( p );</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    <span class="keywordflow">if</span>( seen ) {</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>        <span class="keywordflow">if</span>( known ) {</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>            <span class="comment">//~ %1$s: name of the vehicle; %2$s: name of the related vehicle part; %3$s: trap name</span></div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %1$s&#39;s %2$s runs over %3$s.&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a>, <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[ <a class="code hl_function" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a> ].<a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a>(), tr.<a class="code hl_function" href="structtrap.html#a01b0ef8443ac5ba4e7455880ca2dc44b">name</a>() );</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %1$s&#39;s %2$s runs over something.&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a>, <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[ <a class="code hl_function" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a> ].<a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a>() );</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>        }</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>    }</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span> </div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>    <span class="keywordflow">if</span>( veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#a4720c8fd0a5120c5e73999d630a441b9">chance</a> &gt;= <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 1, 100 ) ) {</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>        <span class="keywordflow">if</span>( veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#a0c5bf103091c4d3af6e05554dfb4ea06">sound_volume</a> &gt; 0 ) {</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>            <a class="code hl_function" href="namespacesounds.html#a6bb79ae1c9c3dcd8c8e0b28c66b0398d">sounds::sound</a>( p, veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#a0c5bf103091c4d3af6e05554dfb4ea06">sound_volume</a>, <a class="code hl_enumvalue" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed">sounds::sound_t::combat</a>, veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#a5a19d024919f0e4b3e470b85ceee7557">sound</a>, <span class="keyword">false</span>,</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>                           veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#a8fc4e74b6409f9616968d445b17c3955">sound_type</a>, veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#a6f9a3d0f9d4799259b30a03fd1598c4d">sound_variant</a> );</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>        }</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>        <span class="keywordflow">if</span>( veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#a2ce8428df648cdf20dc6ac59effcb757">do_explosion</a> ) {</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>            <a class="code hl_function" href="namespaceexplosion__handler.html#aedf90c876bd69288b266c6a60dbc91dc">explosion_handler::explosion</a>( p, veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#a12a8a69fabc09c46c94a872c3deabfc3">damage</a>, 0.5f, <span class="keyword">false</span>, veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#ad34f1fa0ddea2be0516fe52076755d28">shrapnel</a> );</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>            <span class="comment">// Hit the wheel directly since it ran right over the trap.</span></div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>            <a class="code hl_function" href="classvehicle.html#ac2de625db1619f042c4a3a69d0995a6a">damage_direct</a>( pwh, veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#a12a8a69fabc09c46c94a872c3deabfc3">damage</a> );</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>        }</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>        <span class="keywordtype">bool</span> still_has_trap = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>        <span class="keywordflow">if</span>( veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#acf9ea314f7998e6a589bb3187c6ae6a2">remove_trap</a> || veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#a2ce8428df648cdf20dc6ac59effcb757">do_explosion</a> ) {</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>            here.<a class="code hl_function" href="classmap.html#ae6be5b2b977897215861971bf64fb502">remove_trap</a>( p );</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>            still_has_trap = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>        }</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;it : veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#a85267d7b741db092465b148b86e023a7">spawn_items</a> ) {</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>            <span class="keywordtype">int</span> cnt = <a class="code hl_function" href="rng_8cpp.html#acd19ae79e3590a99c9eaf0389318b686">roll_remainder</a>( it.second );</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>            <span class="keywordflow">if</span>( cnt &gt; 0 ) {</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>                here.<a class="code hl_function" href="classmap.html#acfe43259087397daac52876165a3120c">spawn_item</a>( p, it.first, cnt );</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>            }</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>        }</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>        <span class="keywordflow">if</span>( veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#ab19712f6fbd3b157f986b29925197dd3">set_trap</a> ) {</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>            here.<a class="code hl_function" href="classmap.html#ade82e480520c05f5a4e8917df19cef8c">trap_set</a>( p, veh_data.<a class="code hl_variable" href="structvehicle__handle__trap__data.html#ab19712f6fbd3b157f986b29925197dd3">set_trap</a>.<a class="code hl_function" href="classstring__id.html#aa3cde2bfb58efa9621289c0a70d24c5a">id</a>() );</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>            still_has_trap = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>        }</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>        <span class="keywordflow">if</span>( still_has_trap ) {</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>            <span class="keyword">const</span> <a class="code hl_struct" href="structtrap.html">trap</a> &amp;tr = here.<a class="code hl_function" href="classmap.html#a30ccb67ed3651d350f2caf214e0b5176">tr_at</a>( p );</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>            <span class="keywordflow">if</span>( seen || known ) {</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>                <span class="comment">// known status has been reset by map::trap_set()</span></div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>                player_character.<a class="code hl_function" href="classCharacter.html#ada34ca3fb472a8b1816e297ead2b31df">add_known_trap</a>( p, tr );</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>            }</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>            <span class="keywordflow">if</span>( seen &amp;&amp; !known ) {</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>                <span class="comment">// hard to miss!</span></div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>                <span class="keyword">const</span> std::string <a class="code hl_enumeration" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> = <a class="code hl_function" href="line_8cpp.html#a19634ed59e09da9312d6fa110a38539c">direction_name</a>( <a class="code hl_function" href="coordinates_8h.html#a00be0762df7b46da965e55caffac53db">direction_from</a>( player_character.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), p ) );</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>                <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You&#39;ve spotted a %1$s to the %2$s!&quot;</span> ), tr.<a class="code hl_function" href="structtrap.html#a01b0ef8443ac5ba4e7455880ca2dc44b">name</a>(), <a class="code hl_enumeration" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> );</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>            }</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>        }</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>    }</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>}</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span> </div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno"><a class="line" href="classvehicle.html#a8c4e8182afb214351822aa818e919c52">  919</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classvehicle.html#a8c4e8182afb214351822aa818e919c52">vehicle::has_harnessed_animal</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> e = 0; e &lt; <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>.size(); e++ ) {</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structvehicle__part.html">vehicle_part</a> &amp;vp = <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[ e ];</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>        <span class="keywordflow">if</span>( vp.<a class="code hl_function" href="structvehicle__part.html#a002a1023cd1a96d43556a1b912ebd27b">info</a>().<a class="code hl_variable" href="classvpart__info.html#ae9c50d26b3cc88604ae85573ee6599cd">fuel_type</a> == <a class="code hl_variable" href="vehicle__move_8cpp.html#a944ba9be1d911a61e9ca62af989355fd">fuel_type_animal</a> ) {</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>            <a class="code hl_class" href="classmonster.html">monster</a> *mon = <a class="code hl_function" href="classvehicle.html#ab266c3250ffece69b5c2ddc9897d80d3">get_pet</a>( e );</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>            <span class="keywordflow">if</span>( mon &amp;&amp; mon-&gt;<a class="code hl_function" href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">has_effect</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#a7697771dc47ecaeff36785ff20c9aa33">effect_harnessed</a> ) &amp;&amp; mon-&gt;<a class="code hl_function" href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">has_effect</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#a02a4844a7fb68c13a34dc40b0a9e94d8">effect_pet</a> ) ) {</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>            }</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>        }</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>    }</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>}</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span> </div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno"><a class="line" href="classvehicle.html#ac8a5271d6aeae28a1bd341800cc5254d">  933</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classvehicle.html#ac8a5271d6aeae28a1bd341800cc5254d">vehicle::selfdrive</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structpoint.html">point</a> &amp;p )</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>{</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>    <span class="keywordflow">if</span>( !<a class="code hl_function" href="classvehicle.html#ac24aba962fd53d1a87bf57b52ce40508">is_towed</a>() &amp;&amp; !<a class="code hl_variable" href="classvehicle.html#a506fb7b0a17c1578498599e14c173710">magic</a> ) {</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>        <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> e = 0; e &lt; <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>.size(); e++ ) {</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>            <span class="keyword">const</span> <a class="code hl_struct" href="structvehicle__part.html">vehicle_part</a> &amp;vp = <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>[ e ];</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>            <span class="keywordflow">if</span>( vp.<a class="code hl_function" href="structvehicle__part.html#a002a1023cd1a96d43556a1b912ebd27b">info</a>().<a class="code hl_variable" href="classvpart__info.html#ae9c50d26b3cc88604ae85573ee6599cd">fuel_type</a> == <a class="code hl_variable" href="vehicle__move_8cpp.html#a944ba9be1d911a61e9ca62af989355fd">fuel_type_animal</a> ) {</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>                <a class="code hl_class" href="classmonster.html">monster</a> *mon = <a class="code hl_function" href="classvehicle.html#ab266c3250ffece69b5c2ddc9897d80d3">get_pet</a>( e );</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>                <span class="keywordflow">if</span>( !mon || !mon-&gt;<a class="code hl_function" href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">has_effect</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#a7697771dc47ecaeff36785ff20c9aa33">effect_harnessed</a> ) || !mon-&gt;<a class="code hl_function" href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">has_effect</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#a02a4844a7fb68c13a34dc40b0a9e94d8">effect_pet</a> ) ) {</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>                    <a class="code hl_variable" href="classvehicle.html#a26f98c384048e03538bca10e4f26905d">is_following</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>                }</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>            }</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>        }</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    }</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> turn_delta = 15_degrees * p.<a class="code hl_variable" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a>;</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> handling_diff = <a class="code hl_function" href="classvehicle.html#aedeb37c9ce1c25bd8b9765e91ef6e502">handling_difficulty</a>();</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>    <span class="keywordflow">if</span>( turn_delta != 0_degrees ) {</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>        <span class="keywordtype">float</span> eff = <a class="code hl_function" href="classvehicle.html#aec2fcbe01499d105316d14c8b99107a2">steering_effectiveness</a>();</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>        <span class="keywordflow">if</span>( eff == -2 ) {</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>        }</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span> </div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>        <span class="keywordflow">if</span>( eff &lt; 0 ) {</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>        }</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span> </div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>        <span class="keywordflow">if</span>( eff == 0 ) {</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>        }</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>        <a class="code hl_function" href="classvehicle.html#a1380ff85985897f9f8a34eba538e04db">turn</a>( turn_delta );</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>    }</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>    <span class="keywordflow">if</span>( p.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> != 0 ) {</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>        <span class="keywordtype">int</span> thr_amount = 100 * ( std::abs( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> ) &lt; 2000 ? 4 : 5 );</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#abdf6601268460dc437ef079590deb33b">cruise_on</a> ) {</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>            <a class="code hl_function" href="classvehicle.html#ac9e0d3482a62d5ac5ec8e5fc83cfaa4a">cruise_thrust</a>( -p.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> * thr_amount );</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>            <a class="code hl_function" href="classvehicle.html#a0b298dcb96f6d82ac696f38d9a89868b">thrust</a>( -p.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> );</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>        }</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>    }</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>    <span class="comment">// TODO: Actually check if we&#39;re on land on water (or disable water-skidding)</span></div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> &amp;&amp; <a class="code hl_function" href="classvehicle.html#a578c681656be6b419c62799006008035">valid_wheel_config</a>() ) {<span class="comment"></span></div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span><span class="comment">        ///\EFFECT_DEX increases chance of regaining control of a vehicle</span></div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span><span class="comment">        ///\EFFECT_DRIVING increases chance of regaining control of a vehicle</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span><span class="comment"></span>        <span class="keywordflow">if</span>( handling_diff * <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 1, 10 ) &lt; 15 ) {</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>            <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code hl_function" href="classvehicle.html#a8e7305881802ea38e07925826da63b82">forward_velocity</a>() );</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>            <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>            <a class="code hl_variable" href="classvehicle.html#a8bbdfb41ea75fdc007feab08e2137aa2">move</a>.<a class="code hl_function" href="classtileray.html#ab643ca3c50332c73009031331e7c8026">init</a>( <a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> );</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>        }</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>    }</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>}</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span> </div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno"><a class="line" href="classvehicle.html#a58757e10821fc870895d84ebc4ac36a7">  985</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classvehicle.html#a58757e10821fc870895d84ebc4ac36a7">vehicle::check_is_heli_landed</a>()</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>{</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>    <span class="comment">// @TODO - when there are chasms that extend below z-level 0 - perhaps the heli</span></div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>    <span class="comment">// will be able to descend into them but for now, assume z-level-0 == the ground.</span></div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a3900ee345be0453828a955a200154db1">global_pos3</a>().z == 0 || !<a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().has_flag_ter_or_furn( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a7ae3043cdc343c2784d644bcafe86269">TFLAG_NO_FLOOR</a>, <a class="code hl_function" href="classvehicle.html#a3900ee345be0453828a955a200154db1">global_pos3</a>() ) ) {</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>        <a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>    }</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>}</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span> </div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno"><a class="line" href="classvehicle.html#a2451db6447a956b203210ffaa654a59c">  996</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classvehicle.html#a2451db6447a956b203210ffaa654a59c">vehicle::check_heli_descend</a>( <a class="code hl_class" href="classplayer.html">player</a> &amp;p )</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>{</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    <span class="keywordflow">if</span>( !<a class="code hl_function" href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">is_rotorcraft</a>() ) {</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;A vehicle is somehow flying without being an aircraft&quot;</span> );</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>    }</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>    <span class="keywordtype">int</span> <a class="code hl_function" href="namespacedetail.html#ab2f84fb3de26acdac3fc63a2dce5ea5e">count</a> = 0;</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    <span class="keywordtype">int</span> air_count = 0;</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;pt : <a class="code hl_function" href="classvehicle.html#a2e80dafb2c03147b569688658843d9d6">get_points</a>( <span class="keyword">true</span> ) ) {</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> below( pt.xy(), pt.z - 1 );</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>        <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#abff2fded83a8e96e5e20084c3cb59579">has_zlevels</a>() &amp;&amp; ( pt.z &lt; -<a class="code hl_variable" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a> ||</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>                                    !here.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a7ae3043cdc343c2784d644bcafe86269">TFLAG_NO_FLOOR</a>, pt ) ) ) {</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>            p.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You are already landed!&quot;</span> ) );</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>        }</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>        <span class="keyword">const</span> <a class="code hl_class" href="classoptional__vpart__position.html">optional_vpart_position</a> ovp = here.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( below );</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>        <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#a82534d8752a0be6bbb000928d1f1978b">impassable_ter_furn</a>( below ) || ovp || <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( below ) ) {</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>            p.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>,</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>                                 <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;It would be unsafe to try and land when there are obstacles below you.&quot;</span> ) );</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>        }</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>        <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a7ae3043cdc343c2784d644bcafe86269">TFLAG_NO_FLOOR</a>, below ) ) {</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>            air_count++;</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>        }</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>        <a class="code hl_function" href="namespacedetail.html#ab2f84fb3de26acdac3fc63a2dce5ea5e">count</a>++;</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>    }</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> &gt; 0 &amp;&amp; air_count != <a class="code hl_function" href="namespacedetail.html#ab2f84fb3de26acdac3fc63a2dce5ea5e">count</a> ) {</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>        p.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;It would be unsafe to try and land while you are moving.&quot;</span> ) );</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    }</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span> </div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>}</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span> </div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"><a class="line" href="classvehicle.html#a7d3113700f4a8faafbdf34a46278687b"> 1031</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classvehicle.html#a7d3113700f4a8faafbdf34a46278687b">vehicle::check_heli_ascend</a>( <a class="code hl_class" href="classplayer.html">player</a> &amp;p )</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>{</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>    <span class="keywordflow">if</span>( !<a class="code hl_function" href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">is_rotorcraft</a>() ) {</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;A vehicle is somehow flying without being an aircraft&quot;</span> );</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>    }</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> &gt; 0 &amp;&amp; !<a class="code hl_function" href="classvehicle.html#a6ac15340cefeea4793448cdb34784011">is_flying_in_air</a>() ) {</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>        p.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;It would be unsafe to try and take off while you are moving.&quot;</span> ) );</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    }</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;pt : <a class="code hl_function" href="classvehicle.html#a2e80dafb2c03147b569688658843d9d6">get_points</a>( <span class="keyword">true</span> ) ) {</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> above( pt.xy(), pt.z + 1 );</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>        <span class="keywordflow">if</span>( !here.<a class="code hl_function" href="classmap.html#aa00000bc092d452f60dc532532d58232">inbounds_z</a>( above.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> ) ) {</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>            p.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;It would be unsafe to try and ascend further.&quot;</span> ) );</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>        }</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>        <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a526400ab16c5537e7cbbe1a1a400ae6e">TFLAG_INDOORS</a>, pt )</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>            || here.<a class="code hl_function" href="classmap.html#a82534d8752a0be6bbb000928d1f1978b">impassable_ter_furn</a>( above )</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>            || here.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( above )</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>            || <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( above )</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>          ) {</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>            p.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>,</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>                                 <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;It would be unsafe to try and ascend when there are obstacles above you.&quot;</span> ) );</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>        }</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>    }</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>}</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span> </div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"><a class="line" href="classvehicle.html#a8ee4e09fef222f0db06421381be4a354"> 1061</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classvehicle.html#a8ee4e09fef222f0db06421381be4a354">vehicle::pldrive</a>( <a class="code hl_class" href="classCharacter.html">Character</a> &amp;driver, <span class="keyword">const</span> <a class="code hl_struct" href="structpoint.html">point</a> &amp;p, <span class="keywordtype">int</span> z )</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>{</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>    <span class="keywordflow">if</span>( z != 0 &amp;&amp; <a class="code hl_function" href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">is_rotorcraft</a>() ) {</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>        driver.<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> = std::min( driver.<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a>, 0 );</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>        <a class="code hl_function" href="classvehicle.html#a0b298dcb96f6d82ac696f38d9a89868b">thrust</a>( 0, z );</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>    }</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> turn_delta = 15_degrees * p.<a class="code hl_variable" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a>;</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> handling_diff = <a class="code hl_function" href="classvehicle.html#aedeb37c9ce1c25bd8b9765e91ef6e502">handling_difficulty</a>();</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>    <span class="keywordflow">if</span>( turn_delta != 0_degrees ) {</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>        <span class="keywordtype">float</span> eff = <a class="code hl_function" href="classvehicle.html#aec2fcbe01499d105316d14c8b99107a2">steering_effectiveness</a>();</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>        <span class="keywordflow">if</span>( eff == -2 ) {</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>            driver.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a>,</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>                                      <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You cannot steer an animal-drawn vehicle with no animal harnessed.&quot;</span> ) );</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>        }</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span> </div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>        <span class="keywordflow">if</span>( eff &lt; 0 ) {</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>            driver.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a>,</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>                                      <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;This vehicle has no steering system installed, you can&#39;t turn it.&quot;</span> ) );</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>        }</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span> </div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>        <span class="keywordflow">if</span>( eff == 0 ) {</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>            driver.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The steering is completely broken!&quot;</span> ) );</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>        }</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span> </div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>        <span class="comment">// If you&#39;ve got more moves than speed, it&#39;s most likely time stop</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>        <span class="comment">// Let&#39;s get rid of that</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        driver.<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> = std::min( driver.<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a>, driver.<a class="code hl_function" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() );</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span><span class="comment"></span> </div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span><span class="comment">        ///\EFFECT_DEX reduces chance of losing control of vehicle when turning</span></div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span><span class="comment">        ///\EFFECT_PER reduces chance of losing control of vehicle when turning</span></div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span><span class="comment">        ///\EFFECT_DRIVING reduces chance of losing control of vehicle when turning</span></div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span><span class="comment"></span>        <span class="keywordtype">float</span> skill = std::min( 10.0f, driver.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a> ) +</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>                                ( driver.<a class="code hl_function" href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">get_dex</a>() + driver.<a class="code hl_function" href="classCharacter.html#abb0a1847902e6db0bd3c923ee8187702">get_per</a>() ) / 10.0f );</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>        <span class="keywordtype">float</span> penalty = <a class="code hl_function" href="rng_8cpp.html#a0c88381d6334a2fbaa726c53f5cf9bb9">rng_float</a>( 0.0f, handling_diff ) - skill;</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>        <span class="keywordtype">int</span> cost;</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>        <span class="keywordflow">if</span>( penalty &gt; 0.0f ) {</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>            <span class="comment">// At 10 penalty (rather hard to get), we&#39;re taking 4 turns per turn</span></div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>            cost = 100 * ( 1.0f + penalty / 2.5f );</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>            <span class="comment">// At 10 skill, with a perfect vehicle, we could turn up to 3 times per turn</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>            cost = std::max( driver.<a class="code hl_function" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>(), 100 ) * ( 1.0f - ( -penalty / 10.0f ) * 2 / 3 );</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>        }</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span> </div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>        <span class="keywordflow">if</span>( penalty &gt; skill || cost &gt; 400 ) {</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>            driver.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You fumble with the %s&#39;s controls.&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>            <span class="comment">// Anything from a wasted attempt to 2 turns in the intended direction</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>            turn_delta *= <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 0, 2 );</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>            <span class="comment">// Also wastes next turn</span></div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>            cost = std::max( cost, driver.<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> + 100 );</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 10 ) ) {</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>            <span class="comment">// Don&#39;t warn all the time or it gets spammy</span></div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>            <span class="keywordflow">if</span>( cost &gt;= driver.<a class="code hl_function" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() * 2 ) {</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>                driver.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;It takes you a very long time to steer that vehicle!&quot;</span> ) );</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( cost &gt;= driver.<a class="code hl_function" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() * 1.5f ) {</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>                driver.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;It takes you a long time to steer that vehicle!&quot;</span> ) );</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>            }</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>        }</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span> </div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>        <a class="code hl_function" href="classvehicle.html#a1380ff85985897f9f8a34eba538e04db">turn</a>( turn_delta );</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span> </div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>        <span class="comment">// At most 3 turns per turn, because otherwise it looks really weird and jumpy</span></div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>        driver.<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> -= std::max( cost, driver.<a class="code hl_function" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() / 3 + 1 );</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>    }</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span> </div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>    <span class="keywordflow">if</span>( p.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> != 0 ) {</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>        <span class="keywordtype">int</span> thr_amount = 100 * ( std::abs( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> ) &lt; 2000 ? 4 : 5 );</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#abdf6601268460dc437ef079590deb33b">cruise_on</a> ) {</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>            <a class="code hl_function" href="classvehicle.html#ac9e0d3482a62d5ac5ec8e5fc83cfaa4a">cruise_thrust</a>( -p.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> * thr_amount );</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>            <a class="code hl_function" href="classvehicle.html#a0b298dcb96f6d82ac696f38d9a89868b">thrust</a>( -p.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> );</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>            driver.<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> = std::min( driver.<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a>, 0 );</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>        }</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>    }</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span> </div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>    <span class="comment">// TODO: Actually check if we&#39;re on land on water (or disable water-skidding)</span></div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>    <span class="comment">// Only check for recovering from a skid if we did active steering (not cruise control).</span></div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> &amp;&amp; ( p.<a class="code hl_variable" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> != 0 || ( p.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> != 0 &amp;&amp; !<a class="code hl_variable" href="classvehicle.html#abdf6601268460dc437ef079590deb33b">cruise_on</a> ) ) &amp;&amp; <a class="code hl_function" href="classvehicle.html#a578c681656be6b419c62799006008035">valid_wheel_config</a>() ) {<span class="comment"></span></div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span><span class="comment">        ///\EFFECT_DEX increases chance of regaining control of a vehicle</span></div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span><span class="comment">        ///\EFFECT_DRIVING increases chance of regaining control of a vehicle</span></div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span><span class="comment"></span>        <span class="keywordflow">if</span>( handling_diff * <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 1, 10 ) &lt;</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>            driver.<a class="code hl_variable" href="classCharacter.html#a4065ac02745befad248425d307b71849">dex_cur</a> + driver.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a> ) * 2 ) {</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>            driver.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You regain control of the %s.&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>            driver.<a class="code hl_function" href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">as_player</a>()-&gt;<a class="code hl_function" href="classplayer.html#aa57c61de29a5e410c100aee07798b9b1">practice</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a>, <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> / 5 );</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>            <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code hl_function" href="classvehicle.html#a8e7305881802ea38e07925826da63b82">forward_velocity</a>() );</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>            <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>            <a class="code hl_variable" href="classvehicle.html#a8bbdfb41ea75fdc007feab08e2137aa2">move</a>.<a class="code hl_function" href="classtileray.html#ab643ca3c50332c73009031331e7c8026">init</a>( <a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> );</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>        }</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>    }</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>}</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span> </div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span><span class="comment">// A chance to stop skidding if moving in roughly the faced direction</span></div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"><a class="line" href="classvehicle.html#a819beb6aab98cb4b90478b65a35a07ac"> 1158</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classvehicle.html#a819beb6aab98cb4b90478b65a35a07ac">vehicle::possibly_recover_from_skid</a>()</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>{</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a3d4d97e9ca8cb2642001f8f61df500d5">last_turn</a> &gt; 13_degrees ) {</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>        <span class="comment">// Turning on the initial skid is delayed, so move==face, initially. This filters out that case.</span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>    }</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span> </div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>    <a class="code hl_struct" href="structrl__vec2d.html">rl_vec2d</a> mv = <a class="code hl_function" href="classvehicle.html#a0e308fcc9e8b3b08ccf622825e94c9cc">move_vec</a>();</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>    <a class="code hl_struct" href="structrl__vec2d.html">rl_vec2d</a> fv = <a class="code hl_function" href="classvehicle.html#a2bc8dfdab1fadc47966b0a69520c737c">face_vec</a>();</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>    <span class="keywordtype">float</span> <a class="code hl_function" href="simplexnoise_8cpp.html#ac09abdb6d0f634024e3f63d92542e38f">dot</a> = mv.<a class="code hl_function" href="structrl__vec2d.html#acc0292005168ba5d844ab15cfe961d72">dot_product</a>( fv );</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>    <span class="comment">// Threshold of recovery is Gaussianesque.</span></div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span> </div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">std::fabs</a>( <a class="code hl_function" href="simplexnoise_8cpp.html#ac09abdb6d0f634024e3f63d92542e38f">dot</a> ) * 100 &gt; <a class="code hl_function" href="rng_8cpp.html#a7ba03e7147e43d808dc29c54bce9e57f">dice</a>( 9, 20 ) ) {</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>        <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %s recovers from its skid.&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>        <span class="comment">// face_vec takes over.</span></div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>        <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>        <span class="comment">// Wheels absorb horizontal velocity.</span></div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>        <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> *= <a class="code hl_function" href="simplexnoise_8cpp.html#ac09abdb6d0f634024e3f63d92542e38f">dot</a>;</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>        <span class="keywordflow">if</span>( <a class="code hl_function" href="simplexnoise_8cpp.html#ac09abdb6d0f634024e3f63d92542e38f">dot</a> &lt; -.8 ) {</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>            <span class="comment">// Pointed backwards, velo-wise.</span></div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>            <span class="comment">// Move backwards.</span></div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>            <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> *= -1;</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>        }</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span> </div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>        <a class="code hl_variable" href="classvehicle.html#a8bbdfb41ea75fdc007feab08e2137aa2">move</a> = <a class="code hl_variable" href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">face</a>;</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>    }</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>}</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span> </div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span><span class="comment">// if not skidding, move_vec == face_vec, mv &lt;dot&gt; fv == 1, velocity*1 is returned.</span></div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"><a class="line" href="classvehicle.html#a8e7305881802ea38e07925826da63b82"> 1187</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classvehicle.html#a8e7305881802ea38e07925826da63b82">vehicle::forward_velocity</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>    <a class="code hl_struct" href="structrl__vec2d.html">rl_vec2d</a> mv = <a class="code hl_function" href="classvehicle.html#a0e308fcc9e8b3b08ccf622825e94c9cc">move_vec</a>();</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>    <a class="code hl_struct" href="structrl__vec2d.html">rl_vec2d</a> fv = <a class="code hl_function" href="classvehicle.html#a2bc8dfdab1fadc47966b0a69520c737c">face_vec</a>();</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>    <span class="keywordtype">float</span> <a class="code hl_function" href="simplexnoise_8cpp.html#ac09abdb6d0f634024e3f63d92542e38f">dot</a> = mv.<a class="code hl_function" href="structrl__vec2d.html#acc0292005168ba5d844ab15cfe961d72">dot_product</a>( fv );</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> * <a class="code hl_function" href="simplexnoise_8cpp.html#ac09abdb6d0f634024e3f63d92542e38f">dot</a>;</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>}</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span> </div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"><a class="line" href="classvehicle.html#ab1aa616008c1d4180e03c21d3b2ee218"> 1195</a></span><a class="code hl_struct" href="structrl__vec2d.html">rl_vec2d</a> <a class="code hl_function" href="classvehicle.html#ab1aa616008c1d4180e03c21d3b2ee218">vehicle::velo_vec</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>    <a class="code hl_struct" href="structrl__vec2d.html">rl_vec2d</a> <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> ) {</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a> = <a class="code hl_function" href="classvehicle.html#a0e308fcc9e8b3b08ccf622825e94c9cc">move_vec</a>();</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>        <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a> = <a class="code hl_function" href="classvehicle.html#a2bc8dfdab1fadc47966b0a69520c737c">face_vec</a>();</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>    }</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>    <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a> = <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.normalized();</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>    <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a> = <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a> * <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a>;</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>}</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span> </div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"><a class="line" href="vehicle__move_8cpp.html#a0039ad830efb94637bdc1dd04d0fa60c"> 1208</a></span><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code hl_struct" href="structrl__vec2d.html">rl_vec2d</a> <a class="code hl_function" href="vehicle__move_8cpp.html#a0039ad830efb94637bdc1dd04d0fa60c">angle_to_vec</a>( <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> <a class="code hl_typedef" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> )</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>{</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>    <span class="keywordflow">return</span> <a class="code hl_struct" href="structrl__vec2d.html">rl_vec2d</a>( <a class="code hl_function" href="namespaceunits.html#a9c92bd154caa6182d686cab22405b92e">units::cos</a>( <a class="code hl_typedef" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> ), <a class="code hl_function" href="namespaceunits.html#a4b5ee56fbe0ef728f4b190e1282a5d82">units::sin</a>( <a class="code hl_typedef" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> ) );</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>}</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span> </div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span><span class="comment">// normalized.</span></div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"><a class="line" href="classvehicle.html#a0e308fcc9e8b3b08ccf622825e94c9cc"> 1214</a></span><a class="code hl_struct" href="structrl__vec2d.html">rl_vec2d</a> <a class="code hl_function" href="classvehicle.html#a0e308fcc9e8b3b08ccf622825e94c9cc">vehicle::move_vec</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="vehicle__move_8cpp.html#a0039ad830efb94637bdc1dd04d0fa60c">angle_to_vec</a>( <a class="code hl_variable" href="classvehicle.html#a8bbdfb41ea75fdc007feab08e2137aa2">move</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>() );</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>}</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span> </div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span><span class="comment">// normalized.</span></div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"><a class="line" href="classvehicle.html#a2bc8dfdab1fadc47966b0a69520c737c"> 1220</a></span><a class="code hl_struct" href="structrl__vec2d.html">rl_vec2d</a> <a class="code hl_function" href="classvehicle.html#a2bc8dfdab1fadc47966b0a69520c737c">vehicle::face_vec</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="vehicle__move_8cpp.html#a0039ad830efb94637bdc1dd04d0fa60c">angle_to_vec</a>( <a class="code hl_variable" href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">face</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>() );</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>}</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span> </div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"><a class="line" href="classvehicle.html#a050dcaa8958d866388b780738cf0e87d"> 1225</a></span><a class="code hl_struct" href="structrl__vec2d.html">rl_vec2d</a> <a class="code hl_function" href="classvehicle.html#a050dcaa8958d866388b780738cf0e87d">vehicle::dir_vec</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="vehicle__move_8cpp.html#a0039ad830efb94637bdc1dd04d0fa60c">angle_to_vec</a>( <a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> );</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>}</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span> </div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"><a class="line" href="vehicle_8h.html#a2ec7c19839319714651fd65f3854986c"> 1230</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="vehicle__move_8cpp.html#a773926a54d526c780fa7b340eaaaa6a4">get_collision_factor</a>( <span class="keyword">const</span> <span class="keywordtype">float</span> delta_v )</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>{</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>    <span class="keywordflow">if</span>( std::abs( delta_v ) &lt;= 31 ) {</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>        <span class="keywordflow">return</span> ( 1 - ( 0.9 * std::abs( delta_v ) ) / 31 );</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>        <span class="keywordflow">return</span> 0.1;</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>    }</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>}</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span> </div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"><a class="line" href="classvehicle.html#a8a79185fd4b15560f76504af979b0bba"> 1239</a></span><a class="code hl_class" href="classvehicle.html">vehicle</a> *<a class="code hl_function" href="classvehicle.html#a8a79185fd4b15560f76504af979b0bba">vehicle::act_on_map</a>()</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>{</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> pt = <a class="code hl_function" href="classvehicle.html#a3900ee345be0453828a955a200154db1">global_pos3</a>();</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>    <span class="keywordflow">if</span>( !here.<a class="code hl_function" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( pt ) ) {</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>        <a class="code hl_define" href="vehicle__move_8cpp.html#a49bc164f30e64702250d2cbea09bf86c">dbg</a>( <a class="code hl_enumvalue" href="debug_8h.html#a157bb3f8cadfd404439ad477a19e8515a4059b0251f66a18cb56f544728796875">DL::Info</a> ) &lt;&lt; <span class="stringliteral">&quot;stopping out-of-map vehicle at global pos &quot;</span> &lt;&lt; pt;</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>        <a class="code hl_function" href="classvehicle.html#ab3ca604dd9cd1907f37c8a888934a1d3">stop</a>( <span class="keyword">false</span> );</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>        <a class="code hl_variable" href="classvehicle.html#af757f49411232815e121faa825d415f7">of_turn</a> = 0;</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>        <a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>        <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>    }</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#abeeecc873ea4841652366d8ffc6c3bfe">decrement_summon_timer</a>() ) {</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>    }</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>    <a class="code hl_class" href="classCharacter.html">Character</a> &amp;player_character = <a class="code hl_function" href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a>();</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> pl_ctrl = <a class="code hl_function" href="classvehicle.html#a341515426011486c265d016c35f84de6">player_in_control</a>( player_character );</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>    <span class="comment">// TODO: Remove this hack, have vehicle sink a z-level</span></div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#ae3cbbbb890aa9a12504ec3458746f3e1">is_floating</a> &amp;&amp; !<a class="code hl_function" href="classvehicle.html#ac460f925a21efb9dea1dc0fc2f930609">can_float</a>() ) {</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>        <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s sank.&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>        <span class="keywordflow">if</span>( pl_ctrl ) {</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>            <a class="code hl_function" href="classvehicle.html#a222ab75111163098b53f34a28e017dad">unboard_all</a>();</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>        }</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;remoteveh() == <span class="keyword">this</span> ) {</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>            <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;setremoteveh( <span class="keyword">nullptr</span> );</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>        }</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span> </div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>        here.<a class="code hl_function" href="classmap.html#aac63fb28872f612df34a7f9a86898ed7">on_vehicle_moved</a>( <a class="code hl_variable" href="classvehicle.html#a34630935e46860003c616e0522316f02">sm_pos</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>        <span class="comment">// Destroy vehicle (sank to nowhere)</span></div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>        here.<a class="code hl_function" href="classmap.html#ac7f59f4bc6fad84a8d8c0ddd4e023734">destroy_vehicle</a>( <span class="keyword">this</span> );</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>    }</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span> </div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>    <span class="comment">// It needs to fall when it has no support OR was falling before</span></div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>    <span class="comment">//  so that vertical collisions happen.</span></div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> should_fall = <a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> || <a class="code hl_variable" href="classvehicle.html#a416a2bc9ee792663fced3344db322cb8">vertical_velocity</a> != 0;</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span> </div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>    <span class="comment">// TODO: Saner diagonal movement, so that you can jump off cliffs properly</span></div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>    <span class="comment">// The ratio of vertical to horizontal movement should be vertical_velocity/velocity</span></div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>    <span class="comment">//  for as long as of_turn doesn&#39;t run out.</span></div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>    <span class="keywordflow">if</span>( should_fall ) {</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>        <span class="comment">// Convert from 100*mph to m/s</span></div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> old_vel = <a class="code hl_function" href="vehicle__move_8cpp.html#a5b4f290597a25f2c2f9447eb786c37c5">vmiph_to_mps</a>( <a class="code hl_variable" href="classvehicle.html#a416a2bc9ee792663fced3344db322cb8">vertical_velocity</a> );</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>        <span class="comment">// Formula is v_2 = sqrt( 2*d*g + v_1^2 )</span></div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>        <span class="comment">// Note: That drops the sign</span></div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> new_vel = -std::sqrt( 2 * <a class="code hl_variable" href="vehicle__move_8cpp.html#abc9fa7d03f14e2a5323ee0ff66e7938e">tile_height</a> * <a class="code hl_variable" href="units__mass_8h.html#af9bdbc604b3753642c7d25280b6f3114">GRAVITY_OF_EARTH</a> + old_vel * old_vel );</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>        <a class="code hl_variable" href="classvehicle.html#a416a2bc9ee792663fced3344db322cb8">vertical_velocity</a> = <a class="code hl_function" href="vehicle__move_8cpp.html#a3bf51af37129f24d376a74ca56b2644e">mps_to_vmiph</a>( new_vel );</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>        <a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>        <span class="comment">// Not actually falling, was just marked for fall test</span></div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>        <a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>    }</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span> </div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>    <span class="comment">// Low enough for bicycles to go in reverse.</span></div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>    <span class="comment">// If the movement is due to a change in z-level, i.e a helicopter then the lateral movement will often be zero.</span></div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>    <span class="keywordflow">if</span>( !should_fall &amp;&amp; std::abs( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> ) &lt; 20 &amp;&amp; <a class="code hl_variable" href="classvehicle.html#aeb404e5f18eee80d104a7bb0680ac169">requested_z_change</a> == 0 ) {</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>        <a class="code hl_function" href="classvehicle.html#ab3ca604dd9cd1907f37c8a888934a1d3">stop</a>();</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>        <a class="code hl_variable" href="classvehicle.html#af757f49411232815e121faa825d415f7">of_turn</a> -= .321f;</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>        <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>    }</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span> </div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> wheel_traction_area = here.<a class="code hl_function" href="classmap.html#a1d638822dc7c62d6ec6ee4f64ae0f4b2">vehicle_wheel_traction</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> traction = <a class="code hl_function" href="classvehicle.html#a9d41a3f9a7969c40ca5a9b7b5a3fdebe">k_traction</a>( wheel_traction_area );</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>    <span class="keywordflow">if</span>( traction &lt; 0.001f ) {</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>        <a class="code hl_variable" href="classvehicle.html#af757f49411232815e121faa825d415f7">of_turn</a> = 0;</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>        <span class="keywordflow">if</span>( !should_fall ) {</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>            <a class="code hl_function" href="classvehicle.html#ab3ca604dd9cd1907f37c8a888934a1d3">stop</a>();</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#ae94902df801fd06056734d05ea98aa0f">floating</a>.empty() ) {</div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>                <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s can&#39;t move on this terrain.&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>                <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s is beached.&quot;</span> ), <a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>            }</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>        }</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>    }</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> turn_cost = <a class="code hl_variable" href="namespacevehicles.html#a002783f4304f09443cfa9fa8efa9f6d4">vehicles::vmiph_per_tile</a> / std::max&lt;float&gt;( 0.0001f, std::abs( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> ) );</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span> </div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>    <span class="comment">// Can&#39;t afford it this turn?</span></div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>    <span class="comment">// Low speed shouldn&#39;t prevent vehicle from falling, though</span></div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>    <span class="keywordtype">bool</span> falling_only = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>    <span class="keywordflow">if</span>( turn_cost &gt;= <a class="code hl_variable" href="classvehicle.html#af757f49411232815e121faa825d415f7">of_turn</a> &amp;&amp; ( ( !<a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> &amp;&amp; <a class="code hl_variable" href="classvehicle.html#aeb404e5f18eee80d104a7bb0680ac169">requested_z_change</a> == 0 ) || !<a class="code hl_function" href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">is_rotorcraft</a>() ) ) {</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>        <span class="keywordflow">if</span>( !should_fall ) {</div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>            <a class="code hl_variable" href="classvehicle.html#a3d2d513640544cb11fa826890b692e5a">of_turn_carry</a> = <a class="code hl_variable" href="classvehicle.html#af757f49411232815e121faa825d415f7">of_turn</a>;</div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>            <a class="code hl_variable" href="classvehicle.html#af757f49411232815e121faa825d415f7">of_turn</a> = 0;</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>        }</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>        falling_only = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>    }</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span> </div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>    <span class="comment">// Decrease of_turn if falling+moving, but not when it&#39;s lower than move cost</span></div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>    <span class="keywordflow">if</span>( !falling_only ) {</div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>        <a class="code hl_variable" href="classvehicle.html#af757f49411232815e121faa825d415f7">of_turn</a> -= turn_cost;</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>    }</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span> </div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="classvehicle.html#a9c46063d58fd3a05504dec8bb8b6e837">can_use_rails</a> = this-&gt;<a class="code hl_function" href="classvehicle.html#a9c46063d58fd3a05504dec8bb8b6e837">can_use_rails</a>();</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="namespacevehicle__movement.html#ad2c532fb5522d745b0006f7a3b36cab3">is_on_rails</a> = <a class="code hl_function" href="namespacevehicle__movement.html#ad2c532fb5522d745b0006f7a3b36cab3">vehicle_movement::is_on_rails</a>( here, *<span class="keyword">this</span> );</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 10 ) ) {</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>        <span class="keywordtype">bool</span> controlled = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>        <span class="comment">// It can even be a NPC, but must be at the controls</span></div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> boarded : <a class="code hl_function" href="classvehicle.html#ab429af6376b555746f92158331f2a4cf">boarded_parts</a>() ) {</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>            <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a00f013bfeaa4b6d44eaa67961f0c1e59">part_with_feature</a>( boarded, <a class="code hl_enumvalue" href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307ea1d493984c83c95a15238b6e21f4547d0">VPFLAG_CONTROLS</a>, <span class="keyword">true</span> ) &gt;= 0 ) {</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>                controlled = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>                <a class="code hl_class" href="classplayer.html">player</a> *passenger = <a class="code hl_function" href="classvehicle.html#af02a0418851ddf50fcc810951d77b076">get_passenger</a>( boarded );</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>                <span class="keywordflow">if</span>( passenger != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>                    passenger-&gt;<a class="code hl_function" href="classplayer.html#aa57c61de29a5e410c100aee07798b9b1">practice</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a>, 1 );</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>                }</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>            }</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>        }</div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span> </div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>        <span class="comment">// Eventually send it skidding if no control</span></div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>        <span class="comment">// But not if it&#39;s remotely controlled, is in water or is on rails</span></div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>        <span class="keywordflow">if</span>( !controlled &amp;&amp; !pl_ctrl &amp;&amp; !<a class="code hl_variable" href="classvehicle.html#ae3cbbbb890aa9a12504ec3458746f3e1">is_floating</a> &amp;&amp; !<a class="code hl_function" href="namespacevehicle__movement.html#ad2c532fb5522d745b0006f7a3b36cab3">is_on_rails</a> &amp;&amp; !<a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> &amp;&amp;</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>            <a class="code hl_variable" href="classvehicle.html#aeb404e5f18eee80d104a7bb0680ac169">requested_z_change</a> == 0 ) {</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>            <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>        }</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>    }</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span> </div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> &amp;&amp; <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 4 ) ) {</div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>        <span class="comment">// Might turn uncontrollably while skidding</span></div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>        <a class="code hl_function" href="classvehicle.html#a1380ff85985897f9f8a34eba538e04db">turn</a>( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 2 ) ? -15_degrees : 15_degrees );</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>    }</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span> </div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>    <span class="keywordflow">if</span>( should_fall ) {</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>        <span class="comment">// TODO: Insert a (hard) driving test to stop this from happening</span></div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>        <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>    }</div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span> </div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>    <a class="code hl_struct" href="structvehicle__movement_1_1rail__processing__result.html">vehicle_movement::rail_processing_result</a> rpres;</div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#a9c46063d58fd3a05504dec8bb8b6e837">can_use_rails</a> &amp;&amp; !falling_only ) {</div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>        rpres = <a class="code hl_function" href="namespacevehicle__movement.html#a90bf274fc2c6eb229613c63739d8e2c1">vehicle_movement::process_movement_on_rails</a>( here, *<span class="keyword">this</span> );</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>    }</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>    <span class="keywordflow">if</span>( rpres.<a class="code hl_variable" href="structvehicle__movement_1_1rail__processing__result.html#aa10da2e7136704fa25a4af595ae7122b">do_turn</a> ) {</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>        <a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> = rpres.<a class="code hl_variable" href="structvehicle__movement_1_1rail__processing__result.html#a0a31255e2dd466d5580aa4446964f5c7">turn_dir</a>;</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>    }</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span> </div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>    <span class="comment">// The direction we&#39;re moving</span></div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>    <a class="code hl_class" href="classtileray.html">tileray</a> mdir;</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">skidding</a> || should_fall ) {</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>        <span class="comment">// If skidding, it&#39;s the move vector</span></div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>        <span class="comment">// Same for falling - no air control</span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>        mdir = <a class="code hl_variable" href="classvehicle.html#a8bbdfb41ea75fdc007feab08e2137aa2">move</a>;</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> != <a class="code hl_variable" href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">face</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>() &amp;&amp; ( !<a class="code hl_function" href="namespacevehicle__movement.html#ad2c532fb5522d745b0006f7a3b36cab3">is_on_rails</a> || rpres.<a class="code hl_variable" href="structvehicle__movement_1_1rail__processing__result.html#aa10da2e7136704fa25a4af595ae7122b">do_turn</a> ) ) {</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>        <span class="comment">// Driver turned vehicle, get turn_dir</span></div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>        mdir.<a class="code hl_function" href="classtileray.html#ab643ca3c50332c73009031331e7c8026">init</a>( <a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> );</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>        <span class="comment">// Not turning, keep face.dir</span></div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>        mdir = <a class="code hl_variable" href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">face</a>;</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>    }</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span> </div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> dp;</div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>    <span class="keywordflow">if</span>( std::abs( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> ) &gt;= 20 &amp;&amp; !falling_only ) {</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>        mdir.<a class="code hl_function" href="classtileray.html#a283722bbdbde0af59bbda1a26adc5b88">advance</a>( <a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> &lt; 0 ? -1 : 1 );</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>        <span class="keywordflow">if</span>( rpres.<a class="code hl_variable" href="structvehicle__movement_1_1rail__processing__result.html#a894bbd71e540fd9488b350fa60a51096">do_shift</a> ) {</div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>            dp.<a class="code hl_variable" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> = rpres.<a class="code hl_variable" href="structvehicle__movement_1_1rail__processing__result.html#ac8a076ac2aafe3dc22aa6796ffdc04b3">shift_amount</a>.<a class="code hl_variable" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>;</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>            dp.<a class="code hl_variable" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> = rpres.<a class="code hl_variable" href="structvehicle__movement_1_1rail__processing__result.html#ac8a076ac2aafe3dc22aa6796ffdc04b3">shift_amount</a>.<a class="code hl_variable" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>;</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>            dp.<a class="code hl_variable" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> = mdir.<a class="code hl_function" href="classtileray.html#aefd7fd88fdbfecf5731bbff553a7aab8">dx</a>();</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>            dp.<a class="code hl_variable" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> = mdir.<a class="code hl_function" href="classtileray.html#a27e3f200a89812a3d2fbc2e0e5710722">dy</a>();</div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>        }</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>    }</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span> </div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>    <span class="keywordflow">if</span>( should_fall ) {</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>        dp.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> = -1;</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>        <a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>        dp.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> = <a class="code hl_variable" href="classvehicle.html#aeb404e5f18eee80d104a7bb0680ac169">requested_z_change</a>;</div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>        <a class="code hl_variable" href="classvehicle.html#aeb404e5f18eee80d104a7bb0680ac169">requested_z_change</a> = 0;</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>        <span class="keywordflow">if</span>( dp.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> &gt; 0 &amp;&amp; <a class="code hl_function" href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">is_rotorcraft</a>() ) {</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>            <a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>        }</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>    }</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span> </div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>    <span class="keywordflow">return</span> here.<a class="code hl_function" href="classmap.html#add9128611766f2a8095b0104f0fd7371">move_vehicle</a>( *<span class="keyword">this</span>, dp, mdir );</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>}</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span> </div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"><a class="line" href="classvehicle.html#a300054370bb18b67094b827f8c586896"> 1413</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classvehicle.html#a300054370bb18b67094b827f8c586896">vehicle::level_vehicle</a>()</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>{</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>    <span class="keywordflow">if</span>( !here.<a class="code hl_function" href="classmap.html#abff2fded83a8e96e5e20084c3cb59579">has_zlevels</a>() || ( <a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> &amp;&amp; <a class="code hl_function" href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">is_rotorcraft</a>() ) ) {</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>    }</div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>    <span class="comment">// make sure that all parts are either supported across levels or on the same level</span></div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>    std::map&lt;int, bool&gt; no_support;</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>    <span class="keywordflow">for</span>( <a class="code hl_struct" href="structvehicle__part.html">vehicle_part</a> &amp;prt : <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a> ) {</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>        <span class="keywordflow">if</span>( prt.info().location != <a class="code hl_function" href="vehicle__move_8cpp.html#a00735c0bfb68c2a0c0c7d53e8f72a70e">part_location_structure</a> ) {</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>        }</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> part_pos = <a class="code hl_function" href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">global_part_pos3</a>( prt );</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>        <span class="keywordflow">if</span>( no_support.find( part_pos.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> ) == no_support.end() ) {</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>            no_support[part_pos.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>] = part_pos.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> &gt; -<a class="code hl_variable" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a>;</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>        }</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>        <span class="keywordflow">if</span>( no_support[part_pos.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>] ) {</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>            no_support[part_pos.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>] = here.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a7ae3043cdc343c2784d644bcafe86269">TFLAG_NO_FLOOR</a>, part_pos ) &amp;&amp;</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span>                                     !here.<a class="code hl_function" href="classmap.html#a3779768673ad08004a999b1ac440421c">supports_above</a>( part_pos + <a class="code hl_variable" href="point_8h.html#a53f9f23b765219169daffe4c54ad5b8f">tripoint_below</a> );</div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>        }</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>    }</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>    std::set&lt;int&gt; dropped_parts;</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>    <span class="comment">// if it&#39;s unsupported but on the same level, just let it fall</span></div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>    <span class="keywordtype">bool</span> center_drop = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span>    <span class="keywordtype">bool</span> adjust_level = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>    <span class="keywordflow">if</span>( no_support.size() &gt; 1 ) {</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> zlevel = -<a class="code hl_variable" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a>; zlevel &lt;= <a class="code hl_variable" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a>; zlevel++ ) {</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>            <span class="keywordflow">if</span>( no_support.find( zlevel ) == no_support.end() || !no_support[zlevel] ) {</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>            }</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>            center_drop |= <a class="code hl_function" href="classvehicle.html#a3900ee345be0453828a955a200154db1">global_pos3</a>().<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> == zlevel;</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>            adjust_level = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>            <span class="comment">// drop unsupported parts 1 zlevel</span></div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> prt = 0; prt &lt; <a class="code hl_variable" href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">parts</a>.size(); prt++ ) {</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>                <span class="keywordflow">if</span>( <a class="code hl_function" href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">global_part_pos3</a>( prt ).z == zlevel ) {</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>                    dropped_parts.insert( <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( prt ) );</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>                }</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>            }</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>        }</div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>    }</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>    <span class="keywordflow">if</span>( adjust_level ) {</div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>        here.<a class="code hl_function" href="classmap.html#abeefac00972febd607e98bb0431bd5a9">displace_vehicle</a>( *<span class="keyword">this</span>, <a class="code hl_variable" href="point_8h.html#a53f9f23b765219169daffe4c54ad5b8f">tripoint_below</a>, center_drop, dropped_parts );</div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>    }</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>}</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span> </div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"><a class="line" href="classvehicle.html#a63b06a1d61d0c44f460077314bb742a8"> 1461</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classvehicle.html#a63b06a1d61d0c44f460077314bb742a8">vehicle::check_falling_or_floating</a>()</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>{</div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>    <span class="comment">// TODO: Make the vehicle &quot;slide&quot; towards its center of weight</span></div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>    <span class="comment">//  when it&#39;s not properly supported</span></div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;pts = <a class="code hl_function" href="classvehicle.html#a2e80dafb2c03147b569688658843d9d6">get_points</a>( <span class="keyword">true</span> );</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>    <span class="keywordflow">if</span>( pts.empty() ) {</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span>        <span class="comment">// Dirty vehicle with no parts</span></div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>        <a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>        <a class="code hl_variable" href="classvehicle.html#ae3cbbbb890aa9a12504ec3458746f3e1">is_floating</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>        <a class="code hl_variable" href="classvehicle.html#a3cfee06c49af306085cad6bbf3326319">in_water</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>        <a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>    }</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span> </div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>    <a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> = here.<a class="code hl_function" href="classmap.html#abff2fded83a8e96e5e20084c3cb59579">has_zlevels</a>();</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span> </div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> &amp;&amp; <a class="code hl_function" href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">is_rotorcraft</a>() ) {</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>        <a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>        <a class="code hl_variable" href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">is_flying</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>    }</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span> </div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>    <span class="keywordtype">size_t</span> deep_water_tiles = 0;</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>    <span class="keywordtype">size_t</span> water_tiles = 0;</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;p : pts ) {</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> ) {</div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>            <a class="code hl_struct" href="structtripoint.html">tripoint</a> below( p.xy(), p.z - 1 );</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>            <a class="code hl_variable" href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">is_falling</a> &amp;= here.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a7ae3043cdc343c2784d644bcafe86269">TFLAG_NO_FLOOR</a>, p ) &amp;&amp;</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>                          ( p.z &gt; -<a class="code hl_variable" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a> ) &amp;&amp; !here.<a class="code hl_function" href="classmap.html#a3779768673ad08004a999b1ac440421c">supports_above</a>( below );</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>        }</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>        deep_water_tiles += here.<a class="code hl_function" href="classmap.html#a27e22f0999ea03eff18babc48643c568">has_flag</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258aeb9fcbd752ad2c632ccc4383c5641b69">TFLAG_DEEP_WATER</a>, p ) ? 1 : 0;</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>        water_tiles += here.<a class="code hl_function" href="classmap.html#a27e22f0999ea03eff18babc48643c568">has_flag</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a36b67adb6e7c521980de8a6688085d16">TFLAG_SWIMMABLE</a>, p ) ? 1 : 0;</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>    }</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span>    <span class="comment">// floating if 2/3rds of the vehicle is in deep water</span></div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>    <a class="code hl_variable" href="classvehicle.html#ae3cbbbb890aa9a12504ec3458746f3e1">is_floating</a> = 3 * deep_water_tiles &gt;= 2 * pts.size();</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>    <span class="comment">// in_water if 1/2 of the vehicle is in water at all</span></div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>    <a class="code hl_variable" href="classvehicle.html#a3cfee06c49af306085cad6bbf3326319">in_water</a> =  2 * water_tiles &gt;= pts.size();</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span>}</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span> </div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"><a class="line" href="classmap.html#a1d638822dc7c62d6ec6ee4f64ae0f4b2"> 1501</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classmap.html#a1d638822dc7c62d6ec6ee4f64ae0f4b2">map::vehicle_wheel_traction</a>( <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> &amp;veh,</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>                                   <span class="keyword">const</span> <span class="keywordtype">bool</span> ignore_movement_modifiers <span class="comment">/*=false*/</span> )<span class="keyword"> const</span></div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>    <span class="keywordflow">if</span>( veh.<a class="code hl_function" href="classvehicle.html#a80d02aa674786172d2d8a7ec8f39a4b3">is_in_water</a>( <span class="keyword">true</span> ) ) {</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>        <span class="keywordflow">return</span> veh.<a class="code hl_function" href="classvehicle.html#ac460f925a21efb9dea1dc0fc2f930609">can_float</a>() ? 1.0f : -1.0f;</div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>    }</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span>    <span class="keywordflow">if</span>( veh.<a class="code hl_function" href="classvehicle.html#a80d02aa674786172d2d8a7ec8f39a4b3">is_in_water</a>() &amp;&amp; veh.<a class="code hl_function" href="classvehicle.html#a0ede4cc2a97a8305b1f06817d0d6cdf8">is_watercraft</a>() &amp;&amp; veh.<a class="code hl_function" href="classvehicle.html#ac460f925a21efb9dea1dc0fc2f930609">can_float</a>() ) {</div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>    }</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span> </div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;wheel_indices = veh.<a class="code hl_variable" href="classvehicle.html#a5c432c0da0ff47a483e3aa74548bd435">wheelcache</a>;</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>    <span class="keywordtype">int</span> num_wheels = wheel_indices.size();</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>    <span class="keywordflow">if</span>( num_wheels == 0 ) {</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>        <span class="comment">// TODO: Assume it is digging in dirt</span></div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>        <span class="comment">// TODO: Return something that could be reused for dragging</span></div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>        <span class="keywordflow">return</span> 0.0f;</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>    }</div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span> </div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>    <span class="keywordtype">float</span> traction_wheel_area = 0.0f;</div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span> </div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespacevehicle__movement.html#ad2c532fb5522d745b0006f7a3b36cab3">vehicle_movement::is_on_rails</a>( *<span class="keyword">this</span>, veh ) ) {</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>        <span class="comment">// Vehicles on rails are considered to have all of their wheels on rails</span></div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> p : veh.<a class="code hl_variable" href="classvehicle.html#a905db1f8c84d0754a8e0a121392a2b3a">rail_wheelcache</a> ) {</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>            traction_wheel_area += veh.<a class="code hl_function" href="classvehicle.html#a2adff790fcaea181f096ebaa213e698c">cpart</a>( p ).<a class="code hl_function" href="structvehicle__part.html#a7c9609ecf75f0839401351558a6b5b83">wheel_area</a>();</div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>        }</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>        <span class="keywordflow">return</span> traction_wheel_area;</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>    }</div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span> </div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> p : wheel_indices ) {</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;pp = veh.<a class="code hl_function" href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">global_part_pos3</a>( p );</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> wheel_area = veh.<a class="code hl_function" href="classvehicle.html#a2adff790fcaea181f096ebaa213e698c">cpart</a>( p ).<a class="code hl_function" href="structvehicle__part.html#a7c9609ecf75f0839401351558a6b5b83">wheel_area</a>();</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span> </div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;tr = <a class="code hl_function" href="classmap.html#aba8f330c2cc25be0652489b42d8dd530">ter</a>( pp ).<a class="code hl_function" href="classint__id.html#a4796245d3cd6e0283670698a98d46ae9">obj</a>();</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>        <span class="comment">// Deep water and air</span></div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>        <span class="keywordflow">if</span>( tr.has_flag( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258aeb9fcbd752ad2c632ccc4383c5641b69">TFLAG_DEEP_WATER</a> ) || tr.has_flag( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a7ae3043cdc343c2784d644bcafe86269">TFLAG_NO_FLOOR</a> ) ) {</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>            <span class="comment">// No traction from wheel in water or air</span></div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>        }</div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span> </div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>        <span class="keywordtype">int</span> move_mod = <a class="code hl_function" href="classmap.html#ab3329218e47ef1729d54bbf27622c1ba">move_cost_ter_furn</a>( pp );</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>        <span class="keywordflow">if</span>( move_mod == 0 ) {</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>            <span class="comment">// Vehicle locked in wall</span></div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>            <span class="comment">// Shouldn&#39;t happen, but does</span></div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>            <span class="keywordflow">return</span> 0.0f;</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>        }</div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span> </div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;terrain_mod : veh.<a class="code hl_function" href="classvehicle.html#aab4917d0f78fe4df1c8f5303fdf2b86d">part_info</a>( p ).<a class="code hl_function" href="classvpart__info.html#a318d0a0075dd29d8560228d551d3dc9f">wheel_terrain_mod</a>() ) {</div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>            <span class="keywordflow">if</span>( !tr.has_flag( terrain_mod.first ) ) {</div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>                move_mod += terrain_mod.second;</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>            }</div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>        }</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span> </div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>        <span class="comment">// Ignore the movement modifier if needed.</span></div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>        <span class="keywordflow">if</span>( ignore_movement_modifiers ) {</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>            move_mod = 2;</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>        }</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span> </div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>        traction_wheel_area += 2.0 * wheel_area / move_mod;</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>    }</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span> </div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>    <span class="keywordflow">return</span> traction_wheel_area;</div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>}</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span> </div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"><a class="line" href="classmap.html#ac7023d5bb12f333f7237a08bd471b112"> 1565</a></span><a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> <a class="code hl_function" href="classmap.html#ac7023d5bb12f333f7237a08bd471b112">map::shake_vehicle</a>( <a class="code hl_class" href="classvehicle.html">vehicle</a> &amp;veh, <span class="keyword">const</span> <span class="keywordtype">int</span> velocity_before,</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>                                 <span class="keyword">const</span> <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> <a class="code hl_enumeration" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> )</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span>{</div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> d_vel = std::abs( veh.<a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> - velocity_before ) / 100;</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span> </div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>    std::vector&lt;rider_data&gt; riders = veh.<a class="code hl_function" href="classvehicle.html#a8df35c3f329b78ad0b912181f9e479e5">get_riders</a>();</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span> </div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> coll_turn = 0_degrees;</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structrider__data.html">rider_data</a> &amp;r : riders ) {</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> ps = r.prt;</div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>        <a class="code hl_class" href="classCreature.html">Creature</a> *rider = r.psg;</div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>        <span class="keywordflow">if</span>( rider == <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>            <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;throw passenger: empty passenger at part %d&quot;</span>, ps );</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>        }</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span> </div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> part_pos = veh.<a class="code hl_function" href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">global_part_pos3</a>( ps );</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>        <span class="keywordflow">if</span>( rider-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() != part_pos ) {</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>            <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;throw passenger: passenger at %d,%d,%d, part at %d,%d,%d&quot;</span>,</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>                      rider-&gt;<a class="code hl_function" href="classCreature.html#af712029844aef7ebc7af88a9242e2df0">posx</a>(), rider-&gt;<a class="code hl_function" href="classCreature.html#a1be20ab434ada66748d5b62fcfdbd5e4">posy</a>(), rider-&gt;<a class="code hl_function" href="classCreature.html#a3a3ada596854cf8084b3a728b633a9db">posz</a>(),</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>                      part_pos.<a class="code hl_variable" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, part_pos.<a class="code hl_variable" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, part_pos.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>            veh.<a class="code hl_function" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a>( ps ).<a class="code hl_function" href="structvehicle__part.html#a86c3ad22b1284273f14e63ce726d685d">remove_flag</a>( <a class="code hl_enumvalue" href="structvehicle__part.html#a6944258e64f01a23d5ea254ad2fe71eaacbdd8bab66369a907eb2edbd4b209752">vehicle_part::passenger_flag</a> );</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>        }</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span> </div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>        <a class="code hl_class" href="classplayer.html">player</a> *psg = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classplayer.html">player</a> *<span class="keyword">&gt;</span>( rider );</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>        <a class="code hl_class" href="classmonster.html">monster</a> *pet = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classmonster.html">monster</a> *<span class="keyword">&gt;</span>( rider );</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span> </div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>        <span class="keywordtype">bool</span> throw_from_seat = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>        <span class="keywordtype">int</span> move_resist = 1;</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>        <span class="keywordflow">if</span>( psg ) {<span class="comment"></span></div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span><span class="comment">            ///\EFFECT_STR reduces chance of being thrown from your seat when not wearing a seatbelt</span></div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span><span class="comment"></span>            move_resist = psg-&gt;<a class="code hl_variable" href="classCharacter.html#a26369a0a81eef76cfe75214d22ed32b4">str_cur</a> * 150 + 500;</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>            <span class="keywordtype">int</span> pet_resist = 0;</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>            <span class="keywordflow">if</span>( pet != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>                pet_resist = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code hl_function" href="namespaceunits.html#afbf21a7601bd939c196667fc0b020111">to_kilogram</a>( pet-&gt;<a class="code hl_function" href="classmonster.html#ac657665936ef8e009e683c2fa02f4ce3">get_weight</a>() ) * 200 );</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>            }</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>            move_resist = std::max( 100, pet_resist );</div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>        }</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>        <span class="keywordflow">if</span>( veh.<a class="code hl_function" href="classvehicle.html#a00f013bfeaa4b6d44eaa67961f0c1e59">part_with_feature</a>( ps, <a class="code hl_enumvalue" href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307ea8a546069f510a6de416bf119fe037679">VPFLAG_SEATBELT</a>, <span class="keyword">true</span> ) == -1 ) {<span class="comment"></span></div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span><span class="comment">            ///\EFFECT_STR reduces chance of being thrown from your seat when not wearing a seatbelt</span></div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span><span class="comment"></span>            throw_from_seat = d_vel * <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 80, 120 ) &gt; move_resist;</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>        }</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span> </div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>        <span class="comment">// Damage passengers if d_vel is too high</span></div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>        <span class="keywordflow">if</span>( !throw_from_seat &amp;&amp; ( 10 * d_vel ) &gt; 6 * <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 50, 100 ) ) {</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> dmg = d_vel * <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 70, 100 ) / 400;</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>            <span class="keywordflow">if</span>( psg ) {</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>                psg-&gt;<a class="code hl_function" href="classCharacter.html#ad30aa5db93626016bfc8ac32f848f82d">hurtall</a>( dmg, <span class="keyword">nullptr</span> );</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>                psg-&gt;<a class="code hl_function" href="classplayer.html#a07108565639fa6fe5b6776b4e8674fb6">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>,</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>                                            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You take %d damage by the power of the impact!&quot;</span> ),</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>                                            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt; takes %d damage by the power of the &quot;</span></div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>                                               <span class="stringliteral">&quot;impact!&quot;</span> ),  dmg );</div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>                pet-&gt;<a class="code hl_function" href="classmonster.html#afc6e6f5443145732310dd4901a394b4f">apply_damage</a>( <span class="keyword">nullptr</span>, <a class="code hl_typedef" href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a>( <span class="stringliteral">&quot;torso&quot;</span> ), dmg );</div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>            }</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>        }</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span> </div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>        <span class="keywordflow">if</span>( psg &amp;&amp; veh.<a class="code hl_function" href="classvehicle.html#a341515426011486c265d016c35f84de6">player_in_control</a>( *psg ) ) {</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> lose_ctrl_roll = <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 0, d_vel );<span class="comment"></span></div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span><span class="comment">            ///\EFFECT_DEX reduces chance of losing control of vehicle when shaken</span></div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span><span class="comment">            ///\EFFECT_DRIVING reduces chance of losing control of vehicle when shaken</span></div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span><span class="comment"></span>            <span class="keywordflow">if</span>( lose_ctrl_roll &gt; psg-&gt;<a class="code hl_variable" href="classCharacter.html#a4065ac02745befad248425d307b71849">dex_cur</a> * 2 + psg-&gt;<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="vehicle__move_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a> ) * 3 ) {</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>                psg-&gt;<a class="code hl_function" href="classplayer.html#a07108565639fa6fe5b6776b4e8674fb6">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a>,</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>                                            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You lose control of the %s.&quot;</span> ),</div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>                                            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt; loses control of the %s.&quot;</span> ), veh.<a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span>                <span class="keywordtype">int</span> turn_amount = <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 1, 3 ) * std::sqrt( std::abs( veh.<a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> ) ) / 30;</div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>                <span class="keywordflow">if</span>( turn_amount &lt; 1 ) {</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>                    turn_amount = 1;</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>                }</div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span>                <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> turn_angle = std::min( turn_amount * 15_degrees, 120_degrees );</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>                coll_turn = <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 2 ) ? turn_angle : -turn_angle;</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>            }</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>        }</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span> </div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>        <span class="keywordflow">if</span>( throw_from_seat ) {</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>            <span class="keywordflow">if</span>( psg ) {</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>                psg-&gt;<a class="code hl_function" href="classplayer.html#a07108565639fa6fe5b6776b4e8674fb6">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>,</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>                                            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You are hurled from the %s&#39;s seat by &quot;</span></div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>                                               <span class="stringliteral">&quot;the power of the impact!&quot;</span> ),</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>                                            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt; is hurled from the %s&#39;s seat by &quot;</span></div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>                                               <span class="stringliteral">&quot;the power of the impact!&quot;</span> ), veh.<a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>                <a class="code hl_function" href="classmap.html#a53d95390d133477f8b4a1ce76482750b">unboard_vehicle</a>( part_pos );</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a>().<a class="code hl_function" href="classmap.html#a291e3c90746d24dabba01954fde977d7">sees</a>( part_pos ) ) {</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>                <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The %s is hurled from %s&#39;s by the power of the impact!&quot;</span> ),</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>                         pet-&gt;<a class="code hl_function" href="classmonster.html#af3444e4763b1dd53e75c5ea50fd8ba9f">disp_name</a>(), veh.<a class="code hl_variable" href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">name</a> );</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>            }<span class="comment"></span></div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span><span class="comment">            ///\EFFECT_STR reduces distance thrown from seat in a vehicle impact</span></div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span><span class="comment"></span>            <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;fling_creature( rider, <a class="code hl_enumeration" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> + <a class="code hl_function" href="rng_8cpp.html#a0c88381d6334a2fbaa726c53f5cf9bb9">rng_float</a>( -30_degrees, 30_degrees ),</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>                               std::max( 10, d_vel - move_resist / 100 ) );</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>        }</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>    }</div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span> </div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>    <span class="keywordflow">return</span> coll_turn;</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>}</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span> </div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"><a class="line" href="namespacevehicle__movement.html"> 1663</a></span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacevehicle__movement.html">vehicle_movement</a></div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>{</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"><a class="line" href="namespacevehicle__movement.html#a2bddc1d0e2dc9d47e0c3a85362f1bd46"> 1665</a></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="namespacevehicle__movement.html#a2bddc1d0e2dc9d47e0c3a85362f1bd46">scan_rails_from_veh_internal</a>(</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>    <span class="keyword">const</span> <a class="code hl_class" href="classmap.html">map</a> &amp;m,</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>    <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> &amp;veh,</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> scan_initial_pos,</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>    <a class="code hl_struct" href="structpoint.html">point</a> veh_plus_y_vec,</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>    <a class="code hl_struct" href="structpoint.html">point</a> scan_vec )</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>{</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> rail_id = 0; rail_id &lt; veh.<a class="code hl_variable" href="classvehicle.html#ae57bcc52818212097155515e82c3a84d">rail_profile</a>.size(); rail_id++ ) {</div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>        <span class="keywordtype">int</span> rail_y_rel_to_pivot = veh.<a class="code hl_variable" href="classvehicle.html#ae57bcc52818212097155515e82c3a84d">rail_profile</a>[rail_id] - veh.<a class="code hl_function" href="classvehicle.html#a19bf91bbba8085237248e25c7d214ee6">pivot_point</a>().<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a>;</div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> scan_pos = scan_initial_pos + rail_y_rel_to_pivot * veh_plus_y_vec;</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> step = 0; step &lt; 3; step++ ) {</div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>            <a class="code hl_struct" href="structtripoint.html">tripoint</a> p = scan_pos + scan_vec * step;</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>            <span class="keywordtype">bool</span> rail_here = m.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258aa629b376f81403545931bc8b5689490f">TFLAG_RAIL</a>, p );</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>            <span class="keywordflow">if</span>( !rail_here ) {</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>                <span class="comment">// Terrain is not a rail</span></div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>            }</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>        }</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>    }</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>}</div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span> </div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"><a class="line" href="namespacevehicle__movement.html#a5de69a719cc4cbf1c0c491fe54a4443b"> 1687</a></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="namespacevehicle__movement.html#a5de69a719cc4cbf1c0c491fe54a4443b">scan_rails_at_shift</a>(</div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span>    <span class="keyword">const</span> <a class="code hl_class" href="classmap.html">map</a> &amp;m,</div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span>    <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> &amp;veh,</div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span>    <span class="keywordtype">int</span> velocity_sign,</div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> dir,</div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>    <span class="keywordtype">int</span> shift_sign,</div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> *shift_amt = <span class="keyword">nullptr</span> )</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>{</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>    <a class="code hl_struct" href="structpoint.html">point</a> ray_delta;</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>    {</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>        <a class="code hl_class" href="classtileray.html">tileray</a> ray( dir );</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>        ray.<a class="code hl_function" href="classtileray.html#a283722bbdbde0af59bbda1a26adc5b88">advance</a>( 1 );</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>        ray_delta.<a class="code hl_variable" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> = ray.<a class="code hl_function" href="classtileray.html#aefd7fd88fdbfecf5731bbff553a7aab8">dx</a>();</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>        ray_delta.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> = ray.<a class="code hl_function" href="classtileray.html#a27e3f200a89812a3d2fbc2e0e5710722">dy</a>();</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>    }</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>    <span class="keywordflow">if</span>( ray_delta.<a class="code hl_variable" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> != 0 &amp;&amp; ray_delta.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> != 0 ) {</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>        <span class="comment">// We can&#39;t cleanly map diagonally oriented vehicles to rail turns.</span></div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>        <span class="comment">// As such, treat the vehicle as if it can have either skew at the same time.</span></div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>        <a class="code hl_struct" href="structpoint.html">point</a> rd_x = <a class="code hl_struct" href="structpoint.html">point</a>( ray_delta.<a class="code hl_variable" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a>, 0 );</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>        <a class="code hl_struct" href="structpoint.html">point</a> rd_y = <a class="code hl_struct" href="structpoint.html">point</a>( 0, ray_delta.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> );</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span> </div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>        <a class="code hl_struct" href="structpoint.html">point</a> scan_vec = ray_delta * velocity_sign;</div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span> </div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>        <a class="code hl_struct" href="structpoint.html">point</a> veh_plus_y_vec_x = rd_x.<a class="code hl_function" href="structpoint.html#a9404b750fdf6bffb8aeddf8b298ab8f6">rotate</a>( 1 );</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span>        <a class="code hl_struct" href="structpoint.html">point</a> veh_plus_y_vec_y = rd_y.<a class="code hl_function" href="structpoint.html#a9404b750fdf6bffb8aeddf8b298ab8f6">rotate</a>( 1 );</div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span> </div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> scan_start = veh.<a class="code hl_function" href="classvehicle.html#a3900ee345be0453828a955a200154db1">global_pos3</a>();</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span> </div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span>        <span class="keywordflow">if</span>( shift_sign &gt; 0 ) {</div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>            scan_start -= veh_plus_y_vec_x * velocity_sign;</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( shift_sign &lt; 0 ) {</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>            scan_start -= veh_plus_y_vec_y * velocity_sign;</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>        }</div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span> </div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>        <span class="keywordtype">bool</span> scan_res_x = <a class="code hl_function" href="namespacevehicle__movement.html#a2bddc1d0e2dc9d47e0c3a85362f1bd46">scan_rails_from_veh_internal</a>( m, veh, scan_start, veh_plus_y_vec_x, scan_vec );</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>        <span class="keywordtype">bool</span> scan_res_y = <a class="code hl_function" href="namespacevehicle__movement.html#a2bddc1d0e2dc9d47e0c3a85362f1bd46">scan_rails_from_veh_internal</a>( m, veh, scan_start, veh_plus_y_vec_y, scan_vec );</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span> </div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>        <span class="keywordflow">if</span>( scan_res_x || scan_res_y ) {</div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>            <span class="keywordflow">if</span>( shift_amt ) {</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>                *shift_amt = scan_start - veh.<a class="code hl_function" href="classvehicle.html#a3900ee345be0453828a955a200154db1">global_pos3</a>();</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>            }</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>        }</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span>        <a class="code hl_struct" href="structpoint.html">point</a> veh_plus_y_vec = ray_delta.<a class="code hl_function" href="structpoint.html#a9404b750fdf6bffb8aeddf8b298ab8f6">rotate</a>( 1 );</div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>        <a class="code hl_struct" href="structpoint.html">point</a> scan_vec = ray_delta * velocity_sign;</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> scan_start = veh.<a class="code hl_function" href="classvehicle.html#a3900ee345be0453828a955a200154db1">global_pos3</a>();</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>        <span class="keywordflow">if</span>( shift_sign != 0 ) {</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>            scan_start += scan_vec + veh_plus_y_vec * shift_sign;</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span>        }</div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>        <span class="keywordflow">if</span>( <a class="code hl_function" href="namespacevehicle__movement.html#a2bddc1d0e2dc9d47e0c3a85362f1bd46">scan_rails_from_veh_internal</a>( m, veh, scan_start, veh_plus_y_vec, scan_vec ) ) {</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>            <span class="keywordflow">if</span>( shift_amt ) {</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>                *shift_amt = scan_start - veh.<a class="code hl_function" href="classvehicle.html#a3900ee345be0453828a955a200154db1">global_pos3</a>();</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>            }</div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>        }</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>    }</div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>}</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span> </div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"><a class="line" href="namespacevehicle__movement.html#a90726346ef0084026393895b4e7bcb20"> 1747</a></span><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code hl_struct" href="structvehicle__movement_1_1rail__processing__result.html">rail_processing_result</a> <a class="code hl_function" href="namespacevehicle__movement.html#a90726346ef0084026393895b4e7bcb20">make_none</a>()</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>{</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>    <span class="keywordflow">return</span> <a class="code hl_struct" href="structvehicle__movement_1_1rail__processing__result.html">rail_processing_result</a>();</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>}</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span> </div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"><a class="line" href="namespacevehicle__movement.html#a77db2ddbeface5f8a7eda956e2bbef20"> 1752</a></span><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code hl_struct" href="structvehicle__movement_1_1rail__processing__result.html">rail_processing_result</a> <a class="code hl_function" href="namespacevehicle__movement.html#a77db2ddbeface5f8a7eda956e2bbef20">make_turn</a>( <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> <a class="code hl_variable" href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> )</div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>{</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>    <a class="code hl_struct" href="structvehicle__movement_1_1rail__processing__result.html">rail_processing_result</a> res;</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>    res.<a class="code hl_variable" href="structvehicle__movement_1_1rail__processing__result.html#aa10da2e7136704fa25a4af595ae7122b">do_turn</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span>    res.<a class="code hl_variable" href="structvehicle__movement_1_1rail__processing__result.html#a0a31255e2dd466d5580aa4446964f5c7">turn_dir</a> = <a class="code hl_variable" href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>;</div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>    <span class="keywordflow">return</span> res;</div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>}</div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span> </div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"><a class="line" href="namespacevehicle__movement.html#ac828727a3d0872b1535bf031b77d0590"> 1760</a></span><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code hl_struct" href="structvehicle__movement_1_1rail__processing__result.html">rail_processing_result</a> <a class="code hl_function" href="namespacevehicle__movement.html#ac828727a3d0872b1535bf031b77d0590">make_shift</a>( <a class="code hl_struct" href="structtripoint.html">tripoint</a> dp )</div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span>{</div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span>    <a class="code hl_struct" href="structvehicle__movement_1_1rail__processing__result.html">rail_processing_result</a> res;</div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>    res.<a class="code hl_variable" href="structvehicle__movement_1_1rail__processing__result.html#a894bbd71e540fd9488b350fa60a51096">do_shift</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>    res.<a class="code hl_variable" href="structvehicle__movement_1_1rail__processing__result.html#ac8a076ac2aafe3dc22aa6796ffdc04b3">shift_amount</a> = dp;</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span>    <span class="keywordflow">return</span> res;</div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span>}</div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span> </div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"><a class="line" href="namespacevehicle__movement.html#a90bf274fc2c6eb229613c63739d8e2c1"> 1768</a></span><a class="code hl_struct" href="structvehicle__movement_1_1rail__processing__result.html">rail_processing_result</a> <a class="code hl_function" href="namespacevehicle__movement.html#a90bf274fc2c6eb229613c63739d8e2c1">process_movement_on_rails</a>( <span class="keyword">const</span> <a class="code hl_class" href="classmap.html">map</a> &amp;m, <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> &amp;veh )</div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span>{</div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>    <span class="keywordtype">int</span> face_dir_degrees = std::round( <a class="code hl_function" href="namespaceunits.html#a9ce2bc1618fa4acf9f9e98effd9f1ae0">units::to_degrees</a>( veh.<a class="code hl_variable" href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">face</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>() ) );</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>    <span class="keywordtype">int</span> face_dir_snapped = ( face_dir_degrees / 45 ) * 45;</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span> </div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> dir_straight = <a class="code hl_function" href="namespacedetail.html#a955ad02ade4f07084391a60ed80701bf">normalize</a>( <a class="code hl_function" href="namespaceunits.html#a068cd98efba5fd1fbb936ce3597db23d">units::from_degrees</a>( face_dir_snapped ) );</div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> dir_left = <a class="code hl_function" href="namespacedetail.html#a955ad02ade4f07084391a60ed80701bf">normalize</a>( dir_straight - 45_degrees );</div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> dir_right = <a class="code hl_function" href="namespacedetail.html#a955ad02ade4f07084391a60ed80701bf">normalize</a>( dir_straight + 45_degrees );</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span> </div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>    <span class="keywordtype">int</span> vel_sign = veh.<a class="code hl_variable" href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">velocity</a> &gt; 0 ? 1 : -1;</div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span> </div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>    <span class="keywordtype">bool</span> can_go_straight = <a class="code hl_function" href="namespacevehicle__movement.html#a5de69a719cc4cbf1c0c491fe54a4443b">scan_rails_at_shift</a>( m, veh, vel_sign, dir_straight, 0 );</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>    <span class="keywordtype">bool</span> can_turn_left = <a class="code hl_function" href="namespacevehicle__movement.html#a5de69a719cc4cbf1c0c491fe54a4443b">scan_rails_at_shift</a>( m, veh, vel_sign, dir_left, 0 );</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>    <span class="keywordtype">bool</span> can_turn_right = <a class="code hl_function" href="namespacevehicle__movement.html#a5de69a719cc4cbf1c0c491fe54a4443b">scan_rails_at_shift</a>( m, veh, vel_sign, dir_right, 0 );</div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span> </div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span>    <span class="keywordtype">bool</span> can_go_backwards = <a class="code hl_function" href="namespacevehicle__movement.html#a5de69a719cc4cbf1c0c491fe54a4443b">scan_rails_at_shift</a>( m, veh, -vel_sign, dir_straight, 0 );</div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span> </div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> shift_amount_right;</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> shift_amount_left;</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span> </div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>    <span class="keywordtype">bool</span> can_shift_right = <a class="code hl_function" href="namespacevehicle__movement.html#a5de69a719cc4cbf1c0c491fe54a4443b">scan_rails_at_shift</a>( m, veh, vel_sign, dir_straight, vel_sign,</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>                           &amp;shift_amount_right );</div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span>    <span class="keywordtype">bool</span> can_shift_left = <a class="code hl_function" href="namespacevehicle__movement.html#a5de69a719cc4cbf1c0c491fe54a4443b">scan_rails_at_shift</a>( m, veh, vel_sign, dir_straight, -vel_sign,</div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span>                          &amp;shift_amount_left );</div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span> </div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="namespacevehicle__movement.html#ad2c532fb5522d745b0006f7a3b36cab3">is_on_rails</a> = face_dir_degrees == face_dir_snapped &amp;&amp; ( can_go_straight || can_go_backwards );</div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span> </div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>    <span class="comment">// Appraise possible vehicle orientations</span></div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span>    <span class="keywordflow">if</span>( !<a class="code hl_function" href="namespacevehicle__movement.html#ad2c532fb5522d745b0006f7a3b36cab3">is_on_rails</a> ) {</div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span>        <span class="comment">// The vehicle is derailed, attempt to get back on rails</span></div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span>        <span class="keywordflow">if</span>( can_go_straight ) {</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a77db2ddbeface5f8a7eda956e2bbef20">make_turn</a>( dir_straight );</div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>        }</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>        <span class="keywordflow">if</span>( veh.<a class="code hl_variable" href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">face</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>() == veh.<a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> ) {</div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>            <span class="comment">// Automatic movement - prefer going straight.</span></div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>            <span class="keywordflow">if</span>( can_go_straight ) {</div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>                <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a90726346ef0084026393895b4e7bcb20">make_none</a>();</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_turn_left ) {</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>                <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a77db2ddbeface5f8a7eda956e2bbef20">make_turn</a>( dir_left );</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_shift_left ) {</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>                <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#ac828727a3d0872b1535bf031b77d0590">make_shift</a>( shift_amount_left );</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_turn_right ) {</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>                <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a77db2ddbeface5f8a7eda956e2bbef20">make_turn</a>( dir_right );</div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_shift_right ) {</div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>                <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#ac828727a3d0872b1535bf031b77d0590">make_shift</a>( shift_amount_right );</div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>            }</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span>            <span class="comment">// Manual movement - prefer going in turn direction.</span></div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>            <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> dir_delta = <a class="code hl_function" href="namespacedetail.html#a955ad02ade4f07084391a60ed80701bf">normalize</a>( veh.<a class="code hl_variable" href="classvehicle.html#af366981a584e12d25133fb479d47de33">turn_dir</a> - veh.<a class="code hl_variable" href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">face</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>() );</div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>            <span class="keywordflow">if</span>( dir_delta &lt; 180_degrees ) {</div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>                <span class="comment">// Trying to turn right</span></div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span>                <span class="keywordflow">if</span>( can_turn_right ) {</div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>                    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a77db2ddbeface5f8a7eda956e2bbef20">make_turn</a>( dir_right );</div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_shift_right ) {</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>                    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#ac828727a3d0872b1535bf031b77d0590">make_shift</a>( shift_amount_right );</div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_go_straight ) {</div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>                    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a90726346ef0084026393895b4e7bcb20">make_none</a>();</div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_turn_left ) {</div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>                    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a77db2ddbeface5f8a7eda956e2bbef20">make_turn</a>( dir_left );</div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_shift_left ) {</div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>                    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#ac828727a3d0872b1535bf031b77d0590">make_shift</a>( shift_amount_left );</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>                }</div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span>                <span class="comment">// Trying to turn left</span></div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>                <span class="keywordflow">if</span>( can_turn_left ) {</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>                    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a77db2ddbeface5f8a7eda956e2bbef20">make_turn</a>( dir_left );</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_shift_left ) {</div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>                    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#ac828727a3d0872b1535bf031b77d0590">make_shift</a>( shift_amount_left );</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_go_straight ) {</div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>                    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a90726346ef0084026393895b4e7bcb20">make_none</a>();</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_turn_right ) {</div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>                    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a77db2ddbeface5f8a7eda956e2bbef20">make_turn</a>( dir_right );</div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( can_shift_right ) {</div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>                    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#ac828727a3d0872b1535bf031b77d0590">make_shift</a>( shift_amount_right );</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>                }</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>            }</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>        }</div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span>    }</div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a90726346ef0084026393895b4e7bcb20">make_none</a>();</div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span>}</div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span> </div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"><a class="line" href="namespacevehicle__movement.html#ad2c532fb5522d745b0006f7a3b36cab3"> 1850</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="namespacevehicle__movement.html#ad2c532fb5522d745b0006f7a3b36cab3">is_on_rails</a>( <span class="keyword">const</span> <a class="code hl_class" href="classmap.html">map</a> &amp;m, <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> &amp;veh )</div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span>{</div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>    <span class="keywordflow">if</span>( !veh.<a class="code hl_function" href="classvehicle.html#a9c46063d58fd3a05504dec8bb8b6e837">can_use_rails</a>() ) {</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span>        <span class="comment">// Must be rail-worthy</span></div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>    }</div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span> </div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span>    <span class="keywordtype">int</span> face_dir_degrees = std::round( <a class="code hl_function" href="namespaceunits.html#a9ce2bc1618fa4acf9f9e98effd9f1ae0">units::to_degrees</a>( veh.<a class="code hl_variable" href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">face</a>.<a class="code hl_function" href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">dir</a>() ) );</div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span>    <span class="keywordtype">int</span> face_dir_snapped = ( face_dir_degrees / 45 ) * 45;</div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span> </div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span>    <span class="keywordflow">if</span>( face_dir_degrees != face_dir_snapped ) {</div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span>        <span class="comment">// When moving on rails, can only rotate in 45-degree increment</span></div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span>    }</div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span> </div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span>    <span class="comment">// Must have valid rail segment in front of or behind us</span></div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> dir_straight = <a class="code hl_function" href="namespacedetail.html#a955ad02ade4f07084391a60ed80701bf">normalize</a>( <a class="code hl_function" href="namespaceunits.html#a068cd98efba5fd1fbb936ce3597db23d">units::from_degrees</a>( face_dir_snapped ) );</div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacevehicle__movement.html#a5de69a719cc4cbf1c0c491fe54a4443b">scan_rails_at_shift</a>( m, veh, 1, dir_straight, 0 ) ||</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span>           <a class="code hl_function" href="namespacevehicle__movement.html#a5de69a719cc4cbf1c0c491fe54a4443b">scan_rails_at_shift</a>( m, veh, -1, dir_straight, 0 );</div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span>}</div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span> </div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span>} <span class="comment">// namespace vehicle_movement</span></div>
<div class="ttc" id="aartifact_8cpp_html_a70800e95389f34dd34186fafaea2a840"><div class="ttname"><a href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a></div><div class="ttdeci">units::quantity&lt; V, B &gt; rng(const units::quantity&lt; V, B &gt; &amp;min, const units::quantity&lt; V, B &gt; &amp;max)</div><div class="ttdef"><b>Definition:</b> <a href="artifact_8cpp_source.html#l00032">artifact.cpp:32</a></div></div>
<div class="ttc" id="aavatar_8h_html"><div class="ttname"><a href="avatar_8h.html">avatar.h</a></div></div>
<div class="ttc" id="abodypart_8h_html"><div class="ttname"><a href="bodypart_8h.html">bodypart.h</a></div></div>
<div class="ttc" id="abodypart_8h_html_a426444e2d486ce1ee315d8b8acc86b40"><div class="ttname"><a href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a></div><div class="ttdeci">int_id&lt; body_part_type &gt; bodypart_id</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00023">bodypart.h:23</a></div></div>
<div class="ttc" id="acharacter_8cpp_html_a2fcb25d686f4a35fca374c6f71280311"><div class="ttname"><a href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a></div><div class="ttdeci">Character &amp; get_player_character()</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00381">character.cpp:381</a></div></div>
<div class="ttc" id="aclassCharacter_html"><div class="ttname"><a href="classCharacter.html">Character</a></div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00259">character.h:260</a></div></div>
<div class="ttc" id="aclassCharacter_html_a26369a0a81eef76cfe75214d22ed32b4"><div class="ttname"><a href="classCharacter.html#a26369a0a81eef76cfe75214d22ed32b4">Character::str_cur</a></div><div class="ttdeci">int str_cur</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00304">character.h:304</a></div></div>
<div class="ttc" id="aclassCharacter_html_a34a927d0f161ac92ab0d462397828bd5"><div class="ttname"><a href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">Character::get_dex</a></div><div class="ttdeci">virtual int get_dex() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04052">character.cpp:4052</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4065ac02745befad248425d307b71849"><div class="ttname"><a href="classCharacter.html#a4065ac02745befad248425d307b71849">Character::dex_cur</a></div><div class="ttdeci">int dex_cur</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00305">character.h:305</a></div></div>
<div class="ttc" id="aclassCharacter_html_a59ce503ce81563ebcc1da591816a7b7c"><div class="ttname"><a href="classCharacter.html#a59ce503ce81563ebcc1da591816a7b7c">Character::hitall</a></div><div class="ttdeci">int hitall(int dam, int vary, Creature *source)</div><div class="ttdoc">Harms all body parts for dam, with armor reduction.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l08653">character.cpp:8653</a></div></div>
<div class="ttc" id="aclassCharacter_html_a61bc9422c35b63128532af268e52cb71"><div class="ttname"><a href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">Character::in_vehicle</a></div><div class="ttdeci">bool in_vehicle</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01575">character.h:1575</a></div></div>
<div class="ttc" id="aclassCharacter_html_a7cf3a039fed01ee44525ea41940cb00d"><div class="ttname"><a href="classCharacter.html#a7cf3a039fed01ee44525ea41940cb00d">Character::knows_trap</a></div><div class="ttdeci">bool knows_trap(const tripoint &amp;pos) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10214">character.cpp:10214</a></div></div>
<div class="ttc" id="aclassCharacter_html_aba9bd7517b334e6ed4149889ed32377a"><div class="ttname"><a href="classCharacter.html#aba9bd7517b334e6ed4149889ed32377a">Character::sees</a></div><div class="ttdeci">bool sees(const tripoint &amp;t, bool is_player=false, int range_mod=0) const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10384">character.cpp:10384</a></div></div>
<div class="ttc" id="aclassCharacter_html_abb0a1847902e6db0bd3c923ee8187702"><div class="ttname"><a href="classCharacter.html#abb0a1847902e6db0bd3c923ee8187702">Character::get_per</a></div><div class="ttdeci">virtual int get_per() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04056">character.cpp:4056</a></div></div>
<div class="ttc" id="aclassCharacter_html_ad24859164517ed6e392e21df69527199"><div class="ttname"><a href="classCharacter.html#ad24859164517ed6e392e21df69527199">Character::pos</a></div><div class="ttdeci">const tripoint &amp; pos() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00707">character.cpp:707</a></div></div>
<div class="ttc" id="aclassCharacter_html_ad30aa5db93626016bfc8ac32f848f82d"><div class="ttname"><a href="classCharacter.html#ad30aa5db93626016bfc8ac32f848f82d">Character::hurtall</a></div><div class="ttdeci">void hurtall(int dam, Creature *source, bool disturb=true)</div><div class="ttdoc">Hurts all body parts for dam, no armor reduction.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l08635">character.cpp:8635</a></div></div>
<div class="ttc" id="aclassCharacter_html_ada34ca3fb472a8b1816e297ead2b31df"><div class="ttname"><a href="classCharacter.html#ada34ca3fb472a8b1816e297ead2b31df">Character::add_known_trap</a></div><div class="ttdeci">void add_known_trap(const tripoint &amp;pos, const trap &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10220">character.cpp:10220</a></div></div>
<div class="ttc" id="aclassCharacter_html_aedc66fc50d352420cae7791b4a0f57f7"><div class="ttname"><a href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">Character::get_speed</a></div><div class="ttdeci">int get_speed() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04108">character.cpp:4108</a></div></div>
<div class="ttc" id="aclassCharacter_html_afa95fe499ca6b55ab97f1b442a4c95c5"><div class="ttname"><a href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">Character::get_skill_level</a></div><div class="ttdeci">int get_skill_level(const skill_id &amp;ident) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03327">character.cpp:3327</a></div></div>
<div class="ttc" id="aclassCreature_html"><div class="ttname"><a href="classCreature.html">Creature</a></div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00077">creature.h:78</a></div></div>
<div class="ttc" id="aclassCreature_html_a0547ea1ba1d4fcc157db6a73b877f5d6"><div class="ttname"><a href="classCreature.html#a0547ea1ba1d4fcc157db6a73b877f5d6">Creature::apply_damage</a></div><div class="ttdeci">virtual void apply_damage(Creature *source, bodypart_id bp, int amount, bool bypass_med=false)=0</div></div>
<div class="ttc" id="aclassCreature_html_a1be20ab434ada66748d5b62fcfdbd5e4"><div class="ttname"><a href="classCreature.html#a1be20ab434ada66748d5b62fcfdbd5e4">Creature::posy</a></div><div class="ttdeci">virtual int posy() const =0</div></div>
<div class="ttc" id="aclassCreature_html_a261dff3caa6aabe255ae9d3eaa94d3de"><div class="ttname"><a href="classCreature.html#a261dff3caa6aabe255ae9d3eaa94d3de">Creature::get_speed</a></div><div class="ttdeci">virtual int get_speed() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01498">creature.cpp:1498</a></div></div>
<div class="ttc" id="aclassCreature_html_a26b7c431f85f0b99b888db69318ebdc5"><div class="ttname"><a href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">Creature::disp_name</a></div><div class="ttdeci">virtual std::string disp_name(bool possessive=false, bool capitalize_first=false) const =0</div></div>
<div class="ttc" id="aclassCreature_html_a303fcc58869f10f44be1d598ed1aa26f"><div class="ttname"><a href="classCreature.html#a303fcc58869f10f44be1d598ed1aa26f">Creature::bleed</a></div><div class="ttdeci">virtual void bleed() const</div><div class="ttdoc">Adds an appropriate blood splatter.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00131">creature.cpp:131</a></div></div>
<div class="ttc" id="aclassCreature_html_a38ea0c149ac718542546fdceba44a4df"><div class="ttname"><a href="classCreature.html#a38ea0c149ac718542546fdceba44a4df">Creature::get_weight</a></div><div class="ttdeci">virtual units::mass get_weight() const =0</div></div>
<div class="ttc" id="aclassCreature_html_a3a3ada596854cf8084b3a728b633a9db"><div class="ttname"><a href="classCreature.html#a3a3ada596854cf8084b3a728b633a9db">Creature::posz</a></div><div class="ttdeci">virtual int posz() const =0</div></div>
<div class="ttc" id="aclassCreature_html_a3cb42eea32fd7e172dca0e902d1184ed"><div class="ttname"><a href="classCreature.html#a3cb42eea32fd7e172dca0e902d1184ed">Creature::is_hallucination</a></div><div class="ttdeci">virtual bool is_hallucination() const =0</div></div>
<div class="ttc" id="aclassCreature_html_a3e049fbeaa6a392bd3a2594005b397af"><div class="ttname"><a href="classCreature.html#a3e049fbeaa6a392bd3a2594005b397af">Creature::get_armor_bash</a></div><div class="ttdeci">virtual int get_armor_bash(bodypart_id bp) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01460">creature.cpp:1460</a></div></div>
<div class="ttc" id="aclassCreature_html_a45926a7ba63ccc9be744f87a4d540b7d"><div class="ttname"><a href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">Creature::pos</a></div><div class="ttdeci">virtual const tripoint &amp; pos() const =0</div></div>
<div class="ttc" id="aclassCreature_html_a5bb5438474141314c9a9f11a565b6c9c"><div class="ttname"><a href="classCreature.html#a5bb5438474141314c9a9f11a565b6c9c">Creature::get_armor_cut</a></div><div class="ttdeci">virtual int get_armor_cut(bodypart_id bp) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01464">creature.cpp:1464</a></div></div>
<div class="ttc" id="aclassCreature_html_a666022fd3ed772fa109d273c20e8de55"><div class="ttname"><a href="classCreature.html#a666022fd3ed772fa109d273c20e8de55">Creature::add_effect</a></div><div class="ttdeci">void add_effect(const effect &amp;eff, bool force=false, bool deferred=false)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00974">creature.cpp:974</a></div></div>
<div class="ttc" id="aclassCreature_html_a6fb79df9315dc2bed6f34d9a2e37da90"><div class="ttname"><a href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">Creature::has_effect</a></div><div class="ttdeci">bool has_effect(const efftype_id &amp;eff_id, body_part bp=num_bp) const</div><div class="ttdoc">Check if creature has the matching effect.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01173">creature.cpp:1173</a></div></div>
<div class="ttc" id="aclassCreature_html_a7f9ce537b830a5f0474c001d295c0a77"><div class="ttname"><a href="classCreature.html#a7f9ce537b830a5f0474c001d295c0a77">Creature::setpos</a></div><div class="ttdeci">virtual void setpos(const tripoint &amp;pos)=0</div></div>
<div class="ttc" id="aclassCreature_html_a8c5a392caa213bee9581b47e9f0e2052"><div class="ttname"><a href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">Creature::moves</a></div><div class="ttdeci">int moves</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00569">creature.h:569</a></div></div>
<div class="ttc" id="aclassCreature_html_a91dc4715c36eef7d116f944be9a4d435"><div class="ttname"><a href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">Creature::add_msg_if_player</a></div><div class="ttdeci">virtual void add_msg_if_player(const std::string &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00593">creature.h:593</a></div></div>
<div class="ttc" id="aclassCreature_html_ab4c318885f6b9947a7c85d3328d25ffe"><div class="ttname"><a href="classCreature.html#ab4c318885f6b9947a7c85d3328d25ffe">Creature::is_dead_state</a></div><div class="ttdeci">virtual bool is_dead_state() const =0</div></div>
<div class="ttc" id="aclassCreature_html_acb1d0a1210d3dd4c86350f3ad4c58649"><div class="ttname"><a href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">Creature::as_player</a></div><div class="ttdeci">virtual player * as_player()</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00122">creature.h:122</a></div></div>
<div class="ttc" id="aclassCreature_html_af712029844aef7ebc7af88a9242e2df0"><div class="ttname"><a href="classCreature.html#af712029844aef7ebc7af88a9242e2df0">Creature::posx</a></div><div class="ttdeci">virtual int posx() const =0</div></div>
<div class="ttc" id="aclassint__id_html"><div class="ttname"><a href="classint__id.html">int_id&lt; trap &gt;</a></div></div>
<div class="ttc" id="aclassint__id_html_a4796245d3cd6e0283670698a98d46ae9"><div class="ttname"><a href="classint__id.html#a4796245d3cd6e0283670698a98d46ae9">int_id::obj</a></div><div class="ttdeci">const T &amp; obj() const</div><div class="ttdef"><b>Definition:</b> <a href="ammo__effect_8cpp_source.html#l00026">ammo_effect.cpp:26</a></div></div>
<div class="ttc" id="aclassmap_html"><div class="ttname"><a href="classmap.html">map</a></div><div class="ttdoc">Manage and cache data about a part of the map.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00371">map.h:372</a></div></div>
<div class="ttc" id="aclassmap_html_a0b83bb9cbf7265f78eaad06dc1f7b8c3"><div class="ttname"><a href="classmap.html#a0b83bb9cbf7265f78eaad06dc1f7b8c3">map::bash_strength</a></div><div class="ttdeci">int bash_strength(const tripoint &amp;p, bool allow_floor=false) const</div><div class="ttdoc">Returns max_str of the furniture or terrain at p.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02458">map.cpp:2458</a></div></div>
<div class="ttc" id="aclassmap_html_a1d638822dc7c62d6ec6ee4f64ae0f4b2"><div class="ttname"><a href="classmap.html#a1d638822dc7c62d6ec6ee4f64ae0f4b2">map::vehicle_wheel_traction</a></div><div class="ttdeci">float vehicle_wheel_traction(const vehicle &amp;veh, bool ignore_movement_modifiers=false) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01501">vehicle_move.cpp:1501</a></div></div>
<div class="ttc" id="aclassmap_html_a2266f21420ae2a1b44e8df9a028764e4"><div class="ttname"><a href="classmap.html#a2266f21420ae2a1b44e8df9a028764e4">map::bash</a></div><div class="ttdeci">bash_results bash(const tripoint &amp;p, int str, bool silent=false, bool destroy=false, bool bash_floor=false, const vehicle *bashing_vehicle=nullptr)</div><div class="ttdoc">Returns a pair where first is whether anything was smashed and second is if it was destroyed.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03520">map.cpp:3520</a></div></div>
<div class="ttc" id="aclassmap_html_a27e22f0999ea03eff18babc48643c568"><div class="ttname"><a href="classmap.html#a27e22f0999ea03eff18babc48643c568">map::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02304">map.cpp:2304</a></div></div>
<div class="ttc" id="aclassmap_html_a291e3c90746d24dabba01954fde977d7"><div class="ttname"><a href="classmap.html#a291e3c90746d24dabba01954fde977d7">map::sees</a></div><div class="ttdeci">bool sees(const tripoint &amp;F, const tripoint &amp;T, int range) const</div><div class="ttdoc">Returns whether F sees T with a view range of range.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l06120">map.cpp:6120</a></div></div>
<div class="ttc" id="aclassmap_html_a2e3300e786112b4ea45a9d3176b5f3b0"><div class="ttname"><a href="classmap.html#a2e3300e786112b4ea45a9d3176b5f3b0">map::is_bashable_ter_furn</a></div><div class="ttdeci">bool is_bashable_ter_furn(const tripoint &amp;p, bool allow_floor=false) const</div><div class="ttdoc">Returns true if the furniture or terrain at p is bashable.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02453">map.cpp:2453</a></div></div>
<div class="ttc" id="aclassmap_html_a30ccb67ed3651d350f2caf214e0b5176"><div class="ttname"><a href="classmap.html#a30ccb67ed3651d350f2caf214e0b5176">map::tr_at</a></div><div class="ttdeci">const trap &amp; tr_at(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l05135">map.cpp:5135</a></div></div>
<div class="ttc" id="aclassmap_html_a3779768673ad08004a999b1ac440421c"><div class="ttname"><a href="classmap.html#a3779768673ad08004a999b1ac440421c">map::supports_above</a></div><div class="ttdeci">bool supports_above(const tripoint &amp;p) const</div><div class="ttdoc">Does this tile support vehicles and furniture above it.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02031">map.cpp:2031</a></div></div>
<div class="ttc" id="aclassmap_html_a46608709f68358365d0734b1063fed73"><div class="ttname"><a href="classmap.html#a46608709f68358365d0734b1063fed73">map::inbounds</a></div><div class="ttdeci">virtual bool inbounds(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l07588">map.cpp:7588</a></div></div>
<div class="ttc" id="aclassmap_html_a49d42535b664b5a6e4e8a02e3e773f4d"><div class="ttname"><a href="classmap.html#a49d42535b664b5a6e4e8a02e3e773f4d">map::set_memory_seen_cache_dirty</a></div><div class="ttdeci">void set_memory_seen_cache_dirty(const tripoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00451">map.h:451</a></div></div>
<div class="ttc" id="aclassmap_html_a516c0764134cc86b57297811520395f7"><div class="ttname"><a href="classmap.html#a516c0764134cc86b57297811520395f7">map::has_flag_ter_or_furn</a></div><div class="ttdeci">bool has_flag_ter_or_furn(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02333">map.cpp:2333</a></div></div>
<div class="ttc" id="aclassmap_html_a53d95390d133477f8b4a1ce76482750b"><div class="ttname"><a href="classmap.html#a53d95390d133477f8b4a1ce76482750b">map::unboard_vehicle</a></div><div class="ttdeci">void unboard_vehicle(const vpart_reference &amp;, Character *passenger, bool dead_passenger=false)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01060">map.cpp:1060</a></div></div>
<div class="ttc" id="aclassmap_html_a64c0e02c7c79eb42879665a3e8b75999"><div class="ttname"><a href="classmap.html#a64c0e02c7c79eb42879665a3e8b75999">map::disp_name</a></div><div class="ttdeci">std::string disp_name(const tripoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01341">map.cpp:1341</a></div></div>
<div class="ttc" id="aclassmap_html_a82534d8752a0be6bbb000928d1f1978b"><div class="ttname"><a href="classmap.html#a82534d8752a0be6bbb000928d1f1978b">map::impassable_ter_furn</a></div><div class="ttdeci">bool impassable_ter_furn(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01839">map.cpp:1839</a></div></div>
<div class="ttc" id="aclassmap_html_aa00000bc092d452f60dc532532d58232"><div class="ttname"><a href="classmap.html#aa00000bc092d452f60dc532532d58232">map::inbounds_z</a></div><div class="ttdeci">bool inbounds_z(const int z) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l01645">map.h:1645</a></div></div>
<div class="ttc" id="aclassmap_html_aa487d96256c3d35db7a1bf273156b64a"><div class="ttname"><a href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">map::veh_at</a></div><div class="ttdeci">optional_vpart_position veh_at(const tripoint &amp;p) const</div><div class="ttdoc">Checks if tile is occupied by vehicle and by which part.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l00988">map.cpp:988</a></div></div>
<div class="ttc" id="aclassmap_html_aac63fb28872f612df34a7f9a86898ed7"><div class="ttname"><a href="classmap.html#aac63fb28872f612df34a7f9a86898ed7">map::on_vehicle_moved</a></div><div class="ttdeci">void on_vehicle_moved(int smz)</div><div class="ttdoc">Callback invoked when a vehicle has moved.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l00389">map.cpp:389</a></div></div>
<div class="ttc" id="aclassmap_html_ab3329218e47ef1729d54bbf27622c1ba"><div class="ttname"><a href="classmap.html#ab3329218e47ef1729d54bbf27622c1ba">map::move_cost_ter_furn</a></div><div class="ttdeci">int move_cost_ter_furn(const tripoint &amp;p) const</div><div class="ttdoc">Similar behavior to move_cost(), but ignores vehicles.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01816">map.cpp:1816</a></div></div>
<div class="ttc" id="aclassmap_html_aba8f330c2cc25be0652489b42d8dd530"><div class="ttname"><a href="classmap.html#aba8f330c2cc25be0652489b42d8dd530">map::ter</a></div><div class="ttdeci">ter_id ter(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01509">map.cpp:1509</a></div></div>
<div class="ttc" id="aclassmap_html_abeefac00972febd607e98bb0431bd5a9"><div class="ttname"><a href="classmap.html#abeefac00972febd607e98bb0431bd5a9">map::displace_vehicle</a></div><div class="ttdeci">bool displace_vehicle(vehicle &amp;veh, const tripoint &amp;dp, bool adjust_pos=true, const std::set&lt; int &gt; &amp;parts_to_move={})</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01098">map.cpp:1098</a></div></div>
<div class="ttc" id="aclassmap_html_abff2fded83a8e96e5e20084c3cb59579"><div class="ttname"><a href="classmap.html#abff2fded83a8e96e5e20084c3cb59579">map::has_zlevels</a></div><div class="ttdeci">bool has_zlevels() const</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l01657">map.h:1657</a></div></div>
<div class="ttc" id="aclassmap_html_ac7023d5bb12f333f7237a08bd471b112"><div class="ttname"><a href="classmap.html#ac7023d5bb12f333f7237a08bd471b112">map::shake_vehicle</a></div><div class="ttdeci">units::angle shake_vehicle(vehicle &amp;veh, int velocity_before, units::angle direction)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01565">vehicle_move.cpp:1565</a></div></div>
<div class="ttc" id="aclassmap_html_ac7f59f4bc6fad84a8d8c0ddd4e023734"><div class="ttname"><a href="classmap.html#ac7f59f4bc6fad84a8d8c0ddd4e023734">map::destroy_vehicle</a></div><div class="ttdeci">void destroy_vehicle(vehicle *veh)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l00384">map.cpp:384</a></div></div>
<div class="ttc" id="aclassmap_html_acfe43259087397daac52876165a3120c"><div class="ttname"><a href="classmap.html#acfe43259087397daac52876165a3120c">map::spawn_item</a></div><div class="ttdeci">void spawn_item(const tripoint &amp;p, const itype_id &amp;type_id, unsigned quantity=1, int charges=0, const time_point &amp;birthday=calendar::start_of_cataclysm, int damlevel=0)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l04187">map.cpp:4187</a></div></div>
<div class="ttc" id="aclassmap_html_add9128611766f2a8095b0104f0fd7371"><div class="ttname"><a href="classmap.html#add9128611766f2a8095b0104f0fd7371">map::move_vehicle</a></div><div class="ttdeci">vehicle * move_vehicle(vehicle &amp;veh, const tripoint &amp;dp, const tileray &amp;facing)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l00504">map.cpp:504</a></div></div>
<div class="ttc" id="aclassmap_html_ade82e480520c05f5a4e8917df19cef8c"><div class="ttname"><a href="classmap.html#ade82e480520c05f5a4e8917df19cef8c">map::trap_set</a></div><div class="ttdeci">void trap_set(const tripoint &amp;p, const trap_id &amp;type)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l05187">map.cpp:5187</a></div></div>
<div class="ttc" id="aclassmap_html_adfb4f21d749696fdd25c7b37ba2b7b21"><div class="ttname"><a href="classmap.html#adfb4f21d749696fdd25c7b37ba2b7b21">map::bash_resistance</a></div><div class="ttdeci">int bash_resistance(const tripoint &amp;p, bool allow_floor=false) const</div><div class="ttdoc">Returns min_str of the furniture or terrain at p.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02472">map.cpp:2472</a></div></div>
<div class="ttc" id="aclassmap_html_ae6be5b2b977897215861971bf64fb502"><div class="ttname"><a href="classmap.html#ae6be5b2b977897215861971bf64fb502">map::remove_trap</a></div><div class="ttdeci">void remove_trap(const tripoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l05271">map.cpp:5271</a></div></div>
<div class="ttc" id="aclassmonster_html"><div class="ttname"><a href="classmonster.html">monster</a></div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00083">monster.h:84</a></div></div>
<div class="ttc" id="aclassmonster_html_ac657665936ef8e009e683c2fa02f4ce3"><div class="ttname"><a href="classmonster.html#ac657665936ef8e009e683c2fa02f4ce3">monster::get_weight</a></div><div class="ttdeci">units::mass get_weight() const override</div><div class="ttdef"><b>Definition:</b> <a href="monster_8cpp_source.html#l02673">monster.cpp:2673</a></div></div>
<div class="ttc" id="aclassmonster_html_ad4fba0b9aea36097d8b972e05e66d914"><div class="ttname"><a href="classmonster.html#ad4fba0b9aea36097d8b972e05e66d914">monster::get_name</a></div><div class="ttdeci">std::string get_name() const override</div><div class="ttdef"><b>Definition:</b> <a href="monster_8cpp_source.html#l00487">monster.cpp:487</a></div></div>
<div class="ttc" id="aclassmonster_html_af3444e4763b1dd53e75c5ea50fd8ba9f"><div class="ttname"><a href="classmonster.html#af3444e4763b1dd53e75c5ea50fd8ba9f">monster::disp_name</a></div><div class="ttdeci">std::string disp_name(bool possessive=false, bool capitalize_first=false) const override</div><div class="ttdef"><b>Definition:</b> <a href="monster_8cpp_source.html#l00536">monster.cpp:536</a></div></div>
<div class="ttc" id="aclassmonster_html_afc6e6f5443145732310dd4901a394b4f"><div class="ttname"><a href="classmonster.html#afc6e6f5443145732310dd4901a394b4f">monster::apply_damage</a></div><div class="ttdeci">void apply_damage(Creature *source, bodypart_id bp, int dam, bool bypass_med=false) override</div><div class="ttdef"><b>Definition:</b> <a href="monster_8cpp_source.html#l01636">monster.cpp:1636</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html"><div class="ttname"><a href="classoptional__vpart__position.html">optional_vpart_position</a></div><div class="ttdoc">Simple wrapper to forward functions that may return a cata::optional to vpart_position.</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00101">vpart_position.h:102</a></div></div>
<div class="ttc" id="aclassplayer_html"><div class="ttname"><a href="classplayer.html">player</a></div><div class="ttdef"><b>Definition:</b> <a href="player_8h_source.html#l00098">player.h:99</a></div></div>
<div class="ttc" id="aclassplayer_html_a07108565639fa6fe5b6776b4e8674fb6"><div class="ttname"><a href="classplayer.html#a07108565639fa6fe5b6776b4e8674fb6">player::add_msg_player_or_npc</a></div><div class="ttdeci">void add_msg_player_or_npc(const std::string &amp;player_msg, const std::string &amp;npc_str) const override</div><div class="ttdef"><b>Definition:</b> <a href="player_8cpp_source.html#l04373">player.cpp:4373</a></div></div>
<div class="ttc" id="aclassplayer_html_aa57c61de29a5e410c100aee07798b9b1"><div class="ttname"><a href="classplayer.html#aa57c61de29a5e410c100aee07798b9b1">player::practice</a></div><div class="ttdeci">void practice(const skill_id &amp;id, int amount, int cap=99, bool suppress_warning=false)</div><div class="ttdoc">This handles giving xp for a skill.</div><div class="ttdef"><b>Definition:</b> <a href="player_8cpp_source.html#l04005">player.cpp:4005</a></div></div>
<div class="ttc" id="aclassplayer_html_ae7009d849f19a4f5ebe877cbe463c459"><div class="ttname"><a href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">player::add_msg_if_player</a></div><div class="ttdeci">void add_msg_if_player(const std::string &amp;msg) const override</div><div class="ttdef"><b>Definition:</b> <a href="player_8cpp_source.html#l04368">player.cpp:4368</a></div></div>
<div class="ttc" id="aclassstring__id_html"><div class="ttname"><a href="classstring__id.html">string_id&lt; itype &gt;</a></div></div>
<div class="ttc" id="aclassstring__id_html_aa3cde2bfb58efa9621289c0a70d24c5a"><div class="ttname"><a href="classstring__id.html#aa3cde2bfb58efa9621289c0a70d24c5a">string_id::id</a></div><div class="ttdeci">int_id&lt; T &gt; id() const</div><div class="ttdoc">Translate the string based it to the matching integer based id.</div><div class="ttdef"><b>Definition:</b> <a href="ammo__effect_8cpp_source.html#l00054">ammo_effect.cpp:54</a></div></div>
<div class="ttc" id="aclasstileray_html"><div class="ttname"><a href="classtileray.html">tileray</a></div><div class="ttdef"><b>Definition:</b> <a href="tileray_8h_source.html#l00026">tileray.h:27</a></div></div>
<div class="ttc" id="aclasstileray_html_a27e3f200a89812a3d2fbc2e0e5710722"><div class="ttname"><a href="classtileray.html#a27e3f200a89812a3d2fbc2e0e5710722">tileray::dy</a></div><div class="ttdeci">int dy() const</div><div class="ttdef"><b>Definition:</b> <a href="tileray_8cpp_source.html#l00069">tileray.cpp:69</a></div></div>
<div class="ttc" id="aclasstileray_html_a283722bbdbde0af59bbda1a26adc5b88"><div class="ttname"><a href="classtileray.html#a283722bbdbde0af59bbda1a26adc5b88">tileray::advance</a></div><div class="ttdeci">void advance(int num=1)</div><div class="ttdef"><b>Definition:</b> <a href="tileray_8cpp_source.html#l00194">tileray.cpp:194</a></div></div>
<div class="ttc" id="aclasstileray_html_a91ed01227e1754597024f4916f8bd6af"><div class="ttname"><a href="classtileray.html#a91ed01227e1754597024f4916f8bd6af">tileray::dir</a></div><div class="ttdeci">units::angle dir() const</div><div class="ttdef"><b>Definition:</b> <a href="tileray_8cpp_source.html#l00074">tileray.cpp:74</a></div></div>
<div class="ttc" id="aclasstileray_html_ab643ca3c50332c73009031331e7c8026"><div class="ttname"><a href="classtileray.html#ab643ca3c50332c73009031331e7c8026">tileray::init</a></div><div class="ttdeci">void init(const point &amp;ad)</div><div class="ttdef"><b>Definition:</b> <a href="tileray_8cpp_source.html#l00027">tileray.cpp:27</a></div></div>
<div class="ttc" id="aclasstileray_html_aefd7fd88fdbfecf5731bbff553a7aab8"><div class="ttname"><a href="classtileray.html#aefd7fd88fdbfecf5731bbff553a7aab8">tileray::dx</a></div><div class="ttdeci">int dx() const</div><div class="ttdef"><b>Definition:</b> <a href="tileray_8cpp_source.html#l00064">tileray.cpp:64</a></div></div>
<div class="ttc" id="aclasstime__duration_html"><div class="ttname"><a href="classtime__duration.html">time_duration</a></div><div class="ttdoc">A duration defined as a number of specific time units.</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8h_source.html#l00179">calendar.h:180</a></div></div>
<div class="ttc" id="aclasstime__duration_html_a0f7145f4fc4c09defbaf25f468e4e54a"><div class="ttname"><a href="classtime__duration.html#a0f7145f4fc4c09defbaf25f468e4e54a">time_duration::from_turns</a></div><div class="ttdeci">static constexpr time_duration from_turns(const T t)</div><div class="ttdoc">Named constructors to get a duration representing a multiple of the named time units.</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8h_source.html#l00204">calendar.h:204</a></div></div>
<div class="ttc" id="aclasstowing__data_html_a4cc6247530a16020db73b3af28e0024e"><div class="ttname"><a href="classtowing__data.html#a4cc6247530a16020db73b3af28e0024e">towing_data::get_towed</a></div><div class="ttdeci">vehicle * get_towed() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00158">vehicle.h:158</a></div></div>
<div class="ttc" id="aclassunits_1_1quantity_html"><div class="ttname"><a href="classunits_1_1quantity.html">units::quantity</a></div><div class="ttdef"><b>Definition:</b> <a href="units__def_8h_source.html#l00014">units_def.h:15</a></div></div>
<div class="ttc" id="aclassvehicle_html"><div class="ttname"><a href="classvehicle.html">vehicle</a></div><div class="ttdoc">A vehicle as a whole with all its components.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00674">vehicle.h:675</a></div></div>
<div class="ttc" id="aclassvehicle_html_a00f013bfeaa4b6d44eaa67961f0c1e59"><div class="ttname"><a href="classvehicle.html#a00f013bfeaa4b6d44eaa67961f0c1e59">vehicle::part_with_feature</a></div><div class="ttdeci">int part_with_feature(int p, const std::string &amp;f, bool unbroken) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02518">vehicle.cpp:2518</a></div></div>
<div class="ttc" id="aclassvehicle_html_a050dcaa8958d866388b780738cf0e87d"><div class="ttname"><a href="classvehicle.html#a050dcaa8958d866388b780738cf0e87d">vehicle::dir_vec</a></div><div class="ttdeci">rl_vec2d dir_vec() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01225">vehicle_move.cpp:1225</a></div></div>
<div class="ttc" id="aclassvehicle_html_a07afedd1263adc69d4ddf5967b18d1c9"><div class="ttname"><a href="classvehicle.html#a07afedd1263adc69d4ddf5967b18d1c9">vehicle::static_drag</a></div><div class="ttdeci">int static_drag(bool actual=true) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04121">vehicle.cpp:4121</a></div></div>
<div class="ttc" id="aclassvehicle_html_a09364942b91a344a94af82fad1702918"><div class="ttname"><a href="classvehicle.html#a09364942b91a344a94af82fad1702918">vehicle::slowdown</a></div><div class="ttdeci">int slowdown(int velocity) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00087">vehicle_move.cpp:87</a></div></div>
<div class="ttc" id="aclassvehicle_html_a0a35b7f917fdb08e70a78315cc968f86"><div class="ttname"><a href="classvehicle.html#a0a35b7f917fdb08e70a78315cc968f86">vehicle::is_flying</a></div><div class="ttdeci">bool is_flying</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01917">vehicle.h:1917</a></div></div>
<div class="ttc" id="aclassvehicle_html_a0b298dcb96f6d82ac696f38d9a89868b"><div class="ttname"><a href="classvehicle.html#a0b298dcb96f6d82ac696f38d9a89868b">vehicle::thrust</a></div><div class="ttdeci">void thrust(int thd, int z=0)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00129">vehicle_move.cpp:129</a></div></div>
<div class="ttc" id="aclassvehicle_html_a0ccf22f114d5d8f239ebe58f5c8f70ad"><div class="ttname"><a href="classvehicle.html#a0ccf22f114d5d8f239ebe58f5c8f70ad">vehicle::engine_on</a></div><div class="ttdeci">bool engine_on</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01930">vehicle.h:1930</a></div></div>
<div class="ttc" id="aclassvehicle_html_a0e308fcc9e8b3b08ccf622825e94c9cc"><div class="ttname"><a href="classvehicle.html#a0e308fcc9e8b3b08ccf622825e94c9cc">vehicle::move_vec</a></div><div class="ttdeci">rl_vec2d move_vec() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01214">vehicle_move.cpp:1214</a></div></div>
<div class="ttc" id="aclassvehicle_html_a0ede4cc2a97a8305b1f06817d0d6cdf8"><div class="ttname"><a href="classvehicle.html#a0ede4cc2a97a8305b1f06817d0d6cdf8">vehicle::is_watercraft</a></div><div class="ttdeci">bool is_watercraft() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04037">vehicle.cpp:4037</a></div></div>
<div class="ttc" id="aclassvehicle_html_a1380ff85985897f9f8a34eba538e04db"><div class="ttname"><a href="classvehicle.html#a1380ff85985897f9f8a34eba538e04db">vehicle::turn</a></div><div class="ttdeci">void turn(units::angle deg)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00324">vehicle_move.cpp:324</a></div></div>
<div class="ttc" id="aclassvehicle_html_a19bf91bbba8085237248e25c7d214ee6"><div class="ttname"><a href="classvehicle.html#a19bf91bbba8085237248e25c7d214ee6">vehicle::pivot_point</a></div><div class="ttdeci">const point &amp; pivot_point() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l05636">vehicle.cpp:5636</a></div></div>
<div class="ttc" id="aclassvehicle_html_a222ab75111163098b53f34a28e017dad"><div class="ttname"><a href="classvehicle.html#a222ab75111163098b53f34a28e017dad">vehicle::unboard_all</a></div><div class="ttdeci">void unboard_all()</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l06165">vehicle.cpp:6165</a></div></div>
<div class="ttc" id="aclassvehicle_html_a2451db6447a956b203210ffaa654a59c"><div class="ttname"><a href="classvehicle.html#a2451db6447a956b203210ffaa654a59c">vehicle::check_heli_descend</a></div><div class="ttdeci">bool check_heli_descend(player &amp;p)</div><div class="ttdoc">can the helicopter descend/ascend here?</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00996">vehicle_move.cpp:996</a></div></div>
<div class="ttc" id="aclassvehicle_html_a26f98c384048e03538bca10e4f26905d"><div class="ttname"><a href="classvehicle.html#a26f98c384048e03538bca10e4f26905d">vehicle::is_following</a></div><div class="ttdeci">bool is_following</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01924">vehicle.h:1924</a></div></div>
<div class="ttc" id="aclassvehicle_html_a292961ab33a42bf495d19b8692f6f105"><div class="ttname"><a href="classvehicle.html#a292961ab33a42bf495d19b8692f6f105">vehicle::is_rotorcraft</a></div><div class="ttdeci">bool is_rotorcraft() const</div><div class="ttdoc">is the vehicle flying? is it a rotorcraft?</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04017">vehicle.cpp:4017</a></div></div>
<div class="ttc" id="aclassvehicle_html_a2adff790fcaea181f096ebaa213e698c"><div class="ttname"><a href="classvehicle.html#a2adff790fcaea181f096ebaa213e698c">vehicle::cpart</a></div><div class="ttdeci">const vehicle_part &amp; cpart(int part_num) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l06897">vehicle.cpp:6897</a></div></div>
<div class="ttc" id="aclassvehicle_html_a2bc8dfdab1fadc47966b0a69520c737c"><div class="ttname"><a href="classvehicle.html#a2bc8dfdab1fadc47966b0a69520c737c">vehicle::face_vec</a></div><div class="ttdeci">rl_vec2d face_vec() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01220">vehicle_move.cpp:1220</a></div></div>
<div class="ttc" id="aclassvehicle_html_a2e80dafb2c03147b569688658843d9d6"><div class="ttname"><a href="classvehicle.html#a2e80dafb2c03147b569688658843d9d6">vehicle::get_points</a></div><div class="ttdeci">std::set&lt; tripoint &gt; &amp; get_points(bool force_refresh=false)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l06568">vehicle.cpp:6568</a></div></div>
<div class="ttc" id="aclassvehicle_html_a300054370bb18b67094b827f8c586896"><div class="ttname"><a href="classvehicle.html#a300054370bb18b67094b827f8c586896">vehicle::level_vehicle</a></div><div class="ttdeci">bool level_vehicle()</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01413">vehicle_move.cpp:1413</a></div></div>
<div class="ttc" id="aclassvehicle_html_a31bcfe9c61adc2fe500315a59e1bb690"><div class="ttname"><a href="classvehicle.html#a31bcfe9c61adc2fe500315a59e1bb690">vehicle::engines</a></div><div class="ttdeci">std::vector&lt; int &gt; engines</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01752">vehicle.h:1752</a></div></div>
<div class="ttc" id="aclassvehicle_html_a320ca34b5c38568efd801731cef78a35"><div class="ttname"><a href="classvehicle.html#a320ca34b5c38568efd801731cef78a35">vehicle::skidding</a></div><div class="ttdeci">bool skidding</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01940">vehicle.h:1940</a></div></div>
<div class="ttc" id="aclassvehicle_html_a341515426011486c265d016c35f84de6"><div class="ttname"><a href="classvehicle.html#a341515426011486c265d016c35f84de6">vehicle::player_in_control</a></div><div class="ttdeci">bool player_in_control(const Character &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l00277">vehicle.cpp:277</a></div></div>
<div class="ttc" id="aclassvehicle_html_a34630935e46860003c616e0522316f02"><div class="ttname"><a href="classvehicle.html#a34630935e46860003c616e0522316f02">vehicle::sm_pos</a></div><div class="ttdeci">tripoint sm_pos</div><div class="ttdoc">Submap coordinates of the currently loaded submap (see game::m) that contains this vehicle.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01844">vehicle.h:1844</a></div></div>
<div class="ttc" id="aclassvehicle_html_a3900ee345be0453828a955a200154db1"><div class="ttname"><a href="classvehicle.html#a3900ee345be0453828a955a200154db1">vehicle::global_pos3</a></div><div class="ttdeci">tripoint global_pos3() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03101">vehicle.cpp:3101</a></div></div>
<div class="ttc" id="aclassvehicle_html_a396e319b27729d4c423b3d096e657bf9"><div class="ttname"><a href="classvehicle.html#a396e319b27729d4c423b3d096e657bf9">vehicle::part_flag</a></div><div class="ttdeci">bool part_flag(int p, const std::string &amp;f) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02875">vehicle.cpp:2875</a></div></div>
<div class="ttc" id="aclassvehicle_html_a3cfee06c49af306085cad6bbf3326319"><div class="ttname"><a href="classvehicle.html#a3cfee06c49af306085cad6bbf3326319">vehicle::in_water</a></div><div class="ttdeci">bool in_water</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01915">vehicle.h:1915</a></div></div>
<div class="ttc" id="aclassvehicle_html_a3d2d513640544cb11fa826890b692e5a"><div class="ttname"><a href="classvehicle.html#a3d2d513640544cb11fa826890b692e5a">vehicle::of_turn_carry</a></div><div class="ttdeci">float of_turn_carry</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01876">vehicle.h:1876</a></div></div>
<div class="ttc" id="aclassvehicle_html_a3d4d97e9ca8cb2642001f8f61df500d5"><div class="ttname"><a href="classvehicle.html#a3d4d97e9ca8cb2642001f8f61df500d5">vehicle::last_turn</a></div><div class="ttdeci">units::angle last_turn</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01872">vehicle.h:1872</a></div></div>
<div class="ttc" id="aclassvehicle_html_a40b149ccb2383cb1a263f3e3d88f3469"><div class="ttname"><a href="classvehicle.html#a40b149ccb2383cb1a263f3e3d88f3469">vehicle::is_towing</a></div><div class="ttdeci">bool is_towing() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l05844">vehicle.cpp:5844</a></div></div>
<div class="ttc" id="aclassvehicle_html_a416a2bc9ee792663fced3344db322cb8"><div class="ttname"><a href="classvehicle.html#a416a2bc9ee792663fced3344db322cb8">vehicle::vertical_velocity</a></div><div class="ttdeci">int vertical_velocity</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01865">vehicle.h:1865</a></div></div>
<div class="ttc" id="aclassvehicle_html_a441fa41f264fb7bc45df81d71244a0d1"><div class="ttname"><a href="classvehicle.html#a441fa41f264fb7bc45df81d71244a0d1">vehicle::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01792">vehicle.h:1792</a></div></div>
<div class="ttc" id="aclassvehicle_html_a4d83e86fe57ec6126893a68f68c3c304"><div class="ttname"><a href="classvehicle.html#a4d83e86fe57ec6126893a68f68c3c304">vehicle::velocity</a></div><div class="ttdeci">int velocity</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01861">vehicle.h:1861</a></div></div>
<div class="ttc" id="aclassvehicle_html_a506fb7b0a17c1578498599e14c173710"><div class="ttname"><a href="classvehicle.html#a506fb7b0a17c1578498599e14c173710">vehicle::magic</a></div><div class="ttdeci">bool magic</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01809">vehicle.h:1809</a></div></div>
<div class="ttc" id="aclassvehicle_html_a578c681656be6b419c62799006008035"><div class="ttname"><a href="classvehicle.html#a578c681656be6b419c62799006008035">vehicle::valid_wheel_config</a></div><div class="ttdeci">bool valid_wheel_config() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04279">vehicle.cpp:4279</a></div></div>
<div class="ttc" id="aclassvehicle_html_a58757e10821fc870895d84ebc4ac36a7"><div class="ttname"><a href="classvehicle.html#a58757e10821fc870895d84ebc4ac36a7">vehicle::check_is_heli_landed</a></div><div class="ttdeci">bool check_is_heli_landed()</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00985">vehicle_move.cpp:985</a></div></div>
<div class="ttc" id="aclassvehicle_html_a5a7d83716bf73d4b58d265b626872d01"><div class="ttname"><a href="classvehicle.html#a5a7d83716bf73d4b58d265b626872d01">vehicle::total_mass</a></div><div class="ttdeci">units::mass total_mass() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03126">vehicle.cpp:3126</a></div></div>
<div class="ttc" id="aclassvehicle_html_a5c432c0da0ff47a483e3aa74548bd435"><div class="ttname"><a href="classvehicle.html#a5c432c0da0ff47a483e3aa74548bd435">vehicle::wheelcache</a></div><div class="ttdeci">std::vector&lt; int &gt; wheelcache</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01761">vehicle.h:1761</a></div></div>
<div class="ttc" id="aclassvehicle_html_a603b71f04b9fdb63f400ac93fb4bea88"><div class="ttname"><a href="classvehicle.html#a603b71f04b9fdb63f400ac93fb4bea88">vehicle::has_engine_type</a></div><div class="ttdeci">bool has_engine_type(const itype_id &amp;ft, bool enabled) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l01031">vehicle.cpp:1031</a></div></div>
<div class="ttc" id="aclassvehicle_html_a63b06a1d61d0c44f460077314bb742a8"><div class="ttname"><a href="classvehicle.html#a63b06a1d61d0c44f460077314bb742a8">vehicle::check_falling_or_floating</a></div><div class="ttdeci">void check_falling_or_floating()</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01461">vehicle_move.cpp:1461</a></div></div>
<div class="ttc" id="aclassvehicle_html_a69a37e32958ea0bffc377cc3e0ece913"><div class="ttname"><a href="classvehicle.html#a69a37e32958ea0bffc377cc3e0ece913">vehicle::consume_fuel</a></div><div class="ttdeci">void consume_fuel(int load, int t_seconds=6, bool skip_electric=false)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04400">vehicle.cpp:4400</a></div></div>
<div class="ttc" id="aclassvehicle_html_a6ac15340cefeea4793448cdb34784011"><div class="ttname"><a href="classvehicle.html#a6ac15340cefeea4793448cdb34784011">vehicle::is_flying_in_air</a></div><div class="ttdeci">bool is_flying_in_air() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04027">vehicle.cpp:4027</a></div></div>
<div class="ttc" id="aclassvehicle_html_a72a3e7b7f00c193446b29adee5d5aa9f"><div class="ttname"><a href="classvehicle.html#a72a3e7b7f00c193446b29adee5d5aa9f">vehicle::tow_data</a></div><div class="ttdeci">towing_data tow_data</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01887">vehicle.h:1887</a></div></div>
<div class="ttc" id="aclassvehicle_html_a73db9a09464720b32da8e3f214475a8e"><div class="ttname"><a href="classvehicle.html#a73db9a09464720b32da8e3f214475a8e">vehicle::total_power_w</a></div><div class="ttdeci">int total_power_w(bool fueled=true, bool safe=false) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03333">vehicle.cpp:3333</a></div></div>
<div class="ttc" id="aclassvehicle_html_a7d3113700f4a8faafbdf34a46278687b"><div class="ttname"><a href="classvehicle.html#a7d3113700f4a8faafbdf34a46278687b">vehicle::check_heli_ascend</a></div><div class="ttdeci">bool check_heli_ascend(player &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01031">vehicle_move.cpp:1031</a></div></div>
<div class="ttc" id="aclassvehicle_html_a80d02aa674786172d2d8a7ec8f39a4b3"><div class="ttname"><a href="classvehicle.html#a80d02aa674786172d2d8a7ec8f39a4b3">vehicle::is_in_water</a></div><div class="ttdeci">bool is_in_water(bool deep_water=false) const</div><div class="ttdoc">is the vehicle mostly in water or mostly on fairly dry land?</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04042">vehicle.cpp:4042</a></div></div>
<div class="ttc" id="aclassvehicle_html_a819beb6aab98cb4b90478b65a35a07ac"><div class="ttname"><a href="classvehicle.html#a819beb6aab98cb4b90478b65a35a07ac">vehicle::possibly_recover_from_skid</a></div><div class="ttdeci">void possibly_recover_from_skid()</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01158">vehicle_move.cpp:1158</a></div></div>
<div class="ttc" id="aclassvehicle_html_a8997e3518316057cde55f9ecb444b8f0"><div class="ttname"><a href="classvehicle.html#a8997e3518316057cde55f9ecb444b8f0">vehicle::coeff_air_drag</a></div><div class="ttdeci">double coeff_air_drag() const</div><div class="ttdoc">Physical coefficients used for vehicle calculations.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03789">vehicle.cpp:3789</a></div></div>
<div class="ttc" id="aclassvehicle_html_a8a79185fd4b15560f76504af979b0bba"><div class="ttname"><a href="classvehicle.html#a8a79185fd4b15560f76504af979b0bba">vehicle::act_on_map</a></div><div class="ttdeci">vehicle * act_on_map()</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01239">vehicle_move.cpp:1239</a></div></div>
<div class="ttc" id="aclassvehicle_html_a8ae7b8e43449ee574a6fd266f4773892"><div class="ttname"><a href="classvehicle.html#a8ae7b8e43449ee574a6fd266f4773892">vehicle::max_velocity</a></div><div class="ttdeci">int max_velocity(bool fueled=true) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03543">vehicle.cpp:3543</a></div></div>
<div class="ttc" id="aclassvehicle_html_a8bbdfb41ea75fdc007feab08e2137aa2"><div class="ttname"><a href="classvehicle.html#a8bbdfb41ea75fdc007feab08e2137aa2">vehicle::move</a></div><div class="ttdeci">tileray move</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01893">vehicle.h:1893</a></div></div>
<div class="ttc" id="aclassvehicle_html_a8bdc82052e35e69dd5f65e1177a13a95"><div class="ttname"><a href="classvehicle.html#a8bdc82052e35e69dd5f65e1177a13a95">vehicle::noise_and_smoke</a></div><div class="ttdeci">void noise_and_smoke(int load, time_duration time=1_turns)</div><div class="ttdoc">Generate noise or smoke from a vehicle with engines turned on load = how hard the engines are working...</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03644">vehicle.cpp:3644</a></div></div>
<div class="ttc" id="aclassvehicle_html_a8c4e8182afb214351822aa818e919c52"><div class="ttname"><a href="classvehicle.html#a8c4e8182afb214351822aa818e919c52">vehicle::has_harnessed_animal</a></div><div class="ttdeci">bool has_harnessed_animal() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00919">vehicle_move.cpp:919</a></div></div>
<div class="ttc" id="aclassvehicle_html_a8d23ce82d669c714795a2ed9b679e3b9"><div class="ttname"><a href="classvehicle.html#a8d23ce82d669c714795a2ed9b679e3b9">vehicle::stop_autodriving</a></div><div class="ttdeci">void stop_autodriving(bool apply_brakes=true)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__autodrive_8cpp_source.html#l01292">vehicle_autodrive.cpp:1292</a></div></div>
<div class="ttc" id="aclassvehicle_html_a8df35c3f329b78ad0b912181f9e479e5"><div class="ttname"><a href="classvehicle.html#a8df35c3f329b78ad0b912181f9e479e5">vehicle::get_riders</a></div><div class="ttdeci">std::vector&lt; rider_data &gt; get_riders() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03058">vehicle.cpp:3058</a></div></div>
<div class="ttc" id="aclassvehicle_html_a8e021d197980bbed36ff3c43962df957"><div class="ttname"><a href="classvehicle.html#a8e021d197980bbed36ff3c43962df957">vehicle::face</a></div><div class="ttdeci">tileray face</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01891">vehicle.h:1891</a></div></div>
<div class="ttc" id="aclassvehicle_html_a8e7305881802ea38e07925826da63b82"><div class="ttname"><a href="classvehicle.html#a8e7305881802ea38e07925826da63b82">vehicle::forward_velocity</a></div><div class="ttdeci">float forward_velocity() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01187">vehicle_move.cpp:1187</a></div></div>
<div class="ttc" id="aclassvehicle_html_a8ee4e09fef222f0db06421381be4a354"><div class="ttname"><a href="classvehicle.html#a8ee4e09fef222f0db06421381be4a354">vehicle::pldrive</a></div><div class="ttdeci">void pldrive(Character &amp;driver, const point &amp;p, int z=0)</div><div class="ttdoc">Player is driving the vehicle.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01061">vehicle_move.cpp:1061</a></div></div>
<div class="ttc" id="aclassvehicle_html_a905db1f8c84d0754a8e0a121392a2b3a"><div class="ttname"><a href="classvehicle.html#a905db1f8c84d0754a8e0a121392a2b3a">vehicle::rail_wheelcache</a></div><div class="ttdeci">std::vector&lt; int &gt; rail_wheelcache</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01763">vehicle.h:1763</a></div></div>
<div class="ttc" id="aclassvehicle_html_a9c46063d58fd3a05504dec8bb8b6e837"><div class="ttname"><a href="classvehicle.html#a9c46063d58fd3a05504dec8bb8b6e837">vehicle::can_use_rails</a></div><div class="ttdeci">bool can_use_rails() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03369">vehicle.cpp:3369</a></div></div>
<div class="ttc" id="aclassvehicle_html_a9d41a3f9a7969c40ca5a9b7b5a3fdebe"><div class="ttname"><a href="classvehicle.html#a9d41a3f9a7969c40ca5a9b7b5a3fdebe">vehicle::k_traction</a></div><div class="ttdeci">float k_traction(float wheel_traction_area) const</div><div class="ttdoc">Traction coefficient of the vehicle.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04097">vehicle.cpp:4097</a></div></div>
<div class="ttc" id="aclassvehicle_html_aa17bd1dea0b5376e3d118ede063736f8"><div class="ttname"><a href="classvehicle.html#aa17bd1dea0b5376e3d118ede063736f8">vehicle::collision</a></div><div class="ttdeci">bool collision(std::vector&lt; veh_collision &gt; &amp;colls, const tripoint &amp;dp, bool just_detect, bool bash_floor=false)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00354">vehicle_move.cpp:354</a></div></div>
<div class="ttc" id="aclassvehicle_html_aab4917d0f78fe4df1c8f5303fdf2b86d"><div class="ttname"><a href="classvehicle.html#aab4917d0f78fe4df1c8f5303fdf2b86d">vehicle::part_info</a></div><div class="ttdeci">const vpart_info &amp; part_info(int index, bool include_removed=false) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l01137">vehicle.cpp:1137</a></div></div>
<div class="ttc" id="aclassvehicle_html_ab0ffd12faf770950ee7d2493ffaf9bd0"><div class="ttname"><a href="classvehicle.html#ab0ffd12faf770950ee7d2493ffaf9bd0">vehicle::autopilot_on</a></div><div class="ttdeci">bool autopilot_on</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01938">vehicle.h:1938</a></div></div>
<div class="ttc" id="aclassvehicle_html_ab1aa616008c1d4180e03c21d3b2ee218"><div class="ttname"><a href="classvehicle.html#ab1aa616008c1d4180e03c21d3b2ee218">vehicle::velo_vec</a></div><div class="ttdeci">rl_vec2d velo_vec() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01195">vehicle_move.cpp:1195</a></div></div>
<div class="ttc" id="aclassvehicle_html_ab266c3250ffece69b5c2ddc9897d80d3"><div class="ttname"><a href="classvehicle.html#ab266c3250ffece69b5c2ddc9897d80d3">vehicle::get_pet</a></div><div class="ttdeci">monster * get_pet(int p) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03082">vehicle.cpp:3082</a></div></div>
<div class="ttc" id="aclassvehicle_html_ab3ca604dd9cd1907f37c8a888934a1d3"><div class="ttname"><a href="classvehicle.html#ab3ca604dd9cd1907f37c8a888934a1d3">vehicle::stop</a></div><div class="ttdeci">void stop(bool update_cache=true)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00338">vehicle_move.cpp:338</a></div></div>
<div class="ttc" id="aclassvehicle_html_ab429af6376b555746f92158331f2a4cf"><div class="ttname"><a href="classvehicle.html#ab429af6376b555746f92158331f2a4cf">vehicle::boarded_parts</a></div><div class="ttdeci">std::vector&lt; int &gt; boarded_parts() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03047">vehicle.cpp:3047</a></div></div>
<div class="ttc" id="aclassvehicle_html_abdf6601268460dc437ef079590deb33b"><div class="ttname"><a href="classvehicle.html#abdf6601268460dc437ef079590deb33b">vehicle::cruise_on</a></div><div class="ttdeci">bool cruise_on</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01928">vehicle.h:1928</a></div></div>
<div class="ttc" id="aclassvehicle_html_abeeecc873ea4841652366d8ffc6c3bfe"><div class="ttname"><a href="classvehicle.html#abeeecc873ea4841652366d8ffc6c3bfe">vehicle::decrement_summon_timer</a></div><div class="ttdeci">bool decrement_summon_timer()</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l05425">vehicle.cpp:5425</a></div></div>
<div class="ttc" id="aclassvehicle_html_ac24aba962fd53d1a87bf57b52ce40508"><div class="ttname"><a href="classvehicle.html#ac24aba962fd53d1a87bf57b52ce40508">vehicle::is_towed</a></div><div class="ttdeci">bool is_towed() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l05859">vehicle.cpp:5859</a></div></div>
<div class="ttc" id="aclassvehicle_html_ac2de625db1619f042c4a3a69d0995a6a"><div class="ttname"><a href="classvehicle.html#ac2de625db1619f042c4a3a69d0995a6a">vehicle::damage_direct</a></div><div class="ttdeci">int damage_direct(int p, int dmg, damage_type type=DT_TRUE)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l06437">vehicle.cpp:6437</a></div></div>
<div class="ttc" id="aclassvehicle_html_ac460f925a21efb9dea1dc0fc2f930609"><div class="ttname"><a href="classvehicle.html#ac460f925a21efb9dea1dc0fc2f930609">vehicle::can_float</a></div><div class="ttdeci">bool can_float() const</div><div class="ttdoc">can_float does the vehicle have freeboard or does it overflow with water?</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03974">vehicle.cpp:3974</a></div></div>
<div class="ttc" id="aclassvehicle_html_ac49843abe67be6f7f9c3fdaf92e2f411"><div class="ttname"><a href="classvehicle.html#ac49843abe67be6f7f9c3fdaf92e2f411">vehicle::strain</a></div><div class="ttdeci">float strain() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04126">vehicle.cpp:4126</a></div></div>
<div class="ttc" id="aclassvehicle_html_ac82426b9ed349941fde4e5af18038735"><div class="ttname"><a href="classvehicle.html#ac82426b9ed349941fde4e5af18038735">vehicle::check_environmental_effects</a></div><div class="ttdeci">bool check_environmental_effects</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01942">vehicle.h:1942</a></div></div>
<div class="ttc" id="aclassvehicle_html_ac8a5271d6aeae28a1bd341800cc5254d"><div class="ttname"><a href="classvehicle.html#ac8a5271d6aeae28a1bd341800cc5254d">vehicle::selfdrive</a></div><div class="ttdeci">void selfdrive(const point &amp;)</div><div class="ttdoc">vehicle is driving itself</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00933">vehicle_move.cpp:933</a></div></div>
<div class="ttc" id="aclassvehicle_html_ac9e0d3482a62d5ac5ec8e5fc83cfaa4a"><div class="ttname"><a href="classvehicle.html#ac9e0d3482a62d5ac5ec8e5fc83cfaa4a">vehicle::cruise_thrust</a></div><div class="ttdeci">void cruise_thrust(int amount)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00285">vehicle_move.cpp:285</a></div></div>
<div class="ttc" id="aclassvehicle_html_acc7fb8b935b2f6f3d26efaf0fae16230"><div class="ttname"><a href="classvehicle.html#acc7fb8b935b2f6f3d26efaf0fae16230">vehicle::coeff_rolling_drag</a></div><div class="ttdeci">double coeff_rolling_drag() const</div><div class="ttdoc">coefficient of rolling resistance multiplied by velocity to get the variable part of rolling resistan...</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03928">vehicle.cpp:3928</a></div></div>
<div class="ttc" id="aclassvehicle_html_acdb2ebf673a32f657ac9e29b842ee7f5"><div class="ttname"><a href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">vehicle::part</a></div><div class="ttdeci">vehicle_part &amp; part(int part_num)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l06892">vehicle.cpp:6892</a></div></div>
<div class="ttc" id="aclassvehicle_html_ad38e05507056b3b3da5a5a5e482adba4"><div class="ttname"><a href="classvehicle.html#ad38e05507056b3b3da5a5a5e482adba4">vehicle::safe_velocity</a></div><div class="ttdeci">int safe_velocity(bool fueled=true) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03593">vehicle.cpp:3593</a></div></div>
<div class="ttc" id="aclassvehicle_html_ad81a52a0535e57a0d7e390f6f379ae42"><div class="ttname"><a href="classvehicle.html#ad81a52a0535e57a0d7e390f6f379ae42">vehicle::current_acceleration</a></div><div class="ttdeci">int current_acceleration(bool fueled=true) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03472">vehicle.cpp:3472</a></div></div>
<div class="ttc" id="aclassvehicle_html_ad845fa8ba69c4b41cf6a0fc35db7f01d"><div class="ttname"><a href="classvehicle.html#ad845fa8ba69c4b41cf6a0fc35db7f01d">vehicle::max_reverse_velocity</a></div><div class="ttdeci">int max_reverse_velocity(bool fueled=true) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03554">vehicle.cpp:3554</a></div></div>
<div class="ttc" id="aclassvehicle_html_adaf4a073304f9f96f055094f700b0134"><div class="ttname"><a href="classvehicle.html#adaf4a073304f9f96f055094f700b0134">vehicle::do_engine_damage</a></div><div class="ttdeci">void do_engine_damage(size_t e, int strain)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l05018">vehicle.cpp:5018</a></div></div>
<div class="ttc" id="aclassvehicle_html_ae3cbbbb890aa9a12504ec3458746f3e1"><div class="ttname"><a href="classvehicle.html#ae3cbbbb890aa9a12504ec3458746f3e1">vehicle::is_floating</a></div><div class="ttdeci">bool is_floating</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01913">vehicle.h:1913</a></div></div>
<div class="ttc" id="aclassvehicle_html_ae4630e42613cfd4129edd33828c10dc4"><div class="ttname"><a href="classvehicle.html#ae4630e42613cfd4129edd33828c10dc4">vehicle::handle_trap</a></div><div class="ttdeci">void handle_trap(const tripoint &amp;p, int part)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00845">vehicle_move.cpp:845</a></div></div>
<div class="ttc" id="aclassvehicle_html_ae4a8bd9a6ff5fb9a0169296a776c1e98"><div class="ttname"><a href="classvehicle.html#ae4a8bd9a6ff5fb9a0169296a776c1e98">vehicle::part_collision</a></div><div class="ttdeci">veh_collision part_collision(int part, const tripoint &amp;p, bool just_detect, bool bash_floor)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00470">vehicle_move.cpp:470</a></div></div>
<div class="ttc" id="aclassvehicle_html_ae57bcc52818212097155515e82c3a84d"><div class="ttname"><a href="classvehicle.html#ae57bcc52818212097155515e82c3a84d">vehicle::rail_profile</a></div><div class="ttdeci">std::vector&lt; int &gt; rail_profile</div><div class="ttdoc">Rail profile of the vehicle.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01789">vehicle.h:1789</a></div></div>
<div class="ttc" id="aclassvehicle_html_ae8132c34a1ea24866889e6e599796adc"><div class="ttname"><a href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">vehicle::global_part_pos3</a></div><div class="ttdeci">tripoint global_part_pos3(const int &amp;index) const</div><div class="ttdoc">Get the coordinates of the studied part of the vehicle.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03106">vehicle.cpp:3106</a></div></div>
<div class="ttc" id="aclassvehicle_html_ae94902df801fd06056734d05ea98aa0f"><div class="ttname"><a href="classvehicle.html#ae94902df801fd06056734d05ea98aa0f">vehicle::floating</a></div><div class="ttdeci">std::vector&lt; int &gt; floating</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01767">vehicle.h:1767</a></div></div>
<div class="ttc" id="aclassvehicle_html_ae97aeac27584b839105a68f12eb1f7a1"><div class="ttname"><a href="classvehicle.html#ae97aeac27584b839105a68f12eb1f7a1">vehicle::coeff_water_drag</a></div><div class="ttdeci">double coeff_water_drag() const</div><div class="ttdoc">coefficient of water drag in kg/m multiplied by the square of speed to calculate water drag force in ...</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04047">vehicle.cpp:4047</a></div></div>
<div class="ttc" id="aclassvehicle_html_aeafb913ad9b9d1341d51a4c51ba43a06"><div class="ttname"><a href="classvehicle.html#aeafb913ad9b9d1341d51a4c51ba43a06">vehicle::is_falling</a></div><div class="ttdeci">bool is_falling</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01946">vehicle.h:1946</a></div></div>
<div class="ttc" id="aclassvehicle_html_aeb404e5f18eee80d104a7bb0680ac169"><div class="ttname"><a href="classvehicle.html#aeb404e5f18eee80d104a7bb0680ac169">vehicle::requested_z_change</a></div><div class="ttdeci">int requested_z_change</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01918">vehicle.h:1918</a></div></div>
<div class="ttc" id="aclassvehicle_html_aec2fcbe01499d105316d14c8b99107a2"><div class="ttname"><a href="classvehicle.html#aec2fcbe01499d105316d14c8b99107a2">vehicle::steering_effectiveness</a></div><div class="ttdeci">float steering_effectiveness() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04284">vehicle.cpp:4284</a></div></div>
<div class="ttc" id="aclassvehicle_html_aec9a1faa6740b681867d48878e37d7bb"><div class="ttname"><a href="classvehicle.html#aec9a1faa6740b681867d48878e37d7bb">vehicle::is_moving</a></div><div class="ttdeci">bool is_moving() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03364">vehicle.cpp:3364</a></div></div>
<div class="ttc" id="aclassvehicle_html_aedeb37c9ce1c25bd8b9765e91ef6e502"><div class="ttname"><a href="classvehicle.html#aedeb37c9ce1c25bd8b9765e91ef6e502">vehicle::handling_difficulty</a></div><div class="ttdeci">float handling_difficulty() const</div><div class="ttdoc">Returns roughly driving skill level at which there is no chance of fumbling.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l04325">vehicle.cpp:4325</a></div></div>
<div class="ttc" id="aclassvehicle_html_af02a0418851ddf50fcc810951d77b076"><div class="ttname"><a href="classvehicle.html#af02a0418851ddf50fcc810951d77b076">vehicle::get_passenger</a></div><div class="ttdeci">player * get_passenger(int p) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03073">vehicle.cpp:3073</a></div></div>
<div class="ttc" id="aclassvehicle_html_af366981a584e12d25133fb479d47de33"><div class="ttname"><a href="classvehicle.html#af366981a584e12d25133fb479d47de33">vehicle::turn_dir</a></div><div class="ttdeci">units::angle turn_dir</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01870">vehicle.h:1870</a></div></div>
<div class="ttc" id="aclassvehicle_html_af5c4cd455d31d1a9377ddad223cafe44"><div class="ttname"><a href="classvehicle.html#af5c4cd455d31d1a9377ddad223cafe44">vehicle::cruise_velocity</a></div><div class="ttdeci">int cruise_velocity</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01863">vehicle.h:1863</a></div></div>
<div class="ttc" id="aclassvehicle_html_af757f49411232815e121faa825d415f7"><div class="ttname"><a href="classvehicle.html#af757f49411232815e121faa825d415f7">vehicle::of_turn</a></div><div class="ttdeci">float of_turn</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01874">vehicle.h:1874</a></div></div>
<div class="ttc" id="aclassvehicle_html_afac2bfaf9d2b400e9a9e171624f74c40"><div class="ttname"><a href="classvehicle.html#afac2bfaf9d2b400e9a9e171624f74c40">vehicle::parts</a></div><div class="ttdeci">std::vector&lt; vehicle_part &gt; parts</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l01733">vehicle.h:1733</a></div></div>
<div class="ttc" id="aclassvpart__info_html"><div class="ttname"><a href="classvpart__info.html">vpart_info</a></div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00132">veh_type.h:133</a></div></div>
<div class="ttc" id="aclassvpart__info_html_a010d7002072c22b1029fdbfbf310cedc"><div class="ttname"><a href="classvpart__info.html#a010d7002072c22b1029fdbfbf310cedc">vpart_info::dmg_mod</a></div><div class="ttdeci">int dmg_mod</div><div class="ttdoc">Damage modifier (percentage) used when damaging other entities upon collision.</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00179">veh_type.h:179</a></div></div>
<div class="ttc" id="aclassvpart__info_html_a03cfe554b18beb9c32d9a86872a1748e"><div class="ttname"><a href="classvpart__info.html#a03cfe554b18beb9c32d9a86872a1748e">vpart_info::location</a></div><div class="ttdeci">std::string location</div><div class="ttdoc">What slot of the vehicle tile does this part occupy?</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00155">veh_type.h:155</a></div></div>
<div class="ttc" id="aclassvpart__info_html_a318d0a0075dd29d8560228d551d3dc9f"><div class="ttname"><a href="classvpart__info.html#a318d0a0075dd29d8560228d551d3dc9f">vpart_info::wheel_terrain_mod</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; std::string, int &gt; &gt; wheel_terrain_mod() const</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8cpp_source.html#l00897">veh_type.cpp:897</a></div></div>
<div class="ttc" id="aclassvpart__info_html_adb7dd24347aac9bff4ef3d7ff3663ded"><div class="ttname"><a href="classvpart__info.html#adb7dd24347aac9bff4ef3d7ff3663ded">vpart_info::item</a></div><div class="ttdeci">itype_id item</div><div class="ttdoc">base item for this part</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00152">veh_type.h:152</a></div></div>
<div class="ttc" id="aclassvpart__info_html_ae9c50d26b3cc88604ae85573ee6599cd"><div class="ttname"><a href="classvpart__info.html#ae9c50d26b3cc88604ae85573ee6599cd">vpart_info::fuel_type</a></div><div class="ttdeci">itype_id fuel_type</div><div class="ttdoc">Fuel type of engine or tank.</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00203">veh_type.h:203</a></div></div>
<div class="ttc" id="aclassvpart__info_html_af014709bbc2aceff9f6e91bd15e6d508"><div class="ttname"><a href="classvpart__info.html#af014709bbc2aceff9f6e91bd15e6d508">vpart_info::rotor_diameter</a></div><div class="ttdeci">int rotor_diameter() const</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8cpp_source.html#l00908">veh_type.cpp:908</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a00be0762df7b46da965e55caffac53db"><div class="ttname"><a href="coordinates_8h.html#a00be0762df7b46da965e55caffac53db">direction_from</a></div><div class="ttdeci">direction direction_from(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00540">coordinates.h:540</a></div></div>
<div class="ttc" id="acreature_8h_html"><div class="ttname"><a href="creature_8h.html">creature.h</a></div></div>
<div class="ttc" id="adebug_8h_html"><div class="ttname"><a href="debug_8h.html">debug.h</a></div></div>
<div class="ttc" id="adebug_8h_html_a157bb3f8cadfd404439ad477a19e8515a4059b0251f66a18cb56f544728796875"><div class="ttname"><a href="debug_8h.html#a157bb3f8cadfd404439ad477a19e8515a4059b0251f66a18cb56f544728796875">DL::Info</a></div><div class="ttdeci">@ Info</div><div class="ttdoc">Information (default: enabled).</div></div>
<div class="ttc" id="adebug_8h_html_a87e509562277a7ada3a75330d00cb445"><div class="ttname"><a href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a></div><div class="ttdeci">#define debugmsg(...)</div><div class="ttdoc">Debug message of level DL::Error and class DC::DebugMsg, also includes the source file name and line,...</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00074">debug.h:74</a></div></div>
<div class="ttc" id="aenums_8h_html"><div class="ttname"><a href="enums_8h.html">enums.h</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a></div><div class="ttdeci">@ m_info</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00258">enums.h:258</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a></div><div class="ttdeci">@ m_bad</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00254">enums.h:254</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a></div><div class="ttdeci">@ m_debug</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00264">enums.h:264</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a></div><div class="ttdeci">@ m_warning</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00257">enums.h:257</a></div></div>
<div class="ttc" id="aenums_8h_html_a89bed42d8e3efcd44570febc837f088e"><div class="ttname"><a href="enums_8h.html#a89bed42d8e3efcd44570febc837f088e">sgn</a></div><div class="ttdeci">constexpr int sgn(const T x)</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00008">enums.h:8</a></div></div>
<div class="ttc" id="aexplosion_8h_html"><div class="ttname"><a href="explosion_8h.html">explosion.h</a></div></div>
<div class="ttc" id="agame_8cpp_html_abeb98e93502d73818b4a73fabe191bc1"><div class="ttname"><a href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a></div><div class="ttdeci">std::unique_ptr&lt; game &gt; g</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l00267">game.cpp:267</a></div></div>
<div class="ttc" id="agame_8h_html"><div class="ttname"><a href="game_8h.html">game.h</a></div></div>
<div class="ttc" id="agame__constants_8h_html_aad0eacfa516a8f7e005674027d7640fe"><div class="ttname"><a href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a></div><div class="ttdeci">static constexpr int OVERMAP_DEPTH</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00061">game_constants.h:61</a></div></div>
<div class="ttc" id="aint__id_8h_html"><div class="ttname"><a href="int__id_8h.html">int_id.h</a></div></div>
<div class="ttc" id="aitem_8h_html"><div class="ttname"><a href="item_8h.html">item.h</a></div></div>
<div class="ttc" id="aitype_8h_html"><div class="ttname"><a href="itype_8h.html">itype.h</a></div></div>
<div class="ttc" id="aline_8cpp_html_a19634ed59e09da9312d6fa110a38539c"><div class="ttname"><a href="line_8cpp.html#a19634ed59e09da9312d6fa110a38539c">direction_name</a></div><div class="ttdeci">std::string direction_name(const direction dir)</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00528">line.cpp:528</a></div></div>
<div class="ttc" id="aline_8cpp_html_a9cbf6626ab40d551e7092ba115965380"><div class="ttname"><a href="line_8cpp.html#a9cbf6626ab40d551e7092ba115965380">calc_ray_end</a></div><div class="ttdeci">void calc_ray_end(units::angle angle, const int range, const tripoint &amp;p, tripoint &amp;out)</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00751">line.cpp:751</a></div></div>
<div class="ttc" id="aline_8h_html_a3621d2006812bd84f3ed6999b38f90a3"><div class="ttname"><a href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a></div><div class="ttdeci">direction</div><div class="ttdef"><b>Definition:</b> <a href="line_8h_source.html#l00039">line.h:39</a></div></div>
<div class="ttc" id="amagic_8cpp_html_a188caae18b60b66f9f44214c7e28ac1f"><div class="ttname"><a href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a></div><div class="ttdeci">constexpr double a</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01029">magic.cpp:1029</a></div></div>
<div class="ttc" id="amap_8cpp_html_acb0b34be6e497bdd2f9f40ae6929d562"><div class="ttname"><a href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a></div><div class="ttdeci">map &amp; get_map()</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l00141">map.cpp:141</a></div></div>
<div class="ttc" id="amap_8h_html"><div class="ttname"><a href="map_8h.html">map.h</a></div></div>
<div class="ttc" id="amap__iterator_8h_html"><div class="ttname"><a href="map__iterator_8h.html">map_iterator.h</a></div></div>
<div class="ttc" id="amapdata_8h_html"><div class="ttname"><a href="mapdata_8h.html">mapdata.h</a></div></div>
<div class="ttc" id="amapdata_8h_html_aa04d037303ea30193f7cf0cd82304258a36b67adb6e7c521980de8a6688085d16"><div class="ttname"><a href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a36b67adb6e7c521980de8a6688085d16">TFLAG_SWIMMABLE</a></div><div class="ttdeci">@ TFLAG_SWIMMABLE</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00279">mapdata.h:279</a></div></div>
<div class="ttc" id="amapdata_8h_html_aa04d037303ea30193f7cf0cd82304258a526400ab16c5537e7cbbe1a1a400ae6e"><div class="ttname"><a href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a526400ab16c5537e7cbbe1a1a400ae6e">TFLAG_INDOORS</a></div><div class="ttdeci">@ TFLAG_INDOORS</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00291">mapdata.h:291</a></div></div>
<div class="ttc" id="amapdata_8h_html_aa04d037303ea30193f7cf0cd82304258a7ae3043cdc343c2784d644bcafe86269"><div class="ttname"><a href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a7ae3043cdc343c2784d644bcafe86269">TFLAG_NO_FLOOR</a></div><div class="ttdeci">@ TFLAG_NO_FLOOR</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00310">mapdata.h:310</a></div></div>
<div class="ttc" id="amapdata_8h_html_aa04d037303ea30193f7cf0cd82304258aa629b376f81403545931bc8b5689490f"><div class="ttname"><a href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258aa629b376f81403545931bc8b5689490f">TFLAG_RAIL</a></div><div class="ttdeci">@ TFLAG_RAIL</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00318">mapdata.h:318</a></div></div>
<div class="ttc" id="amapdata_8h_html_aa04d037303ea30193f7cf0cd82304258aeb9fcbd752ad2c632ccc4383c5641b69"><div class="ttname"><a href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258aeb9fcbd752ad2c632ccc4383c5641b69">TFLAG_DEEP_WATER</a></div><div class="ttdeci">@ TFLAG_DEEP_WATER</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00301">mapdata.h:301</a></div></div>
<div class="ttc" id="amaterial_8h_html"><div class="ttname"><a href="material_8h.html">material.h</a></div></div>
<div class="ttc" id="amaterial_8h_html_a988f56b9fb9795d303c0c614f3b19d7c"><div class="ttname"><a href="material_8h.html#a988f56b9fb9795d303c0c614f3b19d7c">material_id_list</a></div><div class="ttdeci">std::vector&lt; material_id &gt; material_id_list</div><div class="ttdef"><b>Definition:</b> <a href="material_8h_source.html#l00024">material.h:24</a></div></div>
<div class="ttc" id="amath__defines_8h_html"><div class="ttname"><a href="math__defines_8h.html">math_defines.h</a></div></div>
<div class="ttc" id="amessages_8cpp_html_a54489326fc37823819c5105addfa27f2"><div class="ttname"><a href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a></div><div class="ttdeci">void add_msg(std::string msg)</div><div class="ttdef"><b>Definition:</b> <a href="messages_8cpp_source.html#l00884">messages.cpp:884</a></div></div>
<div class="ttc" id="amessages_8h_html"><div class="ttname"><a href="messages_8h.html">messages.h</a></div></div>
<div class="ttc" id="amonster_8h_html"><div class="ttname"><a href="monster_8h.html">monster.h</a></div></div>
<div class="ttc" id="anamespaceammo__effects_html_a266026a76ad1cf3377d0b7c6efc36dd7"><div class="ttname"><a href="namespaceammo__effects.html#a266026a76ad1cf3377d0b7c6efc36dd7">ammo_effects::load</a></div><div class="ttdeci">void load(const JsonObject &amp;jo, const std::string &amp;src)</div><div class="ttdef"><b>Definition:</b> <a href="ammo__effect_8cpp_source.html#l00147">ammo_effect.cpp:147</a></div></div>
<div class="ttc" id="anamespacecata_1_1hash64__detail_html_a5ca825db6fd06946302c60daa97333e4"><div class="ttname"><a href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">cata::hash64_detail::ret</a></div><div class="ttdeci">T ret</div><div class="ttdef"><b>Definition:</b> <a href="hash__utils_8h_source.html#l00097">hash_utils.h:97</a></div></div>
<div class="ttc" id="anamespacedetail_html_a955ad02ade4f07084391a60ed80701bf"><div class="ttname"><a href="namespacedetail.html#a955ad02ade4f07084391a60ed80701bf">detail::normalize</a></div><div class="ttdeci">fp normalize(fp value)</div><div class="ttdef"><b>Definition:</b> <a href="fmtlib__format-inl_8h_source.html#l01223">fmtlib_format-inl.h:1223</a></div></div>
<div class="ttc" id="anamespacedetail_html_ab2f84fb3de26acdac3fc63a2dce5ea5e"><div class="ttname"><a href="namespacedetail.html#ab2f84fb3de26acdac3fc63a2dce5ea5e">detail::count</a></div><div class="ttdeci">constexpr size_t count()</div><div class="ttdef"><b>Definition:</b> <a href="fmtlib__core_8h_source.html#l01073">fmtlib_core.h:1073</a></div></div>
<div class="ttc" id="anamespaceexplosion__handler_html_aedf90c876bd69288b266c6a60dbc91dc"><div class="ttname"><a href="namespaceexplosion__handler.html#aedf90c876bd69288b266c6a60dbc91dc">explosion_handler::explosion</a></div><div class="ttdeci">void explosion(const tripoint &amp;p, float power, float factor, bool fire, int legacy_casing_mass, float)</div><div class="ttdoc">Legacy explosion function.</div><div class="ttdef"><b>Definition:</b> <a href="explosion_8cpp_source.html#l00684">explosion.cpp:684</a></div></div>
<div class="ttc" id="anamespacesounds_html_a6bb79ae1c9c3dcd8c8e0b28c66b0398d"><div class="ttname"><a href="namespacesounds.html#a6bb79ae1c9c3dcd8c8e0b28c66b0398d">sounds::sound</a></div><div class="ttdeci">void sound(const tripoint &amp;p, int vol, sound_t category, const std::string &amp;description, bool ambient=false, const std::string &amp;id=&quot;&quot;, const std::string &amp;variant=&quot;default&quot;)</div><div class="ttdoc">Sound at (p) of intensity (vol)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l00177">sounds.cpp:177</a></div></div>
<div class="ttc" id="anamespacesounds_html_af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed"><div class="ttname"><a href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed">sounds::sound_t::combat</a></div><div class="ttdeci">@ combat</div></div>
<div class="ttc" id="anamespaceunits_html_a068cd98efba5fd1fbb936ce3597db23d"><div class="ttname"><a href="namespaceunits.html#a068cd98efba5fd1fbb936ce3597db23d">units::from_degrees</a></div><div class="ttdeci">constexpr quantity&lt; double, angle_in_radians_tag &gt; from_degrees(const value_type v)</div><div class="ttdef"><b>Definition:</b> <a href="units__angle_8h_source.html#l00031">units_angle.h:31</a></div></div>
<div class="ttc" id="anamespaceunits_html_a0b9218914b883c6c31f5af68deaafc2e"><div class="ttname"><a href="namespaceunits.html#a0b9218914b883c6c31f5af68deaafc2e">units::fabs</a></div><div class="ttdeci">quantity&lt; V, U &gt; fabs(quantity&lt; V, U &gt; q)</div><div class="ttdef"><b>Definition:</b> <a href="units__def_8h_source.html#l00136">units_def.h:136</a></div></div>
<div class="ttc" id="anamespaceunits_html_a2c7fe916bf04655f9fb4f2abdc5d28ed"><div class="ttname"><a href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">units::angle</a></div><div class="ttdeci">quantity&lt; double, angle_in_radians_tag &gt; angle</div><div class="ttdef"><b>Definition:</b> <a href="units__angle_8h_source.html#l00017">units_angle.h:17</a></div></div>
<div class="ttc" id="anamespaceunits_html_a4b5ee56fbe0ef728f4b190e1282a5d82"><div class="ttname"><a href="namespaceunits.html#a4b5ee56fbe0ef728f4b190e1282a5d82">units::sin</a></div><div class="ttdeci">double sin(angle a)</div><div class="ttdef"><b>Definition:</b> <a href="units__angle_8h_source.html#l00052">units_angle.h:52</a></div></div>
<div class="ttc" id="anamespaceunits_html_a9c92bd154caa6182d686cab22405b92e"><div class="ttname"><a href="namespaceunits.html#a9c92bd154caa6182d686cab22405b92e">units::cos</a></div><div class="ttdeci">double cos(angle a)</div><div class="ttdef"><b>Definition:</b> <a href="units__angle_8h_source.html#l00057">units_angle.h:57</a></div></div>
<div class="ttc" id="anamespaceunits_html_a9ce2bc1618fa4acf9f9e98effd9f1ae0"><div class="ttname"><a href="namespaceunits.html#a9ce2bc1618fa4acf9f9e98effd9f1ae0">units::to_degrees</a></div><div class="ttdeci">constexpr double to_degrees(const units::angle v)</div><div class="ttdef"><b>Definition:</b> <a href="units__angle_8h_source.html#l00036">units_angle.h:36</a></div></div>
<div class="ttc" id="anamespaceunits_html_af4f3159f510e2b4372187d8fb4746e23"><div class="ttname"><a href="namespaceunits.html#af4f3159f510e2b4372187d8fb4746e23">units::mass</a></div><div class="ttdeci">quantity&lt; std::int64_t, mass_in_milligram_tag &gt; mass</div><div class="ttdef"><b>Definition:</b> <a href="units__mass_8h_source.html#l00022">units_mass.h:22</a></div></div>
<div class="ttc" id="anamespaceunits_html_afbf21a7601bd939c196667fc0b020111"><div class="ttname"><a href="namespaceunits.html#afbf21a7601bd939c196667fc0b020111">units::to_kilogram</a></div><div class="ttdeci">constexpr value_type to_kilogram(const quantity&lt; value_type, mass_in_milligram_tag &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="units__mass_8h_source.html#l00073">units_mass.h:73</a></div></div>
<div class="ttc" id="anamespacevehicle__movement_html"><div class="ttname"><a href="namespacevehicle__movement.html">vehicle_movement</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01663">vehicle_move.cpp:1664</a></div></div>
<div class="ttc" id="anamespacevehicle__movement_html_a2bddc1d0e2dc9d47e0c3a85362f1bd46"><div class="ttname"><a href="namespacevehicle__movement.html#a2bddc1d0e2dc9d47e0c3a85362f1bd46">vehicle_movement::scan_rails_from_veh_internal</a></div><div class="ttdeci">static bool scan_rails_from_veh_internal(const map &amp;m, const vehicle &amp;veh, tripoint scan_initial_pos, point veh_plus_y_vec, point scan_vec)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01665">vehicle_move.cpp:1665</a></div></div>
<div class="ttc" id="anamespacevehicle__movement_html_a5de69a719cc4cbf1c0c491fe54a4443b"><div class="ttname"><a href="namespacevehicle__movement.html#a5de69a719cc4cbf1c0c491fe54a4443b">vehicle_movement::scan_rails_at_shift</a></div><div class="ttdeci">static bool scan_rails_at_shift(const map &amp;m, const vehicle &amp;veh, int velocity_sign, units::angle dir, int shift_sign, tripoint *shift_amt=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01687">vehicle_move.cpp:1687</a></div></div>
<div class="ttc" id="anamespacevehicle__movement_html_a77db2ddbeface5f8a7eda956e2bbef20"><div class="ttname"><a href="namespacevehicle__movement.html#a77db2ddbeface5f8a7eda956e2bbef20">vehicle_movement::make_turn</a></div><div class="ttdeci">static rail_processing_result make_turn(units::angle a)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01752">vehicle_move.cpp:1752</a></div></div>
<div class="ttc" id="anamespacevehicle__movement_html_a90726346ef0084026393895b4e7bcb20"><div class="ttname"><a href="namespacevehicle__movement.html#a90726346ef0084026393895b4e7bcb20">vehicle_movement::make_none</a></div><div class="ttdeci">static rail_processing_result make_none()</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01747">vehicle_move.cpp:1747</a></div></div>
<div class="ttc" id="anamespacevehicle__movement_html_a90bf274fc2c6eb229613c63739d8e2c1"><div class="ttname"><a href="namespacevehicle__movement.html#a90bf274fc2c6eb229613c63739d8e2c1">vehicle_movement::process_movement_on_rails</a></div><div class="ttdeci">rail_processing_result process_movement_on_rails(const map &amp;m, const vehicle &amp;veh)</div><div class="ttdoc">Decides how the vehicle should move in order to follow rails, or get on rails.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01768">vehicle_move.cpp:1768</a></div></div>
<div class="ttc" id="anamespacevehicle__movement_html_ac828727a3d0872b1535bf031b77d0590"><div class="ttname"><a href="namespacevehicle__movement.html#ac828727a3d0872b1535bf031b77d0590">vehicle_movement::make_shift</a></div><div class="ttdeci">static rail_processing_result make_shift(tripoint dp)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01760">vehicle_move.cpp:1760</a></div></div>
<div class="ttc" id="anamespacevehicle__movement_html_ad2c532fb5522d745b0006f7a3b36cab3"><div class="ttname"><a href="namespacevehicle__movement.html#ad2c532fb5522d745b0006f7a3b36cab3">vehicle_movement::is_on_rails</a></div><div class="ttdeci">bool is_on_rails(const map &amp;m, const vehicle &amp;veh)</div><div class="ttdoc">Returns whether the vehicle is currently on rails.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01850">vehicle_move.cpp:1850</a></div></div>
<div class="ttc" id="anamespacevehicles_html_a002783f4304f09443cfa9fa8efa9f6d4"><div class="ttname"><a href="namespacevehicles.html#a002783f4304f09443cfa9fa8efa9f6d4">vehicles::vmiph_per_tile</a></div><div class="ttdeci">constexpr float vmiph_per_tile</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00068">vehicle.h:68</a></div></div>
<div class="ttc" id="anamespacevehicles_html_a38d998781d2493479832c6bff33e2f32"><div class="ttname"><a href="namespacevehicles.html#a38d998781d2493479832c6bff33e2f32">vehicles::rolling_constant_to_variable</a></div><div class="ttdeci">constexpr double rolling_constant_to_variable</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00067">vehicle.h:67</a></div></div>
<div class="ttc" id="aoptional_8h_html"><div class="ttname"><a href="optional_8h.html">optional.h</a></div></div>
<div class="ttc" id="aoptions_8h_html"><div class="ttname"><a href="options_8h.html">options.h</a></div></div>
<div class="ttc" id="aplayer_8h_html"><div class="ttname"><a href="player_8h.html">player.h</a></div></div>
<div class="ttc" id="apoint_8h_html_a4b1a6bcaa42d2c06ecc3afc63305bfdf"><div class="ttname"><a href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a></div><div class="ttdeci">static constexpr tripoint tripoint_zero</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00273">point.h:273</a></div></div>
<div class="ttc" id="apoint_8h_html_a53f9f23b765219169daffe4c54ad5b8f"><div class="ttname"><a href="point_8h.html#a53f9f23b765219169daffe4c54ad5b8f">tripoint_below</a></div><div class="ttdeci">static constexpr tripoint tripoint_below</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00295">point.h:295</a></div></div>
<div class="ttc" id="apoint__float_8h_html"><div class="ttname"><a href="point__float_8h.html">point_float.h</a></div></div>
<div class="ttc" id="arng_8cpp_html_a0c88381d6334a2fbaa726c53f5cf9bb9"><div class="ttname"><a href="rng_8cpp.html#a0c88381d6334a2fbaa726c53f5cf9bb9">rng_float</a></div><div class="ttdeci">double rng_float(double lo, double hi)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00028">rng.cpp:28</a></div></div>
<div class="ttc" id="arng_8cpp_html_a7ba03e7147e43d808dc29c54bce9e57f"><div class="ttname"><a href="rng_8cpp.html#a7ba03e7147e43d808dc29c54bce9e57f">dice</a></div><div class="ttdeci">int dice(int number, int sides)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00085">rng.cpp:85</a></div></div>
<div class="ttc" id="arng_8cpp_html_aad28bdad07401a34ecf9912708f8b750"><div class="ttname"><a href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a></div><div class="ttdeci">bool one_in(int chance)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00065">rng.cpp:65</a></div></div>
<div class="ttc" id="arng_8cpp_html_acd19ae79e3590a99c9eaf0389318b686"><div class="ttname"><a href="rng_8cpp.html#acd19ae79e3590a99c9eaf0389318b686">roll_remainder</a></div><div class="ttdeci">int roll_remainder(double value)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00096">rng.cpp:96</a></div></div>
<div class="ttc" id="arng_8h_html"><div class="ttname"><a href="rng_8h.html">rng.h</a></div></div>
<div class="ttc" id="asimplexnoise_8cpp_html_ac09abdb6d0f634024e3f63d92542e38f"><div class="ttname"><a href="simplexnoise_8cpp.html#ac09abdb6d0f634024e3f63d92542e38f">dot</a></div><div class="ttdeci">float dot(const int *g, const float x, const float y)</div><div class="ttdef"><b>Definition:</b> <a href="simplexnoise_8cpp_source.html#l00540">simplexnoise.cpp:540</a></div></div>
<div class="ttc" id="asounds_8h_html"><div class="ttname"><a href="sounds_8h.html">sounds.h</a></div></div>
<div class="ttc" id="astring__id_8h_html"><div class="ttname"><a href="string__id_8h.html">string_id.h</a></div></div>
<div class="ttc" id="astructbash__results_html_aca607ab5e6884fe03b2119ffecd88419"><div class="ttname"><a href="structbash__results.html#aca607ab5e6884fe03b2119ffecd88419">bash_results::success</a></div><div class="ttdeci">bool success</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00166">map.h:166</a></div></div>
<div class="ttc" id="astructitype_html_a32ac824cb8437ef7a8288dafe6c6bfe1"><div class="ttname"><a href="structitype.html#a32ac824cb8437ef7a8288dafe6c6bfe1">itype::materials</a></div><div class="ttdeci">std::vector&lt; material_id &gt; materials</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00922">itype.h:922</a></div></div>
<div class="ttc" id="astructpoint_html"><div class="ttname"><a href="structpoint.html">point</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00035">point.h:35</a></div></div>
<div class="ttc" id="astructpoint_html_a9404b750fdf6bffb8aeddf8b298ab8f6"><div class="ttname"><a href="structpoint.html#a9404b750fdf6bffb8aeddf8b298ab8f6">point::rotate</a></div><div class="ttdeci">point rotate(int turns, const point &amp;dim={ 1, 1 }) const</div><div class="ttdoc">Rotate point clockwise.</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00089">point.h:89</a></div></div>
<div class="ttc" id="astructpoint_html_a9a82ca9504acabb1e30569f89c805471"><div class="ttname"><a href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">point::y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00039">point.h:39</a></div></div>
<div class="ttc" id="astructpoint_html_ad679b07fb69d55f5ad454d0f1f2891d5"><div class="ttname"><a href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">point::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00038">point.h:38</a></div></div>
<div class="ttc" id="astructrider__data_html"><div class="ttname"><a href="structrider__data.html">rider_data</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00070">vehicle.h:70</a></div></div>
<div class="ttc" id="astructrl__vec2d_html"><div class="ttname"><a href="structrl__vec2d.html">rl_vec2d</a></div><div class="ttdef"><b>Definition:</b> <a href="point__float_8h_source.html#l00010">point_float.h:10</a></div></div>
<div class="ttc" id="astructrl__vec2d_html_acc0292005168ba5d844ab15cfe961d72"><div class="ttname"><a href="structrl__vec2d.html#acc0292005168ba5d844ab15cfe961d72">rl_vec2d::dot_product</a></div><div class="ttdeci">float dot_product(const rl_vec2d &amp;v) const</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00664">line.cpp:664</a></div></div>
<div class="ttc" id="astructtrap_html"><div class="ttname"><a href="structtrap.html">trap</a></div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00086">trap.h:86</a></div></div>
<div class="ttc" id="astructtrap_html_a01b0ef8443ac5ba4e7455880ca2dc44b"><div class="ttname"><a href="structtrap.html#a01b0ef8443ac5ba4e7455880ca2dc44b">trap::name</a></div><div class="ttdeci">std::string name() const</div><div class="ttdef"><b>Definition:</b> <a href="trap_8cpp_source.html#l00177">trap.cpp:177</a></div></div>
<div class="ttc" id="astructtrap_html_a03491b6455522e29bcbd457283b88c6d"><div class="ttname"><a href="structtrap.html#a03491b6455522e29bcbd457283b88c6d">trap::vehicle_data</a></div><div class="ttdeci">vehicle_handle_trap_data vehicle_data</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00122">trap.h:122</a></div></div>
<div class="ttc" id="astructtrap_html_ab2767aee5179ad23b3ad0b6b4b2415af"><div class="ttname"><a href="structtrap.html#ab2767aee5179ad23b3ad0b6b4b2415af">trap::loadid</a></div><div class="ttdeci">trap_id loadid</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00088">trap.h:88</a></div></div>
<div class="ttc" id="astructtripoint_html"><div class="ttname"><a href="structtripoint.html">tripoint</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00147">point.h:147</a></div></div>
<div class="ttc" id="astructtripoint_html_a89f6c0a16e2bfd7ce4f1f1d20404c4d7"><div class="ttname"><a href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">tripoint::y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00151">point.h:151</a></div></div>
<div class="ttc" id="astructtripoint_html_ac944c0e329b5eba2602f7a52f66bbbb9"><div class="ttname"><a href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">tripoint::z</a></div><div class="ttdeci">int z</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00152">point.h:152</a></div></div>
<div class="ttc" id="astructtripoint_html_accc0725c936dbebb2486f969f39e2e5f"><div class="ttname"><a href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">tripoint::xy</a></div><div class="ttdeci">constexpr point xy() const</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00220">point.h:220</a></div></div>
<div class="ttc" id="astructtripoint_html_affdc0d5b75024cbfacd208a495def3dc"><div class="ttname"><a href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">tripoint::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00150">point.h:150</a></div></div>
<div class="ttc" id="astructveh__collision_html"><div class="ttname"><a href="structveh__collision.html">veh_collision</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00107">vehicle.h:107</a></div></div>
<div class="ttc" id="astructveh__collision_html_a5b346d49ed96d1ac882411742b92c23a"><div class="ttname"><a href="structveh__collision.html#a5b346d49ed96d1ac882411742b92c23a">veh_collision::type</a></div><div class="ttdeci">veh_coll_type type</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00110">vehicle.h:110</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html"><div class="ttname"><a href="structvehicle__handle__trap__data.html">vehicle_handle_trap_data</a></div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00068">trap.h:68</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_a0c5bf103091c4d3af6e05554dfb4ea06"><div class="ttname"><a href="structvehicle__handle__trap__data.html#a0c5bf103091c4d3af6e05554dfb4ea06">vehicle_handle_trap_data::sound_volume</a></div><div class="ttdeci">int sound_volume</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00075">trap.h:75</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_a12a8a69fabc09c46c94a872c3deabfc3"><div class="ttname"><a href="structvehicle__handle__trap__data.html#a12a8a69fabc09c46c94a872c3deabfc3">vehicle_handle_trap_data::damage</a></div><div class="ttdeci">int damage</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00073">trap.h:73</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_a2ce8428df648cdf20dc6ac59effcb757"><div class="ttname"><a href="structvehicle__handle__trap__data.html#a2ce8428df648cdf20dc6ac59effcb757">vehicle_handle_trap_data::do_explosion</a></div><div class="ttdeci">bool do_explosion</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00070">trap.h:70</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_a4720c8fd0a5120c5e73999d630a441b9"><div class="ttname"><a href="structvehicle__handle__trap__data.html#a4720c8fd0a5120c5e73999d630a441b9">vehicle_handle_trap_data::chance</a></div><div class="ttdeci">int chance</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00072">trap.h:72</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_a5a19d024919f0e4b3e470b85ceee7557"><div class="ttname"><a href="structvehicle__handle__trap__data.html#a5a19d024919f0e4b3e470b85ceee7557">vehicle_handle_trap_data::sound</a></div><div class="ttdeci">translation sound</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00076">trap.h:76</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_a6f9a3d0f9d4799259b30a03fd1598c4d"><div class="ttname"><a href="structvehicle__handle__trap__data.html#a6f9a3d0f9d4799259b30a03fd1598c4d">vehicle_handle_trap_data::sound_variant</a></div><div class="ttdeci">std::string sound_variant</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00078">trap.h:78</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_a85267d7b741db092465b148b86e023a7"><div class="ttname"><a href="structvehicle__handle__trap__data.html#a85267d7b741db092465b148b86e023a7">vehicle_handle_trap_data::spawn_items</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; itype_id, double &gt; &gt; spawn_items</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00080">trap.h:80</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_a8fc4e74b6409f9616968d445b17c3955"><div class="ttname"><a href="structvehicle__handle__trap__data.html#a8fc4e74b6409f9616968d445b17c3955">vehicle_handle_trap_data::sound_type</a></div><div class="ttdeci">std::string sound_type</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00077">trap.h:77</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_ab19712f6fbd3b157f986b29925197dd3"><div class="ttname"><a href="structvehicle__handle__trap__data.html#ab19712f6fbd3b157f986b29925197dd3">vehicle_handle_trap_data::set_trap</a></div><div class="ttdeci">trap_str_id set_trap</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00081">trap.h:81</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_acf9ea314f7998e6a589bb3187c6ae6a2"><div class="ttname"><a href="structvehicle__handle__trap__data.html#acf9ea314f7998e6a589bb3187c6ae6a2">vehicle_handle_trap_data::remove_trap</a></div><div class="ttdeci">bool remove_trap</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00069">trap.h:69</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_ad34f1fa0ddea2be0516fe52076755d28"><div class="ttname"><a href="structvehicle__handle__trap__data.html#ad34f1fa0ddea2be0516fe52076755d28">vehicle_handle_trap_data::shrapnel</a></div><div class="ttdeci">int shrapnel</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00074">trap.h:74</a></div></div>
<div class="ttc" id="astructvehicle__handle__trap__data_html_aff743c43f98a9a30f15b33bab668b9f3"><div class="ttname"><a href="structvehicle__handle__trap__data.html#aff743c43f98a9a30f15b33bab668b9f3">vehicle_handle_trap_data::is_falling</a></div><div class="ttdeci">bool is_falling</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00071">trap.h:71</a></div></div>
<div class="ttc" id="astructvehicle__movement_1_1rail__processing__result_html"><div class="ttname"><a href="structvehicle__movement_1_1rail__processing__result.html">vehicle_movement::rail_processing_result</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8h_source.html#l00014">vehicle_move.h:14</a></div></div>
<div class="ttc" id="astructvehicle__movement_1_1rail__processing__result_html_a0a31255e2dd466d5580aa4446964f5c7"><div class="ttname"><a href="structvehicle__movement_1_1rail__processing__result.html#a0a31255e2dd466d5580aa4446964f5c7">vehicle_movement::rail_processing_result::turn_dir</a></div><div class="ttdeci">units::angle turn_dir</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8h_source.html#l00017">vehicle_move.h:17</a></div></div>
<div class="ttc" id="astructvehicle__movement_1_1rail__processing__result_html_a894bbd71e540fd9488b350fa60a51096"><div class="ttname"><a href="structvehicle__movement_1_1rail__processing__result.html#a894bbd71e540fd9488b350fa60a51096">vehicle_movement::rail_processing_result::do_shift</a></div><div class="ttdeci">bool do_shift</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8h_source.html#l00016">vehicle_move.h:16</a></div></div>
<div class="ttc" id="astructvehicle__movement_1_1rail__processing__result_html_aa10da2e7136704fa25a4af595ae7122b"><div class="ttname"><a href="structvehicle__movement_1_1rail__processing__result.html#aa10da2e7136704fa25a4af595ae7122b">vehicle_movement::rail_processing_result::do_turn</a></div><div class="ttdeci">bool do_turn</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8h_source.html#l00015">vehicle_move.h:15</a></div></div>
<div class="ttc" id="astructvehicle__movement_1_1rail__processing__result_html_ac8a076ac2aafe3dc22aa6796ffdc04b3"><div class="ttname"><a href="structvehicle__movement_1_1rail__processing__result.html#ac8a076ac2aafe3dc22aa6796ffdc04b3">vehicle_movement::rail_processing_result::shift_amount</a></div><div class="ttdeci">tripoint shift_amount</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8h_source.html#l00018">vehicle_move.h:18</a></div></div>
<div class="ttc" id="astructvehicle__part_html"><div class="ttname"><a href="structvehicle__part.html">vehicle_part</a></div><div class="ttdoc">Structure, describing vehicle part (i.e., wheel, seat)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00185">vehicle.h:185</a></div></div>
<div class="ttc" id="astructvehicle__part_html_a002a1023cd1a96d43556a1b912ebd27b"><div class="ttname"><a href="structvehicle__part.html#a002a1023cd1a96d43556a1b912ebd27b">vehicle_part::info</a></div><div class="ttdeci">const vpart_info &amp; info() const</div><div class="ttdoc">Get part definition common to all parts of this type.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__part_8cpp_source.html#l00519">vehicle_part.cpp:519</a></div></div>
<div class="ttc" id="astructvehicle__part_html_a6944258e64f01a23d5ea254ad2fe71eaacbdd8bab66369a907eb2edbd4b209752"><div class="ttname"><a href="structvehicle__part.html#a6944258e64f01a23d5ea254ad2fe71eaacbdd8bab66369a907eb2edbd4b209752">vehicle_part::passenger_flag</a></div><div class="ttdeci">@ passenger_flag</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00192">vehicle.h:192</a></div></div>
<div class="ttc" id="astructvehicle__part_html_a7c9609ecf75f0839401351558a6b5b83"><div class="ttname"><a href="structvehicle__part.html#a7c9609ecf75f0839401351558a6b5b83">vehicle_part::wheel_area</a></div><div class="ttdeci">int wheel_area() const</div><div class="ttdoc">Get wheel diameter times wheel width (inches^2) or return 0 if part is not wheel.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__part_8cpp_source.html#l00411">vehicle_part.cpp:411</a></div></div>
<div class="ttc" id="astructvehicle__part_html_a86c3ad22b1284273f14e63ce726d685d"><div class="ttname"><a href="structvehicle__part.html#a86c3ad22b1284273f14e63ce726d685d">vehicle_part::remove_flag</a></div><div class="ttdeci">int remove_flag(const int flag) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00214">vehicle.h:214</a></div></div>
<div class="ttc" id="atranslations_8h_html"><div class="ttname"><a href="translations_8h.html">translations.h</a></div></div>
<div class="ttc" id="atranslations_8h_html_aa829053017e23ef22d44dccecba63a34"><div class="ttname"><a href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a></div><div class="ttdeci">#define _(msg)</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00116">translations.h:116</a></div></div>
<div class="ttc" id="atrap_8cpp_html_a7b8e40eb2b50e3841e2d9f2d0531226a"><div class="ttname"><a href="trap_8cpp.html#a7b8e40eb2b50e3841e2d9f2d0531226a">tr_null</a></div><div class="ttdeci">trap_id tr_null</div><div class="ttdef"><b>Definition:</b> <a href="trap_8cpp_source.html#l00276">trap.cpp:276</a></div></div>
<div class="ttc" id="atrap_8h_html"><div class="ttname"><a href="trap_8h.html">trap.h</a></div></div>
<div class="ttc" id="aunits__angle_8h_html"><div class="ttname"><a href="units__angle_8h.html">units_angle.h</a></div></div>
<div class="ttc" id="aunits__mass_8h_html_af9bdbc604b3753642c7d25280b6f3114"><div class="ttname"><a href="units__mass_8h.html#af9bdbc604b3753642c7d25280b6f3114">GRAVITY_OF_EARTH</a></div><div class="ttdeci">constexpr double GRAVITY_OF_EARTH</div><div class="ttdef"><b>Definition:</b> <a href="units__mass_8h_source.html#l00013">units_mass.h:13</a></div></div>
<div class="ttc" id="aunits__utility_8h_html"><div class="ttname"><a href="units__utility_8h.html">units_utility.h</a></div></div>
<div class="ttc" id="aunits__utility_8h_html_a0ff5ed49bfcc963d25c49bd38df494e3"><div class="ttname"><a href="units__utility_8h.html#a0ff5ed49bfcc963d25c49bd38df494e3">round_to_multiple_of</a></div><div class="ttdeci">units::quantity&lt; T, U &gt; round_to_multiple_of(units::quantity&lt; T, U &gt; val, units::quantity&lt; T, U &gt; of)</div><div class="ttdef"><b>Definition:</b> <a href="units__utility_8h_source.html#l00038">units_utility.h:38</a></div></div>
<div class="ttc" id="aveh__type_8h_html"><div class="ttname"><a href="veh__type_8h.html">veh_type.h</a></div></div>
<div class="ttc" id="aveh__type_8h_html_aa3ff66a8c100c3deb40dfa70f1eb307ea1d493984c83c95a15238b6e21f4547d0"><div class="ttname"><a href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307ea1d493984c83c95a15238b6e21f4547d0">VPFLAG_CONTROLS</a></div><div class="ttdeci">@ VPFLAG_CONTROLS</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00041">veh_type.h:41</a></div></div>
<div class="ttc" id="aveh__type_8h_html_aa3ff66a8c100c3deb40dfa70f1eb307ea4c67c3568d86e365c41549637ebff02b"><div class="ttname"><a href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307ea4c67c3568d86e365c41549637ebff02b">VPFLAG_ARMOR</a></div><div class="ttdeci">@ VPFLAG_ARMOR</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00032">veh_type.h:32</a></div></div>
<div class="ttc" id="aveh__type_8h_html_aa3ff66a8c100c3deb40dfa70f1eb307ea8a546069f510a6de416bf119fe037679"><div class="ttname"><a href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307ea8a546069f510a6de416bf119fe037679">VPFLAG_SEATBELT</a></div><div class="ttdeci">@ VPFLAG_SEATBELT</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00045">veh_type.h:45</a></div></div>
<div class="ttc" id="aveh__type_8h_html_aa3ff66a8c100c3deb40dfa70f1eb307eae36e04cd704cf1a4a2ae645809e24e1b"><div class="ttname"><a href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307eae36e04cd704cf1a4a2ae645809e24e1b">VPFLAG_WHEEL</a></div><div class="ttdeci">@ VPFLAG_WHEEL</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00048">veh_type.h:48</a></div></div>
<div class="ttc" id="avehicle_8h_html"><div class="ttname"><a href="vehicle_8h.html">vehicle.h</a></div></div>
<div class="ttc" id="avehicle_8h_html_a53b960f88fea75df3467e17492458952a81e75be1950a29c38a47c29ca62af371"><div class="ttname"><a href="vehicle_8h.html#a53b960f88fea75df3467e17492458952a81e75be1950a29c38a47c29ca62af371">veh_coll_body</a></div><div class="ttdeci">@ veh_coll_body</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00100">vehicle.h:100</a></div></div>
<div class="ttc" id="avehicle_8h_html_a53b960f88fea75df3467e17492458952a9acfef3ceff4a9c4fa3c0cf62bb8d19c"><div class="ttname"><a href="vehicle_8h.html#a53b960f88fea75df3467e17492458952a9acfef3ceff4a9c4fa3c0cf62bb8d19c">veh_coll_bashable</a></div><div class="ttdeci">@ veh_coll_bashable</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00102">vehicle.h:102</a></div></div>
<div class="ttc" id="avehicle_8h_html_a53b960f88fea75df3467e17492458952a9ce81fa4bb69ed5ab6ca3648ec842c39"><div class="ttname"><a href="vehicle_8h.html#a53b960f88fea75df3467e17492458952a9ce81fa4bb69ed5ab6ca3648ec842c39">veh_coll_veh</a></div><div class="ttdeci">@ veh_coll_veh</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00101">vehicle.h:101</a></div></div>
<div class="ttc" id="avehicle_8h_html_a53b960f88fea75df3467e17492458952ad6f7a65f12e8eab61c4617147bbd6189"><div class="ttname"><a href="vehicle_8h.html#a53b960f88fea75df3467e17492458952ad6f7a65f12e8eab61c4617147bbd6189">veh_coll_nothing</a></div><div class="ttdeci">@ veh_coll_nothing</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00099">vehicle.h:99</a></div></div>
<div class="ttc" id="avehicle_8h_html_a53b960f88fea75df3467e17492458952af924b62a834eb9a80f9f8ac3d7ae4be3"><div class="ttname"><a href="vehicle_8h.html#a53b960f88fea75df3467e17492458952af924b62a834eb9a80f9f8ac3d7ae4be3">veh_coll_other</a></div><div class="ttdeci">@ veh_coll_other</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00103">vehicle.h:103</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a0039ad830efb94637bdc1dd04d0fa60c"><div class="ttname"><a href="vehicle__move_8cpp.html#a0039ad830efb94637bdc1dd04d0fa60c">angle_to_vec</a></div><div class="ttdeci">static rl_vec2d angle_to_vec(units::angle angle)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01208">vehicle_move.cpp:1208</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a00735c0bfb68c2a0c0c7d53e8f72a70e"><div class="ttname"><a href="vehicle__move_8cpp.html#a00735c0bfb68c2a0c0c7d53e8f72a70e">part_location_structure</a></div><div class="ttdeci">static const std::string part_location_structure(&quot;structure&quot;)</div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a02a4844a7fb68c13a34dc40b0a9e94d8"><div class="ttname"><a href="vehicle__move_8cpp.html#a02a4844a7fb68c13a34dc40b0a9e94d8">effect_pet</a></div><div class="ttdeci">static const efftype_id effect_pet(&quot;pet&quot;)</div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a07407f1ed991551dda7d2952690adabb"><div class="ttname"><a href="vehicle__move_8cpp.html#a07407f1ed991551dda7d2952690adabb">mps_to_miph</a></div><div class="ttdeci">static const float mps_to_miph</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00063">vehicle_move.cpp:63</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a3bf51af37129f24d376a74ca56b2644e"><div class="ttname"><a href="vehicle__move_8cpp.html#a3bf51af37129f24d376a74ca56b2644e">mps_to_vmiph</a></div><div class="ttdeci">int mps_to_vmiph(double mps)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00066">vehicle_move.cpp:66</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a3f2436294a28dc686156c10abab2f994"><div class="ttname"><a href="vehicle__move_8cpp.html#a3f2436294a28dc686156c10abab2f994">fuel_type_battery</a></div><div class="ttdeci">static const itype_id fuel_type_battery(&quot;battery&quot;)</div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a43e5ce141f651d0255c6f15d0954018e"><div class="ttname"><a href="vehicle__move_8cpp.html#a43e5ce141f651d0255c6f15d0954018e">terrain_collision_data</a></div><div class="ttdeci">static void terrain_collision_data(const tripoint &amp;p, bool bash_floor, float &amp;mass, float &amp;density, float &amp;elastic)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00458">vehicle_move.cpp:458</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a49bc164f30e64702250d2cbea09bf86c"><div class="ttname"><a href="vehicle__move_8cpp.html#a49bc164f30e64702250d2cbea09bf86c">dbg</a></div><div class="ttdeci">#define dbg(x)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00044">vehicle_move.cpp:44</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a5b4f290597a25f2c2f9447eb786c37c5"><div class="ttname"><a href="vehicle__move_8cpp.html#a5b4f290597a25f2c2f9447eb786c37c5">vmiph_to_mps</a></div><div class="ttdeci">double vmiph_to_mps(int vmiph)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00072">vehicle_move.cpp:72</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a7697771dc47ecaeff36785ff20c9aa33"><div class="ttname"><a href="vehicle__move_8cpp.html#a7697771dc47ecaeff36785ff20c9aa33">effect_harnessed</a></div><div class="ttdeci">static const efftype_id effect_harnessed(&quot;harnessed&quot;)</div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a773926a54d526c780fa7b340eaaaa6a4"><div class="ttname"><a href="vehicle__move_8cpp.html#a773926a54d526c780fa7b340eaaaa6a4">get_collision_factor</a></div><div class="ttdeci">float get_collision_factor(const float delta_v)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l01230">vehicle_move.cpp:1230</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a8001239e356cfe527444f6019ee90205"><div class="ttname"><a href="vehicle__move_8cpp.html#a8001239e356cfe527444f6019ee90205">cmps_to_vmiph</a></div><div class="ttdeci">int cmps_to_vmiph(int cmps)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00077">vehicle_move.cpp:77</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_a944ba9be1d911a61e9ca62af989355fd"><div class="ttname"><a href="vehicle__move_8cpp.html#a944ba9be1d911a61e9ca62af989355fd">fuel_type_animal</a></div><div class="ttdeci">static const itype_id fuel_type_animal(&quot;animal&quot;)</div></div>
<div class="ttc" id="avehicle__move_8cpp_html_aaf1122bb5a05fea1f3c951510d79a849"><div class="ttname"><a href="vehicle__move_8cpp.html#aaf1122bb5a05fea1f3c951510d79a849">mi_to_vmi</a></div><div class="ttdeci">static const int mi_to_vmi</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00061">vehicle_move.cpp:61</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_ab3c28976bd7014b628437d061f7dc6c7"><div class="ttname"><a href="vehicle__move_8cpp.html#ab3c28976bd7014b628437d061f7dc6c7">vmiph_to_cmps</a></div><div class="ttdeci">int vmiph_to_cmps(int vmiph)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00082">vehicle_move.cpp:82</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_abc9fa7d03f14e2a5323ee0ff66e7938e"><div class="ttname"><a href="vehicle__move_8cpp.html#abc9fa7d03f14e2a5323ee0ff66e7938e">tile_height</a></div><div class="ttdeci">static const float tile_height</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__move_8cpp_source.html#l00059">vehicle_move.cpp:59</a></div></div>
<div class="ttc" id="avehicle__move_8cpp_html_ad1df0ca2944a94c3ad796e8baada33ae"><div class="ttname"><a href="vehicle__move_8cpp.html#ad1df0ca2944a94c3ad796e8baada33ae">effect_stunned</a></div><div class="ttdeci">static const efftype_id effect_stunned(&quot;stunned&quot;)</div></div>
<div class="ttc" id="avehicle__move_8cpp_html_af54ee122fbd5cf94c6ef8bca7e67c8e8"><div class="ttname"><a href="vehicle__move_8cpp.html#af54ee122fbd5cf94c6ef8bca7e67c8e8">fuel_type_muscle</a></div><div class="ttdeci">static const itype_id fuel_type_muscle(&quot;muscle&quot;)</div></div>
<div class="ttc" id="avehicle__move_8cpp_html_afee8dcfd12a225c469ee6171063d7594"><div class="ttname"><a href="vehicle__move_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a></div><div class="ttdeci">static const skill_id skill_driving(&quot;driving&quot;)</div></div>
<div class="ttc" id="avehicle__move_8h_html"><div class="ttname"><a href="vehicle__move_8h.html">vehicle_move.h</a></div></div>
<div class="ttc" id="avpart__position_8h_html"><div class="ttname"><a href="vpart__position_8h.html">vpart_position.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="vehicle__move_8cpp.html">vehicle_move.cpp</a></li>
    <li class="footer">Generated on Sat Nov 12 2022 15:15:34 for Cataclysm BN by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
